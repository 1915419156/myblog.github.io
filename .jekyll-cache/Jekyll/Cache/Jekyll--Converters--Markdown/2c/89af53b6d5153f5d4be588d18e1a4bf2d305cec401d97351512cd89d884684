I"› <blockquote>
  <p>2019-08-11 16:04:58</p>
</blockquote>

<h1 id="è·Ÿæˆ‘ä¸€èµ·å†™makefile">è·Ÿæˆ‘ä¸€èµ·å†™makefile</h1>

<p><em>å‚è€ƒé“¾æ¥ï¼š</em> <a href="http://www.gnu.org/software/make/manual/make.html">GNU make</a>; <a href="https://www.cnblogs.com/itech/archive/2009/09/15/1567001.html">GUN MakeæŒ‡å—</a></p>
<h2 id="1-æ¦‚è¿°">1 æ¦‚è¿°</h2>
<p>makeå·¥å…·ï¼š</p>

<ul>
  <li>Delphi-make</li>
  <li>Visual C++ nmake</li>
  <li>GNU make</li>
</ul>

<p>æ–‡ç« ä¸»è¦é’ˆå¯¹GNUçš„make</p>

<h2 id="1-make-çš„ä½¿ç”¨">1 make çš„ä½¿ç”¨</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç”¨æ³•ï¼šmake <span class="o">[</span>é€‰é¡¹] <span class="o">[</span>ç›®æ ‡] ...
é€‰é¡¹ï¼š
  <span class="nt">-b</span>, <span class="nt">-m</span>                      å¿½ç•¥å…¼å®¹æ€§ã€‚
  <span class="nt">-B</span>, <span class="nt">--always-make</span>           æ— æ¡ä»¶ make æ‰€æœ‰ç›®æ ‡ã€‚
  <span class="nt">-C</span> DIRECTORY, <span class="nt">--directory</span><span class="o">=</span>DIRECTORY
                              åœ¨æ‰§è¡Œå‰å…ˆåˆ‡æ¢åˆ° DIRECTORY ç›®å½•ã€‚
  <span class="nt">-d</span>                          æ‰“å°å¤§é‡è°ƒè¯•ä¿¡æ¯ã€‚
  <span class="nt">--debug</span><span class="o">[=</span>FLAGS]             æ‰“å°å„ç§è°ƒè¯•ä¿¡æ¯ã€‚
  <span class="nt">-e</span>, <span class="nt">--environment-overrides</span>
                              ç¯å¢ƒå˜é‡è¦†ç›– makefile ä¸­çš„å˜é‡ã€‚
  <span class="nt">--eval</span><span class="o">=</span>STRING               Evaluate STRING as a makefile statement.
  <span class="nt">-f</span> FILE, <span class="nt">--file</span><span class="o">=</span>FILE, <span class="nt">--makefile</span><span class="o">=</span>FILE
                              ä» FILE ä¸­è¯»å…¥ makefileã€‚
  <span class="nt">-h</span>, <span class="nt">--help</span>                  æ‰“å°è¯¥æ¶ˆæ¯å¹¶é€€å‡ºã€‚
  <span class="nt">-i</span>, <span class="nt">--ignore-errors</span>         Ignore errors from recipes.
  <span class="nt">-I</span> DIRECTORY, <span class="nt">--include-dir</span><span class="o">=</span>DIRECTORY
                              åœ¨ DIRECTORY ä¸­æœç´¢è¢«åŒ…å«çš„ makefileã€‚
  <span class="nt">-j</span> <span class="o">[</span>N], <span class="nt">--jobs</span><span class="o">[=</span>N]          åŒæ—¶å…è®¸ N ä¸ªä»»åŠ¡ï¼›æ— å‚æ•°è¡¨æ˜å…è®¸æ— é™ä¸ªä»»åŠ¡ã€‚
  <span class="nt">-k</span>, <span class="nt">--keep-going</span>            å½“æŸäº›ç›®æ ‡æ— æ³•åˆ›å»ºæ—¶ä»ç„¶ç»§ç»­ã€‚
  <span class="nt">-l</span> <span class="o">[</span>N], <span class="nt">--load-average</span><span class="o">[=</span>N], <span class="nt">--max-load</span><span class="o">[=</span>N]
                              åœ¨ç³»ç»Ÿè´Ÿè½½é«˜äº N æ—¶ä¸å¯åŠ¨å¤šä»»åŠ¡ã€‚
  <span class="nt">-L</span>, <span class="nt">--check-symlink-times</span>   ä½¿ç”¨è½¯é“¾æ¥åŠè½¯é“¾æ¥ç›®æ ‡ä¸­ä¿®æ”¹æ—¶é—´è¾ƒæ™šçš„ä¸€ä¸ªã€‚
  <span class="nt">-n</span>, <span class="nt">--just-print</span>, <span class="nt">--dry-run</span>, <span class="nt">--recon</span>
                              Don not actually run any recipe<span class="p">;</span> just print them.
  <span class="nt">-o</span> FILE, <span class="nt">--old-file</span><span class="o">=</span>FILE, <span class="nt">--assume-old</span><span class="o">=</span>FILE
                              å°† FILE å½“åšå¾ˆæ—§ï¼Œä¸å¿…é‡æ–°ç”Ÿæˆã€‚
  <span class="nt">-O</span><span class="o">[</span>TYPE], <span class="nt">--output-sync</span><span class="o">[=</span>TYPE]
                              Synchronize output of parallel <span class="nb">jobs </span>by TYPE.
  <span class="nt">-p</span>, <span class="nt">--print-data-base</span>       æ‰“å° make çš„å†…éƒ¨æ•°æ®åº“ã€‚
  <span class="nt">-q</span>, <span class="nt">--question</span>              Run no recipe<span class="p">;</span> <span class="nb">exit </span>status says <span class="k">if </span>up to date.
  <span class="nt">-r</span>, <span class="nt">--no-builtin-rules</span>      ç¦ç”¨å†…ç½®éšå«è§„åˆ™ã€‚
  <span class="nt">-R</span>, <span class="nt">--no-builtin-variables</span>   ç¦ç”¨å†…ç½®å˜é‡è®¾ç½®ã€‚
  <span class="nt">-s</span>, <span class="nt">--silent</span>, <span class="nt">--quiet</span>       Don not <span class="nb">echo </span>recipes.
  <span class="nt">-S</span>, <span class="nt">--no-keep-going</span>, <span class="nt">--stop</span>
                              å…³é—­ <span class="nt">-k</span>ã€‚
  <span class="nt">-t</span>, <span class="nt">--touch</span>                 <span class="nb">touch </span>ç›®æ ‡è€Œä¸æ˜¯é‡æ–°åˆ›å»ºå®ƒä»¬ã€‚
  <span class="nt">--trace</span>                     Print tracing information.
  <span class="nt">-v</span>, <span class="nt">--version</span>               æ‰“å° make çš„ç‰ˆæœ¬å·å¹¶é€€å‡ºã€‚
  <span class="nt">-w</span>, <span class="nt">--print-directory</span>       æ‰“å°å½“å‰ç›®å½•ã€‚
  <span class="nt">--no-print-directory</span>        å…³é—­ <span class="nt">-w</span>ï¼Œå³ä½¿ <span class="nt">-w</span> é»˜è®¤å¼€å¯ã€‚
  <span class="nt">-W</span> FILE, <span class="nt">--what-if</span><span class="o">=</span>FILE, <span class="nt">--new-file</span><span class="o">=</span>FILE, <span class="nt">--assume-new</span><span class="o">=</span>FILE
                              å°† FILE å½“åšæœ€æ–°ã€‚
  <span class="nt">--warn-undefined-variables</span>  å½“å¼•ç”¨æœªå®šä¹‰å˜é‡çš„æ—¶å€™å‘å‡ºè­¦å‘Šã€‚

è¯¥ç¨‹åºä¸º x86_64-pc-linux-gnu ç¼–è¯‘
æŠ¥å‘Šé”™è¯¯åˆ° &lt;bug-make@gnu.org&gt;

</code></pre></div></div>

<h2 id="2-å…³äºç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥">2 å…³äºç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥</h2>

<p>å…·ä½“çš„è¿‡ç¨‹å¯ä»¥å‚ç…§:<a href="https://wangpengcheng.github.io/2019/05/12/c_peator_problem/">C/C++ çš„ä¸€ä¸ªç¬¦å·æ“ä½œé—®é¢˜</a></p>

<p>ç¼–è¯‘æ—¶(.c-&gt;.o)ï¼šç¼–è¯‘å™¨éœ€è¦çš„æ˜¯è¯­æ³•æ­£ç¡®ï¼Œå‡½æ•°ä¸å˜é‡çš„å£°æ˜çš„æ­£ç¡®ã€‚
é“¾æ¥æ—¶(.o-&gt;exe):ä¸»è¦æ˜¯é“¾æ¥å‡½æ•°å’Œå…¨å±€å˜é‡ã€‚</p>

<h2 id="3-makefileä»‹ç»">3 Makefileä»‹ç»</h2>

<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨gccç­‰ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥ï¼Œå¯¹å¤æ‚é¡¹ç›®ä½¿ç”¨Makefileæ–‡ä»¶æ¥ï¼Œè®°å½•ç¼–è¯‘æŒ‡ä»¤çš„é¡ºåºï¼Œç›¸å½“äºå¦å¤–çš„é’ˆå¯¹gccç­‰ç¼–è¯‘å™¨çš„shellè„šæœ¬ã€‚ä½¿ç”¨makeå‘½ä»¤æ¥æ‰§è¡Œç›¸å…³çš„å‘½ä»¤ã€‚</p>

<h3 id="31-makefileçš„è§„åˆ™">3.1 Makefileçš„è§„åˆ™</h3>

<p>åŸºæœ¬æŒ‡ä»¤æ ¼å¼ï¼š</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">target... </span><span class="o">:</span> <span class="nf">prerequisites ...</span>
    <span class="err">command</span>
    <span class="err">...</span>
    <span class="err">...</span>

<span class="c">#æˆ–è€…
</span>
<span class="nl">targets </span><span class="o">:</span> <span class="nf">prerequisites ; command</span>
    <span class="err">command</span>
<span class="err">...</span>
</code></pre></div></div>

<ul>
  <li>target:ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ï¼›å¯ä»¥ä½¿ç”¨ObjectFileã€labelæˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶</li>
  <li>prerequisites ç”Ÿæˆæ‰€éœ€è¦çš„æ–‡ä»¶æˆ–è€…ç›®æ ‡</li>
  <li>command å°±æ˜¯makeéœ€è¦æ‰§è¡Œçš„å‘½ä»¤(ä»»æ„çš„shellå‘½ä»¤)</li>
</ul>

<p>æ³¨æ„è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">command</code>å¦‚æœä¸æ˜¯å’Œtargetåœ¨åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ä»¥[Tab]å¼€å¤´ã€‚å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨`&gt; 2019-08-11 16:04:58</p>

<h1 id="è·Ÿæˆ‘ä¸€èµ·å†™makefile-1">è·Ÿæˆ‘ä¸€èµ·å†™makefile</h1>

<p><em>å‚è€ƒé“¾æ¥ï¼š</em> <a href="http://www.gnu.org/software/make/manual/make.html">GNU make</a>; <a href="https://www.cnblogs.com/itech/archive/2009/09/15/1567001.html">GUN MakeæŒ‡å—</a></p>
<h2 id="1-æ¦‚è¿°-1">1 æ¦‚è¿°</h2>
<p>makeå·¥å…·ï¼š</p>

<ul>
  <li>Delphi-make</li>
  <li>Visual C++ nmake</li>
  <li>GNU make</li>
</ul>

<p>æ–‡ç« ä¸»è¦é’ˆå¯¹GNUçš„make</p>

<h2 id="1-make-çš„ä½¿ç”¨-1">1 make çš„ä½¿ç”¨</h2>

<p>&lt;!JEKYLL@4800@0&gt;</p>

<h2 id="2-å…³äºç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥-1">2 å…³äºç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥</h2>

<p>å…·ä½“çš„è¿‡ç¨‹å¯ä»¥å‚ç…§:<a href="https://wangpengcheng.github.io/2019/05/12/c_peator_problem/">C/C++ çš„ä¸€ä¸ªç¬¦å·æ“ä½œé—®é¢˜</a></p>

<p>ç¼–è¯‘æ—¶(.c-&gt;.o)ï¼šç¼–è¯‘å™¨éœ€è¦çš„æ˜¯è¯­æ³•æ­£ç¡®ï¼Œå‡½æ•°ä¸å˜é‡çš„å£°æ˜çš„æ­£ç¡®ã€‚
é“¾æ¥æ—¶(.o-&gt;exe):ä¸»è¦æ˜¯é“¾æ¥å‡½æ•°å’Œå…¨å±€å˜é‡ã€‚</p>

<h2 id="3-makefileä»‹ç»-1">3 Makefileä»‹ç»</h2>

<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨gccç­‰ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥ï¼Œå¯¹å¤æ‚é¡¹ç›®ä½¿ç”¨Makefileæ–‡ä»¶æ¥ï¼Œè®°å½•ç¼–è¯‘æŒ‡ä»¤çš„é¡ºåºï¼Œç›¸å½“äºå¦å¤–çš„é’ˆå¯¹gccç­‰ç¼–è¯‘å™¨çš„shellè„šæœ¬ã€‚ä½¿ç”¨makeå‘½ä»¤æ¥æ‰§è¡Œç›¸å…³çš„å‘½ä»¤ã€‚</p>

<h3 id="31-makefileçš„è§„åˆ™-1">3.1 Makefileçš„è§„åˆ™</h3>

<p>åŸºæœ¬æŒ‡ä»¤æ ¼å¼ï¼š</p>

<p>&lt;!JEKYLL@4800@1&gt;</p>

<ul>
  <li>target:ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ï¼›å¯ä»¥ä½¿ç”¨ObjectFileã€labelæˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶</li>
  <li>prerequisites ç”Ÿæˆæ‰€éœ€è¦çš„æ–‡ä»¶æˆ–è€…ç›®æ ‡</li>
  <li>command å°±æ˜¯makeéœ€è¦æ‰§è¡Œçš„å‘½ä»¤(ä»»æ„çš„shellå‘½ä»¤)</li>
</ul>

<p>æ³¨æ„è¿™é‡Œçš„&lt;!JEKYLL@4800@2&gt;å¦‚æœä¸æ˜¯å’Œtargetåœ¨åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ä»¥[Tab]å¼€å¤´ã€‚å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨ä½œä¸ºç»­è¡Œç¬¦ã€‚</p>

<p>ç®€å•ç¤ºä¾‹ï¼š</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">edit </span><span class="o">:</span> <span class="nf">main.o kbd.o command.o display.o </span>\
<span class="nf">    insert.o search.o files.o utils.o</span>
    <span class="err">cc</span> <span class="err">-o</span> <span class="err">edit</span> <span class="err">main.o</span> <span class="err">kbd.o</span> <span class="err">command.o</span> <span class="err">display.o</span> <span class="err">\</span>
    <span class="err">insert.o</span> <span class="err">search.o</span> <span class="err">files.o</span> <span class="err">utils.o</span>
<span class="nl">main.o </span><span class="o">:</span> <span class="nf">main.c defs.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">main.c</span>
<span class="nl">kbd.o </span><span class="o">:</span> <span class="nf">kbd.c defs.h command.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">kbd.c</span>
<span class="nl">command.o </span><span class="o">:</span> <span class="nf">command.c defs.h command.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">command.c</span>
<span class="nl">display.o </span><span class="o">:</span> <span class="nf">display.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">display.c</span>
<span class="nl">insert.o </span><span class="o">:</span> <span class="nf">insert.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">insert.c</span>
<span class="nl">search.o </span><span class="o">:</span> <span class="nf">search.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">search.c</span>
<span class="nl">files.o </span><span class="o">:</span> <span class="nf">files.c defs.h buffer.h command.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">files.c</span>
<span class="nl">utils.o </span><span class="o">:</span> <span class="nf">utils.c defs.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">utils.c</span>
<span class="nl">clean </span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">edit</span> <span class="err">main.o</span> <span class="err">kbd.o</span> <span class="err">command.o</span> <span class="err">display.o</span> <span class="err">\</span>
    <span class="err">insert.o</span> <span class="err">search.o</span> <span class="err">files.o</span> <span class="err">utils.o</span>

</code></pre></div></div>
<p>æ³¨æ„è¿™é‡Œçš„cleanæ˜¯ä¸€ä¸ªlabelç›¸å½“äºä¸€ä¸ªè®°å½•åŠ¨ä½œçš„å˜é‡</p>

<h3 id="33-makeå·¥ä½œæµç¨‹">3.3 makeå·¥ä½œæµç¨‹</h3>

<ul>
  <li>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„â€œMakefileâ€æˆ–è€…â€œmakefileâ€æ–‡ä»¶ã€‚</li>
  <li>æ‰¾åˆ°æ–‡ä»¶ï¼ŒæŸ¥æ‰¾æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡æ–‡ä»¶(target)ã€‚å¹¶å°†å…¶è®¾ç½®ä¸ºæœ€ç»ˆçš„ç›®æ ‡æ–‡ä»¶</li>
  <li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…ç›¸å…³ä¾èµ–éœ€è¦å…¶å®ƒçš„åŠ¨ä½œç”Ÿæˆï¼Œæˆ–è€…ä¾èµ–æ–‡ä»¶çš„æ–‡ä»¶ä¿®æ”¹æ—¶é—´è¦æ¯”editè¿™ä¸ªæ–‡ä»¶æ–°ï¼Œåˆ™æ‰§è¡Œåé¢çš„å‘½ä»¤ç”Ÿæˆç›¸å…³ç›®æ ‡æ–‡ä»¶ã€‚</li>
  <li>ä¸€å±‚å±‚çš„æŸ¥æ‰¾ç›¸å…³ä¾èµ–ï¼Œè¿›è¡Œé€’å½’ï¼Œæ‰§è¡Œç¨‹åºã€‚</li>
</ul>

<h3 id="34-makefileä¸­ä½¿ç”¨å˜é‡">3.4 makefileä¸­ä½¿ç”¨å˜é‡</h3>

<p>å¯ä»¥ç›´æ¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">=</code>æ¥è¿›è¡Œå˜é‡èµ‹å€¼ã€‚å¦‚ä¸‹ï¼š</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">objects</span> <span class="o">=</span> main.o kbd.o command.o display.o <span class="se">\</span>
    insert.o search.o files.o utils.o
<span class="nl">edit </span><span class="o">:</span> <span class="nf">$(objects)</span>
    <span class="err">cc</span> <span class="err">-o</span> <span class="err">edit</span> <span class="err">$(objects)</span>
<span class="nl">main.o </span><span class="o">:</span> <span class="nf">main.c defs.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">main.c</span>
<span class="nl">kbd.o </span><span class="o">:</span> <span class="nf">kbd.c defs.h command.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">kbd.c</span>
<span class="nl">command.o </span><span class="o">:</span> <span class="nf">command.c defs.h command.h</span>

    <span class="err">cc</span> <span class="err">-c</span> <span class="err">command.c</span>
<span class="nl">display.o </span><span class="o">:</span> <span class="nf">display.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">display.c</span>
<span class="nl">insert.o </span><span class="o">:</span> <span class="nf">insert.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">insert.c</span>
<span class="nl">search.o </span><span class="o">:</span> <span class="nf">search.c defs.h buffer.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">search.c</span>
<span class="nl">files.o </span><span class="o">:</span> <span class="nf">files.c defs.h buffer.h command.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">files.c</span>
<span class="nl">utils.o </span><span class="o">:</span> <span class="nf">utils.c defs.h</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">utils.c</span>
<span class="nl">clean </span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">edit</span> <span class="err">$(objects)</span>
</code></pre></div></div>
<p>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">$(å˜é‡å)</code>æ¥å¯¹å˜é‡è¿›è¡Œä½¿ç”¨ã€‚</p>

<h3 id="35-makefile-çš„è‡ªåŠ¨æ¨å¯¼">3.5 makefile çš„è‡ªåŠ¨æ¨å¯¼</h3>

<p>makefileå¯ä»¥è‡ªåŠ¨æ¨å¯¼æ–‡ä»¶ï¼Œä»¥åŠæ–‡ä»¶ä¾èµ–å…³ç³»åé¢çš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨makefileä¸­çš„è‡ªåŠ¨æ¨å¯¼(çœ‹åˆ°xxx.oå°±ä¼šå°†xxx.cæ–‡ä»¶æ·»åŠ åœ¨ä¾èµ–å…³ç³»ä¸­)ã€‚</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nv">objects</span> <span class="o">=</span> main.o kbd.o command.o display.o <span class="se">\</span>
    insert.o search.o files.o utils.o
<span class="nl">edit </span><span class="o">:</span> <span class="nf">$(objects)</span>
    <span class="err">cc</span> <span class="err">-o</span> <span class="err">edit</span> <span class="err">$(objects)</span>
<span class="nl">main.o </span><span class="o">:</span> <span class="nf">defs.h</span>
<span class="nl">kbd.o </span><span class="o">:</span> <span class="nf">defs.h command.h</span>
<span class="nl">command.o </span><span class="o">:</span> <span class="nf">defs.h command.h</span>
<span class="nl">display.o </span><span class="o">:</span> <span class="nf">defs.h buffer.h</span>
<span class="nl">insert.o </span><span class="o">:</span> <span class="nf">defs.h buffer.h</span>
<span class="nl">search.o </span><span class="o">:</span> <span class="nf">defs.h buffer.h</span>
<span class="nl">files.o </span><span class="o">:</span> <span class="nf">defs.h buffer.h command.h</span>
<span class="nl">utils.o </span><span class="o">:</span> <span class="nf">defs.h</span>
<span class="c">#åˆ«å
</span><span class="nl">.PHONY </span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean </span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">edit</span> <span class="err">$(objects)</span>

<span class="c">#ä¹Ÿå¯ä»¥è¿™æ ·å†™
</span>
<span class="nv">objects</span> <span class="o">=</span> main.o kbd.o command.o display.o <span class="se">\</span>
    insert.o search.o files.o utils.o
<span class="nl">edit </span><span class="o">:</span> <span class="nf">$(objects)</span>
    <span class="err">cc</span> <span class="err">-o</span> <span class="err">edit</span> <span class="err">$(objects)</span>
<span class="nl">$(objects) </span><span class="o">:</span> <span class="nf">defs.h</span>
  <span class="nl">kbd.o command.o files.o </span><span class="o">:</span> <span class="nf">command.h</span>
  <span class="nl">display.o insert.o search.o files.o </span><span class="o">:</span> <span class="nf">buffer.h</span>

<span class="nl">.PHONY </span><span class="o">:</span> <span class="nf">clean</span>

<span class="nl">clean </span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">edit</span> <span class="err">$(objects)</span>
</code></pre></div></div>

<h2 id="4-makefileæ€»è¿°">4 Makefileæ€»è¿°</h2>

<p>Makefileä¸»è¦åŒ…æ‹¬å†…å®¹</p>

<ul>
  <li>æ˜¾å¼è§„åˆ™:ç›´æ¥æ˜æ–‡ä¹¦å†™çš„è§„åˆ™</li>
  <li>éšå¼è§„åˆ™ï¼šè‡ªåŠ¨æ¨å¯¼å‡ºæ¥çš„éšæ™¦è§„åˆ™</li>
  <li>å˜é‡çš„å®šä¹‰:ä¸€ç³»åˆ—å­—ç¬¦ä¸²å˜é‡çš„å®šä¹‰</li>
  <li>æ–‡ä»¶æŒ‡ç¤ºï¼šæ ¹æ®æ¡ä»¶çš„å¤–éƒ¨makefileçš„å¼•ç”¨å¯¼å…¥</li>
  <li>æ³¨é‡Šï¼šè„šæœ¬æ³¨é‡Šæ–‡ä»¶</li>
</ul>

<p>makeæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶é¡ºåºæ˜¯ï¼š</p>

<ul>
  <li>GNUmakefile</li>
  <li>makefile</li>
  <li>Makefile
æ¨èä½¿ç”¨Makefileï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨GNUMakefileå› ä¸ºè¿™ä¸ªåªèƒ½è¢«GNUçš„makeè¯†åˆ«ã€‚
å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">make -f file_name</code>æ¥æŒ‡å®šmakefileæ–‡ä»¶ï¼Œä¾‹å¦‚<code class="language-plaintext highlighter-rouge">make -f Make.Linux</code>ã€‚</li>
</ul>

<p>makefileä¸­å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">include</code>å¼•å…¥å…¶å®ƒmakefileæ–‡ä»¶
æ³¨æ„ï¼šincludeå‰ä¸èƒ½åŠ å…¥[Tab]é”®ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">bar</span><span class="o">=</span>a.mk b.mk c.mk e.mk 

<span class="k">include</span><span class="sx"> foo.make *.mk $(bar)</span>

</code></pre></div></div>
<p>includeçš„æŸ¥æ‰¾è·¯å¾„å¦‚ä¸‹ï¼š</p>

<ul>
  <li>å­˜åœ¨<code class="language-plaintext highlighter-rouge">-I</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">--include-dir</code>å‚æ•°ä¼šåœ¨è¿™ä¸ªå‚æ•°æŒ‡å®šçš„ç›®å½•ä¸‹ç»§ç»­å¯»æ‰¾</li>
  <li>å­˜åœ¨<code class="language-plaintext highlighter-rouge">&lt;prefix&gt;/include</code>å­˜åœ¨ï¼Œmakeä¹Ÿä¼šå»å¯»æ‰¾ã€‚</li>
</ul>

<p>æ³¨æ„ï¼šå½“æ²¡æœ‰æ‰¾åˆ°æ—¶ï¼Œmakeä¼šç”Ÿæˆä¸€æ¡è­¦å‘Šï¼Œå¹¶åœ¨æœ€ç»ˆæ—¶å†æ¬¡å°è¯•å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°å°±æ˜¯errorã€‚å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-include</code>å‘Šè¯‰make <strong>å¿½ç•¥è¿™ä¸ªçš„è¯»å–é”™è¯¯</strong>ï¼Œç›´æ¥ç»§ç»­æ‰§è¡Œã€‚å½“ç„¶ä¸å»ºè®®è¿™æ ·åšã€‚</p>

<p><strong>ç¯å¢ƒå˜é‡</strong></p>

<p>åœ¨å½“å‰çš„ç¯å¢ƒå˜é‡ä¸­å®šä¹‰äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„makeéƒ½ä¼šä½¿ç”¨ï¼Œå› æ­¤å»ºè®®ä¸è¦ä½¿ç”¨ã€‚</p>

<p><strong>makeçš„å·¥ä½œæ–¹å¼</strong></p>

<ol>
  <li>è¯»å…¥æ‰€æœ‰çš„ Makefile ã€‚</li>
  <li>è¯»å…¥è¢« include çš„å…¶å®ƒ Makefile ã€‚</li>
  <li>åˆå§‹åŒ–æ–‡ä»¶ä¸­çš„å˜é‡ã€‚</li>
  <li>æ¨å¯¼éšæ™¦è§„åˆ™,å¹¶åˆ†ææ‰€æœ‰è§„åˆ™ã€‚</li>
  <li>ä¸ºæ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶åˆ›å»ºä¾èµ–å…³ç³»é“¾ã€‚</li>
  <li>æ ¹æ®ä¾èµ–å…³ç³»,å†³å®šå“ªäº›ç›®æ ‡è¦é‡æ–°ç”Ÿæˆã€‚</li>
  <li>æ‰§è¡Œç”Ÿæˆå‘½ä»¤</li>
</ol>

<h3 id="53-åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦">5.3 åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦</h3>

<p>makeä¸shellç›¸åŒæ”¯æŒä¸‰ç§é€šé…ç¬¦å·ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">*</code>:é€šç”¨åŒ¹é…ç¬¦å·ï¼ŒçœŸå®çš„â€™*â€˜å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">\*</code>æ¥è¡¨ç¤º</li>
  <li><code class="language-plaintext highlighter-rouge">?</code>:åˆ¤æ–­ç¬¦å·:</li>
  <li><code class="language-plaintext highlighter-rouge">[...]</code>:</li>
  <li><code class="language-plaintext highlighter-rouge">$@</code>:è¡¨ç¤ºè§„åˆ™ä¸­çš„ç›®æ ‡æ–‡ä»¶é›†ã€‚
    <ul>
      <li>åœ¨æ¨¡å¼è§„åˆ™ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªç›®æ ‡ï¼Œé‚£ä¹ˆï¼Œâ€$@â€å°±æ˜¯åŒ¹é…äºç›®æ ‡ä¸­æ¨¡å¼å®šä¹‰çš„é›†åˆã€‚</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$%</code>:ä»…å½“ç›®æ ‡æ˜¯å‡½æ•°åº“æ–‡ä»¶ä¸­ï¼Œè¡¨ç¤ºè§„åˆ™ä¸­çš„ç›®æ ‡æˆå‘˜åã€‚
    <ul>
      <li>ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç›®æ ‡æ˜¯â€foo.a (bar.o)â€ï¼Œé‚£ä¹ˆï¼Œâ€$%â€å°±æ˜¯â€bar.oâ€ï¼Œâ€$@â€å°±æ˜¯â€foo.aâ€ã€‚å¦‚æœç›®æ ‡ä¸æ˜¯å‡½æ•°åº“æ–‡ä»¶ï¼ˆUnixä¸‹æ˜¯[.a]ï¼ŒWindowsä¸‹æ˜¯ [.lib]ï¼‰ï¼Œé‚£ä¹ˆï¼Œå…¶å€¼ä¸ºç©ºã€‚</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$&lt;</code>:ä¾èµ–ç›®æ ‡ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡åå­—ã€‚
    <ul>
      <li>å¦‚æœä¾èµ–ç›®æ ‡æ˜¯ä»¥æ¨¡å¼ï¼ˆå³â€%â€ï¼‰å®šä¹‰çš„ï¼Œé‚£ä¹ˆâ€$&lt;â€å°†æ˜¯ç¬¦åˆæ¨¡å¼çš„ä¸€ç³»åˆ—çš„æ–‡ä»¶é›†ã€‚æ³¨æ„ï¼Œå…¶æ˜¯ä¸€ä¸ªä¸€ä¸ªå–å‡ºæ¥çš„ã€‚</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$?</code>:æ‰€æœ‰æ¯”ç›®æ ‡æ–°çš„ä¾èµ–ç›®æ ‡çš„é›†åˆã€‚ä»¥ç©ºæ ¼åˆ†éš”ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">$^</code>:æ‰€æœ‰çš„ä¾èµ–ç›®æ ‡çš„é›†åˆã€‚ä»¥ç©ºæ ¼åˆ†éš”ã€‚
    <ul>
      <li>å¦‚æœåœ¨ä¾èµ–ç›®æ ‡ä¸­æœ‰å¤šä¸ªé‡å¤çš„ï¼Œé‚£ä¸ªè¿™ä¸ªå˜é‡ä¼šå»é™¤é‡å¤çš„ä¾èµ–ç›®æ ‡ï¼Œåªä¿ç•™ä¸€ä»½ã€‚</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">$+</code>:è¿™ä¸ªå˜é‡å¾ˆåƒâ€$^â€ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ä¾èµ–ç›®æ ‡çš„é›†åˆã€‚åªæ˜¯å®ƒä¸å»é™¤é‡å¤çš„ä¾èµ–ç›®æ ‡ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">$*</code>:è¿™ä¸ªå˜é‡è¡¨ç¤ºç›®æ ‡æ¨¡å¼ä¸­â€%â€åŠå…¶ä¹‹å‰çš„éƒ¨åˆ†ã€‚
    <ul>
      <li>å¦‚æœç›®æ ‡æ˜¯â€dir/a.foo.bâ€ï¼Œå¹¶ä¸”ç›®æ ‡çš„æ¨¡å¼æ˜¯â€a.%.bâ€ï¼Œé‚£ä¹ˆï¼Œâ€$<em>â€œçš„å€¼å°±æ˜¯â€dir /a.fooâ€ã€‚è¿™ä¸ªå˜é‡å¯¹äºæ„é€ æœ‰å…³è”çš„æ–‡ä»¶åæ˜¯æ¯”è¾ƒæœ‰è¾ƒã€‚å¦‚æœç›®æ ‡ä¸­æ²¡æœ‰æ¨¡å¼çš„å®šä¹‰ï¼Œé‚£ä¹ˆâ€$</em>â€œä¹Ÿå°±ä¸èƒ½è¢«æ¨å¯¼å‡ºï¼Œä½†æ˜¯ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶çš„åç¼€æ˜¯ makeæ‰€è¯†åˆ«çš„ï¼Œé‚£ä¹ˆâ€$<em>â€œå°±æ˜¯é™¤äº†åç¼€çš„é‚£ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šå¦‚æœç›®æ ‡æ˜¯â€foo.câ€ï¼Œå› ä¸ºâ€.câ€æ˜¯makeæ‰€èƒ½è¯†åˆ«çš„åç¼€åï¼Œæ‰€ä»¥ï¼Œâ€$</em>â€œçš„å€¼ å°±æ˜¯â€fooâ€ã€‚è¿™ä¸ªç‰¹æ€§æ˜¯GNU makeçš„ï¼Œå¾ˆæœ‰å¯èƒ½ä¸å…¼å®¹äºå…¶å®ƒç‰ˆæœ¬çš„makeï¼Œæ‰€ä»¥ï¼Œä½ åº”è¯¥å°½é‡é¿å…ä½¿ç”¨â€$<em>â€œï¼Œé™¤éæ˜¯åœ¨éšå«è§„åˆ™æˆ–æ˜¯é™æ€æ¨¡å¼ä¸­ã€‚å¦‚æœç›®æ ‡ä¸­çš„åç¼€æ˜¯makeæ‰€ä¸ èƒ½è¯†åˆ«çš„ï¼Œé‚£ä¹ˆâ€$</em>â€œå°±æ˜¯ç©ºå€¼ã€‚
ä¾‹å¦‚ï¼š</li>
    </ul>
  </li>
</ul>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nl">print</span><span class="o">:</span><span class="nf">*.c</span>
    <span class="err">lpr</span> <span class="err">-p</span> <span class="err">$?</span>
    <span class="err">touch</span> <span class="err">print</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$(@D)</code>:è¡¨ç¤º<code class="language-plaintext highlighter-rouge">$@</code>çš„ç›®å½•éƒ¨åˆ†ï¼Œå¦‚æœ â€œ$@â€ å€¼æ˜¯ â€œdir/foo.oâ€ ,é‚£ä¹ˆ â€œ$(@D)â€ å°±æ˜¯ â€œdirâ€ ,è€Œå¦‚æœ â€œ$@â€ ä¸­æ²¡æœ‰åŒ…å«æ–œæ çš„è¯,å…¶å€¼å°±æ˜¯ â€œ.â€ (å½“å‰ç›®å½•)ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">$(@F)</code>:è¡¨ç¤º<code class="language-plaintext highlighter-rouge">$@</code>çš„æ–‡ä»¶éƒ¨åˆ†ã€‚
å‰©ä¸‹çš„$(æ“ä½œç¬¦D)å’Œ$(æ“ä½œç¬¦F)åŠŸèƒ½ä¸€æ¬¡ç±»æ¨ã€‚</li>
</ul>

<h3 id="54æ–‡ä»¶æŸ¥è¯¢">5.4æ–‡ä»¶æŸ¥è¯¢</h3>

<p>makefileä¸­å¯ä»¥ä½¿ç”¨VPATHæ¥æŒ‡å®šæ–‡ä»¶æŸ¥æ‰¾ç›®å½•ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<ul>
  <li>1.vpath <pattern> <directories>:ä¸ºç¬¦åˆæ¨¡å¼<pattern>çš„æ–‡ä»¶æŒ‡å®šæœç´¢ç›®å½•<directories>ã€‚</directories></pattern></directories></pattern></li>
  <li>2.vpath <pattern> ï¼šæ¸…é™¤ç¬¦åˆæ¨¡å¼<pattern>çš„æ–‡ä»¶çš„æœç´¢ç›®å½•ã€‚</pattern></pattern></li>
  <li>vpath:æ¸…é™¤æ‰€æœ‰å·²ç»è¢«è®¾ç½®å¥½äº†çš„æ–‡ä»¶æœç´¢ç›®å½•</li>
</ul>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#æŒ‡å®šæ–‡ä»¶æœç´¢åœ¨../headerså’Œå½“å‰ç›®å½•ä¸‹ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ä»¥`.h`ç»“å°¾çš„æ–‡ä»¶
</span>
<span class="err">vpath</span> <span class="err">%.h</span> <span class="err">../headers</span>
<span class="c">#è¿™é‡Œæ˜¯å…ˆåœ¨fooä¸­æœç´¢ï¼Œç„¶ååœ¨blish,æœ€åæ˜¯bar
</span>
<span class="nl">vpath %.c foo</span><span class="o">:</span><span class="nf">bar</span>
<span class="err">vpath</span> <span class="err">%</span> <span class="err">blish</span>
</code></pre></div></div>

<h3 id="55-ä¼ªç›®æ ‡">5.5 ä¼ªç›®æ ‡</h3>

<p>makefileä¸­å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">.PHONY:xxx</code>çš„æ–¹å¼æ¥è®¾ç½®ä¼ªç›®æ ‡ï¼Œç±»ä¼¼äºshellä¸­çš„<code class="language-plaintext highlighter-rouge">alias</code>æ“ä½œåˆ«å
ä¼ªç›®æ ‡ä¸€èˆ¬æ²¡æœ‰ä¾èµ–æ–‡ä»¶ï¼Œä¸»è¦æ˜¯ç›¸å…³æ“ä½œã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¾èµ–æ¥åŒ–ç®€æ“ä½œã€‚</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">all</span><span class="o">:</span><span class="nf">prog1 prog2 prog3</span>
<span class="nl">.PHONY</span><span class="o">:</span><span class="nf">all</span>

<span class="nl">prog1</span><span class="o">:</span><span class="nf">prog1.o utils.o</span>
        <span class="err">cc</span> <span class="err">-o</span> <span class="err">prog1</span> <span class="err">prog1.o</span> <span class="err">utils.o</span>
<span class="nl">prog2</span><span class="o">:</span><span class="nf">...</span>

<span class="c">#ä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ªç›®æ ‡ä½œä¸ºä¾èµ–ï¼Œå®ç°æ“ä½œå¦‚ä¸‹
</span><span class="nl">cleanall </span><span class="o">:</span> <span class="nf">cleanobj cleandiff</span>
    <span class="err">rm</span> <span class="err">program</span>
<span class="nl">cleanobj</span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">*.o</span>
<span class="nl">cleandiff</span><span class="o">:</span>
    <span class="err">rm</span> <span class="err">*.diff</span>

</code></pre></div></div>
<p>å› ä¸ºmakefileä¼šå°†ç¬¬ä¸€ä¸ªç›®æ ‡ä½œä¸ºé»˜è®¤ç›®æ ‡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¼ªç›®æ ‡ä¾èµ–ï¼Œæ¥å®ç°makefileçš„å¤šç›®æ ‡ä¾èµ–ã€‚</p>

<h3 id="57-é™æ€æ¨¡å¼">5.7 é™æ€æ¨¡å¼</h3>

<p>ä½¿ç”¨é™æ€æ¨¡å¼å¯ä»¥æ›´åŠ å®¹æ˜“åœ°å®šä¹‰å¤šç›®æ ‡çš„è§„åˆ™ã€‚ä½¿ç”¨è¯­æ³•å¦‚ä¸‹</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">&lt;targets ...&gt;</span><span class="o">:</span> <span class="nf">&lt;target-pattern&gt;: &lt;prereq-patterns ...&gt;</span>
    <span class="err">&lt;commands&gt;</span>
    <span class="err">...</span>

</code></pre></div></div>
<p>target:å®šä¹‰äº†ä¸€ç³»åˆ—ç›®æ ‡ï¼Œå¯ä»¥æœ‰é€šé…ç¬¦ï¼Œæ˜¯ç›®æ ‡çš„é›†åˆ
target-pattern:æŒ‡æ˜äº†targetçš„æ¨¡å¼ï¼Œä¹Ÿæ˜¯ç›®æ ‡é›†æ¨¡å¼
prereq-patterns:æ˜¯ç›®æ ‡ä¾èµ–æ¨¡å¼å¯¹target-patternçš„å†æ¬¡ä¾èµ–å®šä¹‰</p>

<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nv">objects</span> <span class="o">=</span> foo.o bar.o
    <span class="nl">all</span><span class="o">:</span> <span class="nf">$(objects)</span>

<span class="c">#å°†åç¼€ä¸­çš„.oå˜ä¸º.c
</span>
<span class="nl">$(objects)</span><span class="o">:</span> <span class="nf">%.o: %.c</span>
    <span class="err">$(CC)</span> <span class="err">-c</span> <span class="err">$(CFLAGS)</span> <span class="err">$&lt;</span> <span class="err">-o</span> <span class="err">$@</span>
    <span class="c"># $(CC) -c $(CFLAGS) foo.c bar.c -o foo.o bar.o
</span>
</code></pre></div></div>

<h3 id="58-è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§">5.8 è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§</h3>

<p>gccä¸­å¯ä»¥ä½¿ç”¨-Mç¼–è¯‘é€‰é¡¹å¼€å¯è‡ªåŠ¨ä¾èµ–æŸ¥æ‰¾ã€‚</p>

<h2 id="6-ä¹¦å†™å‘½ä»¤">6 ä¹¦å†™å‘½ä»¤</h2>
<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">@</code>åœ¨å‘½ä»¤å‰ï¼Œè¿™ä¸ªå‘½ä»¤å°†ä¸ä¼šè¢«makeæ˜¾ç¤ºå‡ºæ¥ã€‚ä¾‹å¦‚:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">@echo</span> <span class="err">æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—</span>
<span class="c">#è¾“å‡ºï¼šæ­£åœ¨ç¼–è¯‘XXXæ¨¡å—
</span>
<span class="err">echo</span> <span class="err">æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—</span>
<span class="c">#è¾“å‡ºï¼š
</span>
<span class="c">#    echo æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—
</span>
<span class="c">#   æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—
</span>
</code></pre></div></div>

<p>å¯ä»¥åœ¨makeåé¢å¸¦å…¥å‚æ•°<code class="language-plaintext highlighter-rouge">-n</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">--just-print</code>ï¼Œåªæ‰§è¡Œæ˜¾ç¤ºå‘½ä»¤ï¼Œä½†æ˜¯ä¸ä¼šæ‰§è¡Œå‘½ä»¤ã€‚æ–¹ä¾¿å¯¹Makefileè¿›è¡Œè°ƒè¯•ã€‚</p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-s</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">--slient</code>åˆ™æ˜¯å…¨é¢ç¦æ­¢å‘½ä»¤çš„æ˜¾ç¤ºã€‚</p>

<h3 id="62-å‘½ä»¤æ‰§è¡Œ">6.2 å‘½ä»¤æ‰§è¡Œ</h3>

<p>makefileä¸­çš„å‘½ä»¤ä¼šï¼Œä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œå…¶åé¢çš„çš„å‘½ä»¤ï¼Œå½“éœ€è¦ä¸Šä¸€å‘½ä»¤ç»“æœåº”ç”¨åœ¨ä¸‹ä¸€å‘½ä»¤æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åˆ†å·ï¼Œåˆ†å‰²ç›¸å…³å‘½ä»¤ã€‚å½“å‘½ä»¤ç›¸å…³è”æ—¶ï¼Œåº”è¯¥å†™åœ¨ä¸€è¡Œä¸Šã€‚</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nl">exec</span><span class="o">:</span>
    <span class="err">cd</span> <span class="err">/home/</span>
    <span class="err">pwd</span>
<span class="c"># æ‰“å°æ‰§è¡Œæ–‡ä»¶å¤¹è·¯å¾„ï¼Œcdæ— ä½œç”¨ã€‚
</span>
<span class="nl">exec</span><span class="o">:</span>
    <span class="err">cd</span> <span class="err">/home/;pwd</span>
<span class="c"># æ‰“å° /home/ cd æœ‰ä½œç”¨
</span></code></pre></div></div>

<h3 id="63-å‘½ä»¤é”™è¯¯">6.3 å‘½ä»¤é”™è¯¯</h3>
<p>makeä¸­å‘½ä»¤é”™è¯¯ä¼šç«‹å³åœæ­¢æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ï¼Œä½¿ç”¨make cleanè¿›è¡Œé‡æ–°çš„make; å¯ä»¥åœ¨å‘½ä»¤å‰ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-</code>æˆ–è€…æ·»åŠ makeçš„<code class="language-plaintext highlighter-rouge">-i/ignore-errors</code>å‚æ•°å®ç°å¿½ç•¥é”™è¯¯ã€‚å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-k/--keep-going</code>ä¿è¯makeè¡Œä¸ºä¸åœæ­¢ã€‚</p>

<h3 id="64-makeçš„åµŒå¥—æ‰§è¡Œ">6.4 makeçš„åµŒå¥—æ‰§è¡Œ</h3>

<p>å¯ä»¥ä½¿ç”¨shellçš„è„šæœ¬è®¿é—®ï¼Œæ‰§è¡Œå­ç›®å½•ä¸­çš„makeï¼Œå¯¹ä¸æ–¹ä¾¿ç¬¬ä¸‰æ–¹ä¾èµ–çš„å•ç‹¬ç¼–è¯‘ã€‚</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">subsystem</span><span class="o">:</span>
    <span class="err">cd</span> <span class="err">subdir</span> <span class="err">&amp;&amp;</span> <span class="err">$(MAKE)</span>
<span class="c">#ç­‰ä»·äº
</span>
<span class="nl">subsystem</span><span class="o">:</span>
    <span class="err">$(MAKE)</span> <span class="err">-C</span> <span class="err">subdir</span>
</code></pre></div></div>
<p>ä½¿ç”¨export å’Œunexportæ¥è¿›è¡Œå˜é‡çš„ä¸‹çº§ä¼ é€’å’Œä½¿ç”¨ã€‚</p>

<p>æ³¨æ„ï¼š</p>
<ul>
  <li>SHELLå’ŒMAKEFLAGSæ˜¯ä¸€å®šä¼šä¼ é€’åˆ°ä¸‹ä¸€å±‚Makefileä¸­çš„ã€‚</li>
  <li>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-w/--print-directory</code>ï¼›è¾“å‡ºä¿¡æ¯ï¼Œè®©ä½ çœ‹åˆ°å½“å‰çš„å·¥ä½œç›®å½•ã€‚</li>
</ul>

<h3 id="65-å®šä¹‰å‘½ä»¤åŒ…">6.5 å®šä¹‰å‘½ä»¤åŒ…</h3>

<p>Makefileä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒå‘½ä»¤åºåˆ—æ¥å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚ä»¥<code class="language-plaintext highlighter-rouge">define</code>å¼€å§‹,<code class="language-plaintext highlighter-rouge">endef</code>ç»“æŸã€‚ä¾‹å¦‚:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">define</span> <span class="err">run-yacc</span>
<span class="err">yacc</span> <span class="err">$(firstword</span> <span class="err">$^)</span>
<span class="err">mv</span> <span class="err">y.tab.c</span> <span class="err">$@</span>
<span class="err">endef</span>
</code></pre></div></div>

<h2 id="7-ä½¿ç”¨å˜é‡">7 ä½¿ç”¨å˜é‡</h2>

<p>makefileä¸­çš„å˜é‡ï¼Œå¯ä»¥æ˜¯æ•°å­—å¼€å¤´ï¼Œä½†ä¸åº”è¯¥å«æœ‰<code class="language-plaintext highlighter-rouge">:</code>ã€<code class="language-plaintext highlighter-rouge">#</code>ã€<code class="language-plaintext highlighter-rouge">=</code>æˆ–æ˜¯ç©ºå­—ç¬¦(ç©ºæ ¼ã€å›è½¦ç­‰)ã€‚å¹¶ä¸”å˜é‡çš„å¤§å°å†™æ•æ„Ÿã€‚</p>

<h3 id="71-å˜é‡åŸºç¡€">7.1 å˜é‡åŸºç¡€</h3>

<p>å¯ä»¥å®šä¹‰å˜é‡ï¼Œå¹¶ç”¨<code class="language-plaintext highlighter-rouge">${å˜é‡å}/$(å˜é‡å)</code>æ¥ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥ç²¾ç¡®ä½¿ç”¨å’Œå±•å¼€ï¼Œå­—ç¬¦ä¸²ä¹‹é—´çš„é“¾æ¥ç­‰ã€‚</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">foo</span><span class="o">=</span>c
<span class="nl">prog.o</span><span class="o">:</span><span class="nf">prog.$(foo)</span>
    <span class="err">$(foo)$(foo)</span> <span class="err">-$(foo)</span> <span class="err">prog.$(foo)</span>

<span class="c">#ç¿»è¯‘ç»“æœ
</span>
<span class="nl">prog.o </span><span class="o">:</span> <span class="nf">prog.c</span>
    <span class="err">cc</span> <span class="err">-c</span> <span class="err">prog.c</span>
</code></pre></div></div>

<h3 id="72-å˜é‡ä¸­çš„å˜é‡">7.2 å˜é‡ä¸­çš„å˜é‡</h3>

<p>makefileä¸­çš„å˜é‡ï¼Œä¸åƒc++éœ€è¦é¢„å…ˆå£°æ˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œåªè¦makeèƒ½åœ¨åé¢æ‰¾åˆ°å°±è¡Œäº†ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“å¼•èµ·åµŒå¥—çš„å¾ªç¯ä½¿ç”¨ã€‚</p>

<p>å˜é‡çš„èµ‹å€¼</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">æ“ä½œ</th>
      <th style="text-align: left">å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">=</code></td>
      <td style="text-align: left">å˜é‡çš„ç›´æ¥èµ‹å€¼,å¯ä»¥ä½¿ç”¨åé¢å®šä¹‰çš„å˜é‡</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">:=</code></td>
      <td style="text-align: left">èµ‹å€¼æ“ä½œï¼Œå‰é¢çš„å˜é‡ä¸èƒ½ä½¿ç”¨åé¢çš„å˜é‡ï¼Œåªèƒ½ä½¿ç”¨å‰é¢å·²ç»å®šä¹‰å¥½äº†çš„å˜é‡</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">?=</code></td>
      <td style="text-align: left">å¦‚ç™¾å¹´æ¥é‚£ä¸ªæ²¡æœ‰è¢«å®šä¹‰è¿‡ï¼Œåˆ™è¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœäº‹å…ˆè¢«å®šä¹‰è¿‡ï¼Œå°±ä»€ä¹ˆéƒ½ä¸åš</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">+=</code></td>
      <td style="text-align: left">è¿½åŠ å˜é‡ï¼Œç»™å˜é‡<code class="language-plaintext highlighter-rouge">+=</code>æ“ä½œï¼Œå¯ä»¥è¿½åŠ æ–°çš„å˜é‡</td>
    </tr>
  </tbody>
</table>

<p>æ³¨æ„ï¼šè°¨æ…ä½¿ç”¨<code class="language-plaintext highlighter-rouge">#</code>æ³¨é‡Šï¼Œåœ¨è¡Œåç›´æ¥æ³¨é‡Šæ— <code class="language-plaintext highlighter-rouge">\n</code>æ¢è¡Œç¬¦æ—¶ï¼Œä¼šå¼•èµ·å˜é‡ä¸­å­˜åœ¨å¤šä½™çš„ç©ºæ ¼ï¼›ä¾‹å¦‚<code class="language-plaintext highlighter-rouge">dir := /foo/bar # directory to put the frobs in</code>ä¸­dirä¼šå¤š4ä¸ªç©ºæ ¼ã€‚</p>

<h3 id="73-å˜é‡çš„é«˜çº§ç”¨æ³•">7.3 å˜é‡çš„é«˜çº§ç”¨æ³•</h3>

<ul>
  <li>å˜é‡çš„æ›¿æ¢ï¼šæ›¿æ¢å˜é‡ä¸­çš„å…±æœ‰çš„éƒ¨åˆ†ï¼Œæ ¼å¼æ˜¯<code class="language-plaintext highlighter-rouge">$(var:a=b)</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">${var:a=b}</code>æŠŠå˜é‡<code class="language-plaintext highlighter-rouge">var</code>ä¸­æ‰€æœ‰ä»¥å­æ²¡æœ‰<code class="language-plaintext highlighter-rouge">a</code>ç»“å°¾(ç©ºæ ¼æˆ–è€…ç»“æŸç¬¦)çš„<code class="language-plaintext highlighter-rouge">a</code>æ¢æˆ<code class="language-plaintext highlighter-rouge">b</code>ã€‚è¿™æ ·å°±å¯ä»¥æ‰§è¡Œç®€å•çš„å˜é‡æ›¿æ¢ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo:=a.o b.o c.o
bar:=$(foo:.o=.c)

#baræ˜¯a.c b.c c.c
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€æ¨¡å¼è¿›è¡Œæ›¿æ¢ã€‚</p>

<ul>
  <li>å°†å˜é‡å€¼ä½œä¸ºå˜é‡ï¼šå°†å˜é‡ç»“æœä½œä¸ºå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œè·å–æ–°å˜é‡çš„åç§°ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x=y
y=z
a:=$($(x))
#æœ€ç»ˆaçš„ç»“æœæ˜¯z

</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥è¿›è¡Œå¤šå±‚æ¬¡çš„åµŒå¥—ã€‚</p>

<h3 id="75-override-æŒ‡ç¤ºç¬¦å·">7.5 override æŒ‡ç¤ºç¬¦å·</h3>

<p>å¦‚æœå˜é‡æ˜¯é€šè¿‡makeçš„å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œè®¾ç½®çš„ï¼Œé‚£ä¹ˆMakefileä¸­å¯¹è¿™ä¸ªå˜é‡çš„èµ‹å€¼å°†ä¼šè¢«å¿½ç•¥ã€‚å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">override</code>æŒ‡ç¤ºç¬¦ï¼Œåœ¨Makefileä¸­è®¾ç½®è¿™ç±»å‚æ•°çš„å€¼ï¼Œè¿›è¡Œé‡è½½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>override &lt;variable&gt;=&lt;value&gt;
override &lt;variable&gt;:=&lt;value&gt;
override &lt;variable&gt;+=&lt;value&gt;
</code></pre></div></div>

<h3 id="76-å¤šè¡Œå˜é‡">7.6 å¤šè¡Œå˜é‡</h3>

<p>ä½¿ç”¨defineå…³é”®å­—è®¾ç½®å˜é‡çš„å€¼å¯ä»¥æ¢è¡Œï¼Œåªè¦defineæ²¡æœ‰ä½¿ç”¨[Tab]å¼€å¤´ï¼Œé‚£ä¹ˆmakeå°±ä¸ä¼šæŠŠå…¶è®¤ä¸ºæ˜¯å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define two-lines
echo foo
echo ${bar}
endef
</code></pre></div></div>

<h3 id="77-ç¯å¢ƒå˜é‡">7.7 ç¯å¢ƒå˜é‡</h3>

<p>makeè¿è¡Œæ—¶ï¼Œç³»ç»Ÿç¯å¢ƒå˜é‡å¯è¢«è½½å…¥åˆ°Makefileæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¦‚æœMakefileå·²ç»å®šä¹‰ï¼Œåˆ™ä¼šè¢«è¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-e</code>å‚æ•°æ–¹å¼ç³»ç»Ÿç¯å¢ƒå˜é‡è¢«è¦†ç›–ã€‚</p>

<p>åµŒå¥—è°ƒç”¨æ—¶ï¼Œä¸Šå±‚å˜é‡ä¼šä»¥ç³»ç»Ÿç¯å¢ƒå˜é‡çš„æ–¹å¼ä¼ é€’åˆ°ä¸‹å±‚Makefileã€‚é»˜è®¤æƒ…å†µåªæœ‰é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®çš„å˜é‡ä¼šè¢«ä¼ é€’ã€‚å®šä¹‰åœ¨æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œéœ€è¦ä½¿ç”¨exportå…³é”®å­—æ¥å£°æ˜ã€‚</p>

<h3 id="78-ç›®æ ‡å˜é‡">7.8 ç›®æ ‡å˜é‡</h3>

<p>å¯ä»¥é€šè¿‡ä¼ªç›®æ ‡æ ‡ç­¾ï¼Œè®¾ç½®ç›®æ ‡å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ªå˜é‡å¯ä»¥é¢å…¨å±€å˜é‡åŒåï¼Œå› ä¸ºå®ƒçš„ä½œç”¨èŒƒå›´åªåœ¨è¿™æ¡è§„åˆ™ä»¥åŠè¿å¸¦è§„åˆ™ä¸­ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;target ...&gt;:&lt;variable-assignment&gt;
&lt;target ...&gt;:overide &lt;variable-assignment&gt;
</code></pre></div></div>

<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">all</span><span class="o">:</span> <span class="nf">tran test test2</span>
<span class="nv">my_test</span><span class="o">:=</span>/usr/binb
<span class="nv">my_test</span><span class="o">:=</span><span class="nv">${my_test:inb=a}</span> /usr/include/boost 
<span class="nl">tran</span><span class="o">:</span>
    <span class="err">@echo</span> <span class="s2">"hello word"</span>
<span class="nl">test2</span><span class="o">:</span><span class="nf">my_test=test2</span>
<span class="nl">test2</span><span class="o">:</span>
    <span class="err">echo</span> <span class="err">${my_test}</span>
<span class="nl">test</span><span class="o">:</span>
    <span class="err">echo</span> <span class="s2">"test"</span><span class="err">;echo</span> <span class="err">$(SHELL)</span> <span class="err">;echo</span> <span class="err">$(MAKEFLAGS)</span> <span class="err">echo</span> <span class="err">${my_test}</span>

<span class="c">#result
</span><span class="err">hello</span> <span class="err">word</span>
<span class="err">echo</span> <span class="s2">"test"</span><span class="err">;echo</span> <span class="err">/bin/sh</span> <span class="err">;echo</span>  <span class="err">echo</span> <span class="err">/usr/ba</span> <span class="err">/usr/include/boost</span> 
<span class="err">test</span>
<span class="err">/bin/sh</span>
<span class="err">echo</span> <span class="err">/usr/ba</span> <span class="err">/usr/include/boost</span>
<span class="err">echo</span> <span class="err">test2</span>
<span class="err">test2</span>

</code></pre></div></div>

<h3 id="79-æ¨¡å¼å˜é‡">7.9 æ¨¡å¼å˜é‡</h3>

<p>åœ¨GNUçš„makeä¸­è¿˜æ”¯æŒæ¨¡å¼å˜é‡ï¼Œä½¿ç”¨ä¸€ç§æ¨¡å¼ï¼Œåœ¨æ¨¡å¼ä¸­å®šä¹‰å˜é‡ï¼Œä½¿å¾—å˜é‡å¯ä»¥æ ¹æ®æ¨¡å¼è¿›è¡Œåˆ¤æ–­èµ‹å€¼ã€‚ä½¿ç”¨æ ¼å¼å’Œç›®æ ‡å˜é‡ç›¸åŒï¼Œä¾‹å¦‚ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%.o:CFLAGS = -O
</code></pre></div></div>

<h2 id="8-ä½¿ç”¨æ¡ä»¶åˆ¤æ–­">8 ä½¿ç”¨æ¡ä»¶åˆ¤æ–­</h2>

<p>ä½¿ç”¨æ¡ä»¶åˆ¤æ–­æ ¹æ®ä¸åŒçš„åˆ†ææƒ…å†µé€‰æ‹©æ‰§è¡Œåˆ†æ”¯ã€‚</p>

<p>ä¸‹é¢æ˜¯æ ¹æ®ç¼–è¯‘å™¨é€‰æ‹©ç›¸å…³ç¼–è¯‘å‚æ•°</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">libs_for_gcc</span><span class="o">=</span><span class="nt">-lgnu</span>
<span class="nv">normal_libs</span><span class="o">=</span>
<span class="nl">foo</span><span class="o">:</span><span class="nf">$(objects)</span>
<span class="c">#åˆ¤æ–­ç¼–è¯‘å™¨ç±»å‹
</span>
<span class="err">ifeq($(CC),gcc)</span>
    <span class="err">$(CC)</span> <span class="err">-o</span> <span class="err">foo</span> <span class="err">$(objects)</span> <span class="err">$(libs_for_gcc)</span>
<span class="k">else</span>
    <span class="err">$(CC)</span> <span class="err">-o</span> <span class="err">foo</span> <span class="err">$(object)</span> <span class="err">$(normal_libs)</span>
<span class="k">endif</span>
</code></pre></div></div>

<p>åˆ¤æ–­è¯­å¥çš„åŸºæœ¬è¯­æ³•æ˜¯ï¼š</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&lt;conditional-directive&gt;</span>
<span class="err">&lt;text-if-true&gt;</span>
<span class="k">endif</span>
<span class="c">#æˆ–è€…
</span>
<span class="err">&lt;conditional-directive&gt;</span>
<span class="err">&lt;text-if-true&gt;</span>
<span class="k">else</span>
<span class="err">&lt;text-if-false&gt;</span>
<span class="k">endif</span>

</code></pre></div></div>
<p>æ¡ä»¶åˆ¤æ–­æ˜¯ifeqæˆ–è€…ifneqã€ifdefå’Œifndef</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifeq(&lt;arg1&gt;,&lt;arg2&gt;)
ifeq '&lt;arg1&gt;' '&lt;arg2&gt;'
ifeq "&lt;arg1&gt;" "&lt;arg2&gt;"
ifeq "&lt;arg1&gt;" '&lt;arg2&gt;'
ifeq '&lt;arg1&gt;' "&lt;arg2&gt;"
#è¿˜å¯ä»¥è¿™æ ·åˆ¤æ–­

ifeq ($(strip $(foo)),)
&lt;text-if-empty&gt;
endif
</code></pre></div></div>

<p>ifneq:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ifneq</span> <span class="nv">(&lt;arg1&gt;, &lt;arg2&gt;)</span>
<span class="k">ifneq</span> <span class="nv">'&lt;arg1&gt;' '&lt;arg2&gt;'</span>
<span class="k">ifneq</span> <span class="nv">"&lt;arg1&gt;" "&lt;arg2&gt;"</span>
<span class="k">ifneq</span> <span class="nv">"&lt;arg1&gt;" '&lt;arg2&gt;'</span>
<span class="k">ifneq</span> <span class="nv">'&lt;arg1&gt;' "&lt;arg2&gt;"</span>
</code></pre></div></div>

<p>ifdefå’Œifndef</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifdef &lt;variable-name&gt;
endif

ifndef &lt;variable-name&gt;
endif
</code></pre></div></div>

<h2 id="9-ä½¿ç”¨å‡½æ•°">9 ä½¿ç”¨å‡½æ•°</h2>

<p>Makefileå¯ä»¥ä½¿ç”¨å‡½æ•°æ¥å¤„ç†å˜é‡ï¼Œå˜é‡ä»¥<code class="language-plaintext highlighter-rouge">$</code>è¿›è¡Œæ ‡è¯†ï¼Œå…¶åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(&lt;function&gt; &lt;arguments&gt;)
#æˆ–è€…

${&lt;function&gt; &lt;arguments&gt;}

</code></pre></div></div>

<p>ä¸­é—´å‚æ•°ä»¥<code class="language-plaintext highlighter-rouge">,</code>è¿›è¡Œåˆ†å‰²ã€‚
ä¸ºäº†é£æ ¼ç»Ÿä¸€ï¼Œå»ºè®®éƒ½ä½¿ç”¨<code class="language-plaintext highlighter-rouge">()</code>çš„æ–¹å¼ï¼›å¦‚ï¼š<code class="language-plaintext highlighter-rouge">$(subst a,b,$(x))</code></p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">comma</span><span class="o">:=</span>,
<span class="nv">empty</span><span class="o">:=</span>
<span class="nv">space</span><span class="o">:=</span><span class="nv">$(empty)</span> <span class="nv">$(empty)</span>
<span class="nv">foo</span><span class="o">:=</span>a b c
<span class="nv">bar</span><span class="o">:=</span><span class="nf">$(</span><span class="nb">subst</span> <span class="nv">$(space)</span>,<span class="nv">$(comma)</span>,<span class="nv">$(foo)</span><span class="nf">)</span>
</code></pre></div></div>
<p>ä¸Šé¢çš„å‡½æ•°æ˜¯æŒ‡ï¼Œå°†$(foo)ä¸­çš„$(space)å…¨éƒ¨æ›¿æ¢æˆä¸º$(comma)ã€‚
æœ€ç»ˆ$(bar)çš„ç»“æœæ˜¯â€a,b,câ€ã€‚</p>

<h3 id="92-å­—ç¬¦ä¸²å¤„ç†å‡½æ•°">9.2 å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">å‡½æ•°åç§°</th>
      <th style="text-align: left">å‡½æ•°</th>
      <th style="text-align: left">åŠŸèƒ½</th>
      <th style="text-align: left">è¿”å›</th>
      <th style="text-align: left">ç¤ºä¾‹</th>
      <th style="text-align: left">æ³¨æ„</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">subst</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(subst &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">æŠŠå­—ä¸² <text> ä¸­çš„ <from> å­—ç¬¦ä¸²æ›¿æ¢æˆ <to></to></from></text></td>
      <td style="text-align: left">å‡½æ•°è¿”å›è¢«æ›¿æ¢è¿‡åçš„å­—ç¬¦ä¸²</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(subst ee,EE,feet on the street)</code></td>
      <td style="text-align: left">Â </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">patsubst</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(patsubst &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">æŸ¥æ‰¾å…¶ä¸­çš„åŒ¹é…å­—ç¬¦ä¸²å¹¶æ›¿æ¢</td>
      <td style="text-align: left">æ›¿æ¢è¿‡åçš„å­—ç¬¦ä¸²</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(patsubst %.c,%.o,x.c.c bar.c)</code></td>
      <td style="text-align: left">Â </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">strip</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(strip &lt;string&gt;)</code></td>
      <td style="text-align: left">å»æ‰<string>å­—ç¬¦ä¸²ä¸­å¼€å¤´å’Œç»“å°¾çš„ç©ºå­—ç¬¦ä¸²</string></td>
      <td style="text-align: left">è¿”å›å»é™¤çš„å€¼</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(strip a b c )</code></td>
      <td style="text-align: left">ç¤ºä¾‹ä¸­å»é™¤äº†ç»“å°¾çš„ä¸€ä¸ªç©ºæ ¼</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">findstring</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(findstring &lt;find&gt;,&lt;in&gt;)</code></td>
      <td style="text-align: left">åœ¨å­—ä¸² <in> ä¸­æŸ¥æ‰¾ <find> å­—ä¸²ã€‚</find></in></td>
      <td style="text-align: left">å¦‚æœæ‰¾åˆ°,é‚£ä¹ˆè¿”å› <find> ,å¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</find></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(findstring a,a b c)</code></td>
      <td style="text-align: left">ç¤ºä¾‹è¿”å›â€aâ€å­—ç¬¦ä¸²</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">filter</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(filter &lt;pattern...&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">ä»¥ <pattern> æ¨¡å¼è¿‡æ»¤ <text> å­—ç¬¦ä¸²ä¸­çš„å•è¯,ä¿ç•™ç¬¦åˆæ¨¡å¼ <pattern> çš„å•è¯ã€‚å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼ã€‚</pattern></text></pattern></td>
      <td style="text-align: left">è¿”å›ç¬¦åˆæ¨¡å¼ <pattern> çš„å­—ä¸²ã€‚</pattern></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(filter %.c %.s,foo.c bar.c baz.s ugh.h)</code></td>
      <td style="text-align: left">ç¤ºä¾‹è¿”å›å€¼æ˜¯<code class="language-plaintext highlighter-rouge">foo.c bar.c baz.s</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">filter-out</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(filter-out &lt;pattern...&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">ä»¥ <pattern> æ¨¡å¼è¿‡æ»¤ <text> å­—ç¬¦ä¸²ä¸­çš„å•è¯,å»é™¤ç¬¦åˆæ¨¡å¼ <pattern> çš„å•è¯ã€‚å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼ã€‚</pattern></text></pattern></td>
      <td style="text-align: left">è¿”å›ä¸ç¬¦åˆæ¨¡å¼ <pattern> çš„å­—ä¸²ã€‚</pattern></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(filter-out main1.o main2.o,main1.o foo.o main2.o bar.o)</code></td>
      <td style="text-align: left">è¿”å›å€¼æ˜¯<code class="language-plaintext highlighter-rouge">foo.o bar.o</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">sort</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(sort &lt;list&gt;)</code></td>
      <td style="text-align: left">ç»™å­—ç¬¦ä¸² <list> ä¸­çš„å•è¯æ’åº(å‡åº)ã€‚</list></td>
      <td style="text-align: left">è¿”å›æ’åºåçš„å­—ç¬¦ä¸²ã€‚</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(sort foo bar lose)</code>è¿”å›<code class="language-plaintext highlighter-rouge">bar foo lose</code></td>
      <td style="text-align: left">sort å‡½æ•°ä¼šå»æ‰ <list> ä¸­ç›¸åŒçš„å•è¯ã€‚</list></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">word</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(word &lt;n&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">å–å­—ç¬¦ä¸² <text> ä¸­ç¬¬ <n> ä¸ªå•è¯ã€‚(ä»ä¸€å¼€å§‹)</n></text></td>
      <td style="text-align: left">è¿”å›å­—ç¬¦ä¸² <text> ä¸­ç¬¬ <n> ä¸ªå•è¯ã€‚å¦‚æœ <n> æ¯” <text> ä¸­çš„å•è¯æ•°è¦å¤§,é‚£ä¹ˆè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</text></n></n></text></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(word 2, foo bar baz)</code></td>
      <td style="text-align: left">ç¤ºä¾‹è¿”å›å€¼æ˜¯â€barâ€</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">wordlist</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(wordlist &lt;s&gt;,&lt;e&gt;,&lt;text&gt;)</code></td>
      <td style="text-align: left">å­—ç¬¦ä¸² <text> ä¸­å–ä» <s> å¼€å§‹åˆ° <e> çš„å•è¯ä¸²ã€‚ <s> å’Œ <e> æ˜¯ä¸€ä¸ªæ•°å­—</e></s></e></s></text></td>
      <td style="text-align: left">è¿”å›å­—ç¬¦ä¸² <text> ä¸­ä» <s> åˆ° <e> çš„å•è¯å­—ä¸²ã€‚å¦‚æœ <s> æ¯” <text> ä¸­çš„å•è¯æ•°è¦å¤§,é‚£ä¹ˆè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚å¦‚æœ <e> å¤§äº <text> çš„å•è¯æ•°,é‚£ä¹ˆè¿”å›ä» <s> å¼€å§‹,åˆ° <text> ç»“æŸçš„å•è¯ä¸²</text></s></text></e></text></s></e></s></text></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(wordlist 2, 3, foo bar baz)</code></td>
      <td style="text-align: left">è¿”å›å€¼æ˜¯<code class="language-plaintext highlighter-rouge">bar baz</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">words</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(words &lt;text&gt;)</code></td>
      <td style="text-align: left">ç»Ÿè®¡ <text> ä¸­å­—ç¬¦ä¸²ä¸­çš„å•è¯ä¸ªæ•°ã€‚</text></td>
      <td style="text-align: left">è¿”å› <text> ä¸­çš„å•è¯æ•°</text></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(words, foo bar baz)</code>è¿”å›å€¼ä¸ºâ€3â€</td>
      <td style="text-align: left">å¦‚æœæˆ‘ä»¬è¦å– <text> ä¸­æœ€åçš„ä¸€ä¸ªå•è¯,æˆ‘ä»¬å¯ä»¥è¿™æ ·: $(word $(words <text>),<text>) ã€‚</text></text></text></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">firstword</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(firstword &lt;text&gt;)</code></td>
      <td style="text-align: left">å–å­—ç¬¦ä¸² <text> ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚</text></td>
      <td style="text-align: left">è¿”å›å­—ç¬¦ä¸² <text> çš„ç¬¬ä¸€ä¸ªå•è¯</text></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">$(firstword foo bar)</code>è¿”å›â€fooâ€</td>
      <td style="text-align: left">Â </td>
    </tr>
  </tbody>
</table>

<h3 id="93-æ–‡ä»¶åæ“ä½œå‡½æ•°">9.3 æ–‡ä»¶åæ“ä½œå‡½æ•°</h3>

<ul>
  <li>dir: <code class="language-plaintext highlighter-rouge">$(dir &lt;name...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½:ä»æ–‡ä»¶åºåˆ—<names>ä¸­å–å‡ºç›®å½•éƒ¨åˆ†(æœ€åä¸€ä¸ªâ€œ/â€ä¹‹å‰çš„éƒ¨åˆ†)ã€‚</names></li>
      <li>è¿”å›ï¼šè¿”å›æ–‡ä»¶ååºåˆ— <names> çš„ç›®å½•éƒ¨åˆ†ã€‚</names></li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(dir src/foo.c hacks)</code>è¿”å›å€¼æ˜¯<code class="language-plaintext highlighter-rouge">src/ ./</code></li>
    </ul>
  </li>
  <li>notdir:<code class="language-plaintext highlighter-rouge">$(notdir &lt;names...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šä»æ–‡ä»¶ååºåˆ— <names> ä¸­å–å‡ºéç›®å½•éƒ¨åˆ†ã€‚éç›®å½•éƒ¨åˆ†æ˜¯æŒ‡æœ€åä¸€ä¸ªåæ–œæ (â€œ / â€)ä¹‹åçš„éƒ¨åˆ†ã€‚</names></li>
      <li>è¿”å›ï¼šè¿”å›æ–‡ä»¶ååºåˆ— <names> çš„éç›®å½•éƒ¨åˆ†ã€‚</names></li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(notdir src/foo.c hacks)</code>ï¼Œè¿”å›å€¼æ˜¯â€foo.c hacksâ€ã€‚</li>
    </ul>
  </li>
  <li>suffix:<code class="language-plaintext highlighter-rouge">$(suffix &lt;names...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šä»æ–‡ä»¶ååºåˆ— <names> ä¸­å–å‡ºå„ä¸ªæ–‡ä»¶åçš„åç¼€ã€‚</names></li>
      <li>è¿”å›ï¼šè¿”å›æ–‡ä»¶ååºåˆ— <names> çš„åç¼€åºåˆ—,å¦‚æœæ–‡ä»¶æ²¡æœ‰åç¼€,åˆ™è¿”å›ç©ºå­—ä¸²ã€‚</names></li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(suffix src/foo.c src-1.0/bar.c hacks)</code>ï¼›è¿”å›å€¼æ˜¯â€.c .câ€ã€‚</li>
    </ul>
  </li>
  <li>basename:<code class="language-plaintext highlighter-rouge">$(basename &lt;names...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šä»æ–‡ä»¶ååºåˆ— <names> ä¸­å–å‡ºå„ä¸ªæ–‡ä»¶åçš„å‰ç¼€éƒ¨åˆ†ã€‚</names></li>
      <li>è¿”å›ï¼šè¿”å›æ–‡ä»¶ååºåˆ— <names> çš„å‰ç¼€åºåˆ—,å¦‚æœæ–‡ä»¶æ²¡æœ‰å‰ç¼€,åˆ™è¿”å›ç©ºå­—ä¸²ã€‚</names></li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(basename src/foo.c src-1.0/bar.c hacks)</code>ï¼›è¿”å›å€¼æ˜¯â€src/foo src-1.0/bar hacksâ€ã€‚</li>
    </ul>
  </li>
  <li>addsuffixï¼š<code class="language-plaintext highlighter-rouge">$(addsuffix &lt;suffix&gt;,&lt;names...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šæŠŠåç¼€ <suffix> åŠ åˆ° <names> ä¸­çš„æ¯ä¸ªå•è¯åé¢ã€‚</names></suffix></li>
      <li>è¿”å›ï¼šè¿”å›åŠ è¿‡åç¼€çš„æ–‡ä»¶ååºåˆ—ã€‚</li>
      <li><code class="language-plaintext highlighter-rouge">$(addsuffix .c,foo bar)</code>,è¿”å›å€¼æ˜¯â€foo.c bar.câ€ã€‚</li>
    </ul>
  </li>
  <li>addprefixï¼š<code class="language-plaintext highlighter-rouge">$(addprefix &lt;prefix&gt;,&lt;names...&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šæŠŠå‰ç¼€ <prefix> åŠ åˆ° <names> ä¸­çš„æ¯ä¸ªå•è¯åé¢ã€‚</names></prefix></li>
      <li>è¿”å›ï¼šè¿”å›åŠ è¿‡å‰ç¼€çš„æ–‡ä»¶ååºåˆ—ã€‚</li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(addprefix src/,foo bar)</code>ï¼›è¿”å›å€¼æ˜¯â€src/foo src/barâ€</li>
    </ul>
  </li>
  <li>join:<code class="language-plaintext highlighter-rouge">$(join &lt;list1&gt;,&lt;list2&gt;)</code>
    <ul>
      <li>åŠŸèƒ½ï¼šæŠŠ <list2> ä¸­çš„å•è¯å¯¹åº”åœ°åŠ åˆ° <list1> çš„å•è¯åé¢ã€‚å¦‚æœ <list1> çš„å•è¯ä¸ªæ•°è¦æ¯” <list2> çš„å¤š,é‚£ä¹ˆ,<list1> ä¸­çš„å¤šå‡ºæ¥çš„å•è¯å°†ä¿æŒåŸæ ·ã€‚å¦‚æœ <list2> çš„å•è¯ä¸ªæ•°è¦æ¯” <list1> å¤š,é‚£ä¹ˆ, <list2> å¤šå‡ºæ¥çš„å•è¯å°†è¢«å¤åˆ¶åˆ° <list2> ä¸­ã€‚</list2></list2></list1></list2></list1></list2></list1></list1></list2></li>
      <li>è¿”å›ï¼šè¿”å›è¿æ¥è¿‡åçš„å­—ç¬¦ä¸²ã€‚</li>
      <li>ç¤ºä¾‹ï¼š<code class="language-plaintext highlighter-rouge">$(join aaa bbb , 111 222 333)</code>ï¼›è¿”å›å€¼æ˜¯<code class="language-plaintext highlighter-rouge">aaa111 bbb222 333</code></li>
    </ul>
  </li>
</ul>

<h3 id="94-foreachå‡½æ•°">9.4 foreachå‡½æ•°</h3>

<ul>
  <li>è¯­æ³•ï¼š<code class="language-plaintext highlighter-rouge">$(foreach &lt;var&gt;,&lt;list&gt;,&lt;text&gt;)</code></li>
  <li>åŠŸèƒ½ï¼šå°†listä¸­çš„å•è¯é€ä¸€å»é™¤ï¼Œæ”¾åˆ°varæŒ‡å®šçš„å˜é‡ä¸­ï¼Œç„¶åå†æ‰§è¡Œ<text>æ‰€åŒ…å«è¡¨è¾¾å¼ã€‚</text></li>
  <li>ç¤ºä¾‹ï¼š</li>
</ul>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">names</span><span class="o">:=</span>a b c d
<span class="nv">files</span><span class="o">:=</span><span class="nf">$(</span><span class="nb">foreach</span> n,<span class="nv">$(names)</span>,<span class="nv">$(n)</span>.o<span class="nf">)</span>

<span class="c">#filesè¿”å›å€¼æ˜¯ a.o b.o c.o d.o
</span>
</code></pre></div></div>
<h3 id="96-callå‡½æ•°">9.6 callå‡½æ•°</h3>

<p>callå‡½æ•°æ˜¯å”¯ä¸€ä¸€ä¸ªå¯ä»¥ç”¨æ¥åˆ›å»ºæ–°çš„å‚æ•°åŒ–çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨callå‘ä¸€ä¸ªå¤æ‚å‡½æ•°ä¸­ä¼ é€’å‚æ•°ã€‚å…¶è¯­æ³•æ˜¯ï¼š
<code class="language-plaintext highlighter-rouge">$(call &lt;expression&gt;,&lt;parm1&gt;,&lt;parm2&gt;,&lt;parm3&gt;...)</code></p>

<p>æ‰§è¡Œæ—¶ï¼Œåé¢çš„å‚æ•°å°†å‡½æ•°ä¸­çš„å˜é‡è¿›è¡Œå–ä»£ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reverse=$(1) $(2)

foo=$(call reverse,a,b)
#æœ€åfooçš„ç»“æœæ˜¯â€œa bâ€

</code></pre></div></div>

<h3 id="97-origin-å‡½æ•°">9.7 origin å‡½æ•°</h3>

<p>è¿™ä¸ªå‡½æ•°è¿”å›å˜é‡çš„æ¥æºï¼›è¯­æ³•ï¼š<code class="language-plaintext highlighter-rouge">$(origin &lt;variable&gt;)</code>;æ¥æºç±»å‹å¦‚ä¸‹ï¼š</p>
<ul>
  <li>undefinedï¼šä»æ¥å°±æ²¡æœ‰å®šä¹‰è¿‡</li>
  <li>default:é»˜è®¤å®šä¹‰å˜é‡ï¼Œå¦‚CC</li>
  <li>environment:ç¯å¢ƒå˜é‡(æ³¨æ„make æ²¡æœ‰â€œ-eâ€å‚æ•°)</li>
  <li>file: è¿™ä¸ªå˜é‡å®šä¹‰åœ¨Makefileä¸­</li>
  <li>command line :è¿™ä¸ªå˜é‡æ˜¯è¢«å‘½ä»¤è¡Œå®šä¹‰çš„ã€‚</li>
  <li>override :æ˜¯è¢«overrideé‡æ–°å®šä¹‰çš„ã€‚</li>
  <li>automatic: æ˜¯å‘½ä»¤ä¸­å®šä¹‰çš„è‡ªåŠ¨åŒ–å˜é‡ã€‚</li>
</ul>

<h3 id="98-shellå‡½æ•°">9.8 shellå‡½æ•°</h3>

<p>æ‰§è¡Œshellå‘½ä»¤ï¼Œå®ƒå’Œâ€`â€œæ˜¯ä¸€æ ·çš„åŠŸèƒ½ã€‚å°†æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤åçš„è¾“å‡ºä½œä¸ºå‡½æ•°è¿”å›ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>contents:=$(shell cat foo)
files:=$(shell echo *.c)
</code></pre></div></div>
<p>æ³¨æ„è¿™ä¸ªå‡½æ•°ä¼šæ–°ç”Ÿæˆä¸€ä¸ªshellç¨‹åºæ¥æ‰§è¡Œå‘½ä»¤ã€‚ä¸åº”è¯¥è¢«å¤§é‡ä½¿ç”¨ã€‚</p>

<h3 id="99-æ§åˆ¶makeçš„å‡½æ•°">9.9 æ§åˆ¶makeçš„å‡½æ•°</h3>

<p>$(error <text...>):è¾“å‡ºé”™è¯¯ï¼Œå¹¶é€€å‡º
$(warning <text...>)ï¼šè¾“å‡ºä¸€æ®µè­¦å‘Šä¿¡æ¯ï¼Œè€Œmakeç»§ç»­æ‰§è¡Œã€‚</text...></text...></p>

<h2 id="10-makeçš„è¿è¡Œ">10 makeçš„è¿è¡Œ</h2>

<h3 id="101-makeçš„é€€å‡ºç ">10.1 makeçš„é€€å‡ºç </h3>

<ul>
  <li>0ï¼šè¡¨ç¤ºæˆåŠŸæ‰§è¡Œ</li>
  <li>1ï¼šè¿è¡Œæ—¶äº§ç”Ÿé”™è¯¯ï¼Œè¿”å›1ã€‚</li>
  <li>2ï¼šå¦‚æœä½¿ç”¨äº†â€œ-qâ€å‚æ•°ï¼Œå¹¶ä¸”makeä½¿å¾—ä¸€äº›ç›®æ ‡ä¸éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆè¿”å›2ã€‚</li>
</ul>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-f</code>å¯ä»¥æŒ‡å®šmake fileæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨makeåé¢æ·»åŠ æŒ‡å®šçš„ä¼ªç›®æ ‡ã€‚</p>

<p>ä¸€èˆ¬ä¼ªç›®æ ‡å‡½æ•°</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">all</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡æ˜¯æ‰€æœ‰ç›®æ ‡çš„ç›®æ ‡,å…¶åŠŸèƒ½ä¸€èˆ¬æ˜¯ç¼–è¯‘æ‰€æœ‰çš„ç›®æ ‡ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">clean</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡åŠŸèƒ½æ˜¯åˆ é™¤æ‰€æœ‰è¢« make åˆ›å»ºçš„æ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">install</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡åŠŸèƒ½æ˜¯å®‰è£…å·²ç¼–è¯‘å¥½çš„ç¨‹åº,å…¶å®å°±æ˜¯æŠŠç›®æ ‡æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šçš„ç›®æ ‡ä¸­å»ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">print</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡çš„åŠŸèƒ½æ˜¯ä¾‹å‡ºæ”¹å˜è¿‡çš„æºæ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">tar</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡åŠŸèƒ½æ˜¯æŠŠæºç¨‹åºæ‰“åŒ…å¤‡ä»½ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ª tar æ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">dist</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡åŠŸèƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶,ä¸€èˆ¬æ˜¯æŠŠ tar æ–‡ä»¶å‹æˆ Z æ–‡ä»¶ã€‚æˆ–æ˜¯ gz æ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">TAGS</code>ï¼šè¿™ä¸ªä¼ªç›®æ ‡åŠŸèƒ½æ˜¯æ›´æ–°æ‰€æœ‰çš„ç›®æ ‡,ä»¥å¤‡å®Œæ•´åœ°é‡ç¼–è¯‘ä½¿ç”¨ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">check</code>ï¼šcheck â€ å’Œ â€œtestâ€è¿™ä¸¤ä¸ªä¼ªç›®æ ‡ä¸€èˆ¬ç”¨æ¥æµ‹è¯• makefile çš„æµç¨‹ã€‚</li>
</ul>

<h3 id="104-æ£€æŸ¥è§„åˆ™">10.4 æ£€æŸ¥è§„åˆ™</h3>

<p>æˆ‘ä»¬ä¸æƒ³makefileä¸­çš„è§„åˆ™æ‰§è¡Œèµ·æ¥ï¼Œåªæƒ³æ£€æŸ¥ä¸€ä¸‹å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹ç›¸å…³å‚æ•°ï¼š</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">- n</code></li>
  <li><code class="language-plaintext highlighter-rouge">--just-print</code></li>
  <li><code class="language-plaintext highlighter-rouge">--dry-run</code></li>
  <li><code class="language-plaintext highlighter-rouge">--recon</code>ï¼šä¸æ‰§è¡Œå‚æ•°,è¿™äº›å‚æ•°åªæ˜¯æ‰“å°å‘½ä»¤,ä¸ç®¡ç›®æ ‡æ˜¯å¦æ›´æ–°,æŠŠè§„åˆ™å’Œè¿å¸¦è§„åˆ™ä¸‹çš„å‘½ä»¤æ‰“å°å‡ºæ¥,ä½†
ä¸æ‰§è¡Œ,è¿™äº›å‚æ•°å¯¹äºæˆ‘ä»¬è°ƒè¯• makefile å¾ˆæœ‰ç”¨å¤„ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">- t</code> <code class="language-plaintext highlighter-rouge">--touch</code>:è¿™ä¸ªå‚æ•°çš„æ„æ€å°±æ˜¯æŠŠç›®æ ‡æ–‡ä»¶çš„æ—¶é—´æ›´æ–°,ä½†ä¸æ›´æ”¹ç›®æ ‡æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´, make å‡è£…ç¼–è¯‘ç›®æ ‡,ä½†ä¸æ˜¯çœŸæ­£çš„ç¼–è¯‘ç›®æ ‡,åªæ˜¯æŠŠç›®æ ‡å˜æˆå·²ç¼–è¯‘è¿‡çš„çŠ¶æ€ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">- q</code> <code class="language-plaintext highlighter-rouge">--question</code>è¿™ä¸ªå‚æ•°çš„è¡Œä¸ºæ˜¯æ‰¾ç›®æ ‡çš„æ„æ€,ä¹Ÿå°±æ˜¯è¯´,å¦‚æœç›®æ ‡å­˜åœ¨,é‚£ä¹ˆå…¶ä»€ä¹ˆä¹Ÿä¸ä¼šè¾“å‡º,å½“ç„¶ä¹Ÿä¸ä¼šæ‰§è¡Œç¼–è¯‘,å¦‚æœç›®æ ‡ä¸å­˜åœ¨,å…¶ä¼šæ‰“å°å‡ºä¸€æ¡å‡ºé”™ä¿¡æ¯ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">-W &lt;file&gt;</code></li>
  <li><code class="language-plaintext highlighter-rouge">--what-if=&lt;file&gt;</code>`</li>
  <li><code class="language-plaintext highlighter-rouge">--assume-new=&lt;file&gt;</code></li>
  <li><code class="language-plaintext highlighter-rouge">--new-file=&lt;file&gt;</code>
è¿™ä¸ªå‚æ•°éœ€è¦æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ã€‚ä¸€èˆ¬æ˜¯æ˜¯æºæ–‡ä»¶(æˆ–ä¾èµ–æ–‡ä»¶), Make ä¼šæ ¹æ®è§„åˆ™æ¨å¯¼æ¥è¿è¡Œä¾èµ–äºè¿™
ä¸ªæ–‡ä»¶çš„å‘½ä»¤,ä¸€èˆ¬æ¥è¯´,å¯ä»¥å’Œâ€œ -n â€å‚æ•°ä¸€åŒä½¿ç”¨,æ¥æŸ¥çœ‹è¿™ä¸ªä¾èµ–æ–‡ä»¶æ‰€å‘ç”Ÿçš„è§„åˆ™å‘½ä»¤ã€‚
å¦å¤–ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç”¨æ³•æ˜¯ç»“åˆâ€œ -p â€å’Œâ€œ -v â€æ¥è¾“å‡º makefile è¢«æ‰§è¡Œæ—¶çš„ä¿¡æ¯(è¿™ä¸ªå°†åœ¨åé¢è®²è¿°)ã€‚</li>
</ul>

<h3 id="105-makeå‚æ•°è¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£">10.5 makeå‚æ•°è¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£ã€‚</h3>

<h2 id="11-éšå«è§„åˆ™">11 éšå«è§„åˆ™</h2>

<p>éšå«è§„åˆ™ä¸»è¦æ˜¯makeçš„è‡ªåŠ¨æ¨å¯¼ã€‚
ä¼šä¸º.oè‡ªåŠ¨é…ç½®ç”Ÿæˆä¾èµ–ç”Ÿæˆé¡¹ã€‚
æ³¨æ„</p>
<ul>
  <li>å› ä¸ºéšè—è§„åˆ™çš„å­˜åœ¨ï¼Œå½“æ‰§è¡Œæ··åˆç¼–è¯‘çš„æ—¶å€™ï¼Œå¯èƒ½å­˜åœ¨éšè—è§„åˆ™å…ˆåæ€§çš„é—®é¢˜ï¼Œä¾‹å¦‚<code class="language-plaintext highlighter-rouge">foo:foo.p</code>å¦‚æœæ–‡ä»¶å¤¹ä¸‹å­˜åœ¨<code class="language-plaintext highlighter-rouge">foo.c</code>éšå«è§„åˆ™å°±ä¼šæ‰¾åˆ°foo.cæ‰§è¡Œè¿‡åå°±ä¸å†å‘ä¸‹æ‰¾äº†ã€‚</li>
  <li>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">-r/--no-builtin-rules</code>å–æ¶ˆæ‰€æœ‰éšå«å‚æ•°è®¾ç½®ã€‚</li>
  <li>ç¼–è¯‘cæ—¶ï¼Œ<n>.oä¼šè‡ªåŠ¨æ·»åŠ ç›®æ ‡ä¾èµ–æ¨å¯¼<n>.cï¼Œå¹¶ç”ŸæˆæŒ‡ä»¤`$(CC) â€“c $(CPPFLAGS) $(CFLAGS)`</n></n></li>
  <li>ç¼–è¯‘c++æ—¶ï¼Œä¼šè‡ªåŠ¨æ¨å¯¼ä¸º<n>.ccæˆ–è€…<n>.C,ç”Ÿæˆå‘½ä»¤`$(CXX) $(CPPFLAGS) $(CFLAGS)`</n></n></li>
  <li>ç¼–è¯‘Pascalæ—¶ï¼Œè‡ªåŠ¨æ¨å¯¼ä¸º<n>.p,ç”ŸæˆæŒ‡ä»¤ä¸º`$(PC) â€“c $(PFLAGS)`;</n></li>
  <li>ç¼–è¯‘Fortran/Ratforæ—¶,è‡ªåŠ¨æ¨å¯¼ä¸º â€œ<n>.râ€ æˆ– â€œ<n>.Fâ€ æˆ– â€œ<n>.fâ€,å…¶ç”Ÿæˆå‘½ä»¤æ˜¯:
</n></n></n>    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>".f" "$(FC) â€“c $(FFLAGS)"
".F" "$(FC) â€“c $(FFLAGS) $(CPPFLAGS)"
".f" "$(FC) â€“c $(FFLAGS) $(RFLAGS)"
</code></pre></div>    </div>
  </li>
  <li>æ±‡ç¼–å’Œæ±‡ç¼–é¢„å¤„ç†ï¼šè‡ªåŠ¨æ¨å¯¼ä¸º<n>.sé»˜è®¤ä½¿ç”¨ç¼–è¯‘å™¨â€œasâ€ï¼Œç”Ÿæˆå‘½ä»¤ï¼š`$(AS) $(ASFLAGS)`ã€‚</n></li>
  <li>é“¾æ¥Objectæ–‡ä»¶ï¼šè¿è¡ŒCçš„ç¼–è¯‘å™¨æ¥è¿è¡Œé“¾æ¥ç¨‹åº(ä¸€èˆ¬æ˜¯â€œldâ€),ç”Ÿæˆå‘½ä»¤ï¼š<code class="language-plaintext highlighter-rouge">$(CC) $(LDFLAGS) &lt;n&gt;.o $(LOADLIBES) $(LDLIBS)</code></li>
</ul>

<h3 id="113-éšå«è§„åˆ™ä½¿ç”¨çš„å˜é‡">11.3 éšå«è§„åˆ™ä½¿ç”¨çš„å˜é‡</h3>
<p>makeä¸­ä¼šé¢„å…ˆå®šä¹‰ä¸€äº›æ‰§è¡Œçš„å˜é‡</p>

<ul>
  <li>AR:å‡½æ•°åº“æ‰“åŒ…ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ ar â€</li>
  <li>AS:æ±‡ç¼–è¯­è¨€ç¼–è¯‘ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ as â€ã€‚</li>
  <li>CC:Cè¯­è¨€ç¼–è¯‘ç¨‹åºï¼Œé»˜è®¤å‘½ä»¤æ˜¯â€œccâ€ã€‚</li>
  <li>CXX:C++ è¯­è¨€ç¼–è¯‘ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ g++ â€ã€‚</li>
  <li>CO:ä» RCS æ–‡ä»¶ä¸­æ‰©å±•æ–‡ä»¶ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ co â€ã€‚</li>
  <li>CPPï¼šC ç¨‹åºçš„é¢„å¤„ç†å™¨(è¾“å‡ºæ˜¯æ ‡å‡†è¾“å‡ºè®¾å¤‡)ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ $(CC) â€“ E â€ã€‚</li>
  <li>FC:Fortran å’Œ Ratfor çš„ç¼–è¯‘å™¨å’Œé¢„å¤„ç†ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ f77 â€ã€‚</li>
  <li>GETï¼šä» SCCS æ–‡ä»¶ä¸­æ‰©å±•æ–‡ä»¶çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ get â€ã€‚</li>
  <li>LEXï¼šLex æ–¹æ³•åˆ†æå™¨ç¨‹åº(é’ˆå¯¹äº C æˆ– Ratfor )ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ lex â€ã€‚</li>
  <li>PCï¼šPascal è¯­è¨€ç¼–è¯‘ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ pc â€ã€‚</li>
  <li>YACCï¼šYacc æ–‡æ³•åˆ†æå™¨(é’ˆå¯¹äº C ç¨‹åº)ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ yacc â€ã€‚</li>
  <li>YACCR:Yacc æ–‡æ³•åˆ†æå™¨(é’ˆå¯¹äº Ratfor ç¨‹åº)ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ yacc â€“ r â€ã€‚</li>
  <li>MAKEINFO:è½¬æ¢ Texinfo æºæ–‡ä»¶( .texi )åˆ° Info æ–‡ä»¶ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ makeinfo â€ã€‚</li>
  <li>TEX:ä» TeX æºæ–‡ä»¶åˆ›å»º TeX DVI æ–‡ä»¶çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ tex â€ã€‚</li>
  <li>TEXI2DVI:ä» Texinfo æºæ–‡ä»¶åˆ›å»ºå†› TeX DVI æ–‡ä»¶çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ texi2dvi â€ã€‚</li>
  <li>WEAVE:è½¬æ¢ Web åˆ° TeX çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ weave â€ã€‚</li>
  <li>CWEAVE:è½¬æ¢ C Web åˆ° TeX çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ cweave â€ã€‚</li>
  <li>TANGLE:è½¬æ¢ Web åˆ° Pascal è¯­è¨€çš„ç¨‹åºã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ tangle â€ã€‚</li>
  <li>CTANGLE:è½¬æ¢ C Web åˆ° C ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ ctangle â€ã€‚</li>
  <li>RM:åˆ é™¤æ–‡ä»¶å‘½ä»¤ã€‚é»˜è®¤å‘½ä»¤æ˜¯â€œ rm â€“ f â€ã€‚</li>
</ul>

<p>å¯¹åº”ç¼–è¯‘å™¨å‚æ•°å˜é‡ï¼š
åŸºæœ¬éƒ½æ˜¯ç¼–è¯‘å™¨å+FLAGSï¼›å¦‚ï¼šCXXFLAGS</p>

<p>æ³¨æ„éšå«è§„åˆ™é“¾ï¼š</p>
<ul>
  <li>å½“å­˜åœ¨ç¼–è¯‘å™¨çš„ç›¸äº’å‡†è¯ä½ ï¼Œä¾‹å¦‚ä¸€ä¸ª.oæ–‡ä»¶çš„ç”Ÿæˆï¼Œå¯èƒ½æ˜¯å…ˆå°†.yæ–‡ä»¶ç”Ÿæˆ.cå†ç”±Cçš„ç¼–è¯‘å™¨ç”Ÿæˆã€‚makeä¼šè¿›è‡ªå·±æœ€å¤§çš„åŠªåŠ›è¿›è¡Œç¼–è¯‘è½¬æ¢å’Œæ¨å¯¼ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œéœ€è¦ä½¿ç”¨ä¼ªç›®æ ‡â€œ.INTERMEDIATEâ€æ¥å¼ºåˆ¶å£°æ˜ä¸­é—´ä»¶ã€‚</li>
  <li>ç¦æ­¢åŒä¸€ä¸ªç›®æ ‡å‡ºç°ä¸¤æ¬¡æˆ–è€…ä»¥ä¸Šã€‚é˜²æ­¢è‡ªåŠ¨æ¨å¯¼æ—¶å‡ºç°æ— é™é€’å½’çš„æƒ…å†µã€‚</li>
  <li>makeä¼šå¯¹ç®€å•çš„ä¸­é—´äº§ç‰©è¿›è¡Œä¼˜åŒ–ï¼Œå¯èƒ½ä¸ä¼šäº§ç”Ÿä¸­é—´æ–‡ä»¶ã€‚</li>
</ul>

<h3 id="115-å®šä¹‰æ¨¡å¼è§„åˆ™">11.5 å®šä¹‰æ¨¡å¼è§„åˆ™</h3>
<p>æ¨¡å¼è§„åˆ™ä¸­ä¸€èˆ¬åŒ…å«â€œ%â€,ä¸»è¦ä»£è¡¨ä»»æ„æ€§çš„æ¨å¯¼ã€‚ä¾‹å¦‚</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">%.o </span><span class="o">:</span> <span class="nf">%.c</span>
    <span class="err">$(CC)</span> <span class="err">-c</span> <span class="err">$(CFLAGS)</span> <span class="err">$(CPPFLAGS)</span> <span class="err">$&lt;</span> <span class="err">-o</span> <span class="err">$@</span>
<span class="c">#å°†æ‰€æœ‰.cæ–‡ä»¶ç¼–è¯‘æˆä¸º.oæ–‡ä»¶
# $&lt;è¡¨ç¤ºäº†æ‰€æœ‰ä¾èµ–ç›®æ ‡çš„æŒ¨ä¸ªå€¼ï¼Œ$@è¡¨ç¤ºæ‰€æœ‰çš„ç›®æ ‡çš„æŒ¨ä¸ªå€¼
</span>
<span class="nl">%.tab.c %.tab.h</span><span class="o">:</span> <span class="nf">%.y</span>
    <span class="err">bison</span> <span class="err">-d</span> <span class="err">$&lt;</span>

<span class="c"># å°†æ‰€æœ‰çš„[.y]æ–‡ä»¶éƒ½ä»¥bison -d $&lt;æ‰§è¡Œã€‚ç”Ÿæˆå¯¹åº”çš„&lt;n&gt;.tab.cå’Œ&lt;n&gt;.tab.hæ–‡ä»¶
</span>
</code></pre></div></div>

<h4 id="1153-è‡ªåŠ¨åŒ–å˜é‡">11.5.3 è‡ªåŠ¨åŒ–å˜é‡</h4>

<p>5.3èŠ‚ä¸­å·²æœ‰æè¿°ï¼Œä¸å†èµ˜è¿°ã€‚</p>

<p>å¯ä»¥é€šè¿‡åœ¨éšå«è§„åˆ™å’Œåé¢ä¸æ·»åŠ å‘½ä»¤ï¼Œæ¥è¦†ç›–éšå«è§„åˆ™ã€‚æˆ–è€…æ·»åŠ å‘½ä»¤ï¼Œé‡å»ºéšå«è§„åˆ™ã€‚</p>

<p>makeæ³¨æ„ä½¿ç”¨åç¼€æ¥è¿›è¡Œæ¨å¯¼ï¼Œå› æ­¤å¯ä»¥æ›´æ”¹<code class="language-plaintext highlighter-rouge">.SUFFIXES</code>æ¥è¿›è¡Œé»˜è®¤åç¼€çš„æ›´æ”¹ã€‚make çš„å‚æ•° â€œ-râ€ æˆ– â€œ-no-builtin-rulesâ€ ä¹Ÿä¼šä½¿ç”¨å¾—é»˜è®¤çš„åç¼€åˆ—è¡¨ä¸ºç©ºã€‚</p>

<h3 id="117-éšå«è§„åˆ™æœç´¢ç®—æ³•">11.7 éšå«è§„åˆ™æœç´¢ç®—æ³•</h3>

<p>å¯¹äºç›®æ ‡Tçš„æœç´¢ç®—æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<ul>
  <li>æŠŠ T çš„ç›®å½•éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥ã€‚å« D ,è€Œå‰©ä½™éƒ¨åˆ†å« N ã€‚(å¦‚:å¦‚æœ T æ˜¯ â€œsrc/foo.oâ€ ,é‚£ä¹ˆ, D å°±æ˜¯ â€œsrc/â€ ,N å°±æ˜¯ â€œfoo.oâ€ )</li>
  <li>åˆ›å»ºæ‰€æœ‰åŒ¹é…äº T æˆ–æ˜¯ N çš„æ¨¡å¼è§„åˆ™åˆ—è¡¨ã€‚</li>
  <li>å¦‚æœåœ¨æ¨¡å¼è§„åˆ™åˆ—è¡¨ä¸­æœ‰åŒ¹é…æ‰€æœ‰æ–‡ä»¶çš„æ¨¡å¼,å¦‚ â€œ%â€ ,é‚£ä¹ˆä»åˆ—è¡¨ä¸­ç§»é™¤å…¶å®ƒçš„æ¨¡å¼ã€‚</li>
  <li>ç§»é™¤åˆ—è¡¨ä¸­æ²¡æœ‰å‘½ä»¤çš„è§„åˆ™ã€‚</li>
  <li>å¯¹äºç¬¬ä¸€ä¸ªåœ¨åˆ—è¡¨ä¸­çš„æ¨¡å¼è§„åˆ™ï¼š
    <ul>
      <li>æ¨å¯¼å…¶ â€œ èŒ â€œS , S åº”è¯¥æ˜¯ T æˆ–æ˜¯ N åŒ¹é…äºæ¨¡å¼ä¸­ â€œ%â€ éç©ºçš„éƒ¨åˆ†ã€‚</li>
      <li>è®¡ç®—ä¾èµ–æ–‡ä»¶ã€‚æŠŠä¾èµ–æ–‡ä»¶ä¸­çš„ â€œ%â€ éƒ½æ›¿æ¢æˆ â€œ èŒ â€œS ã€‚å¦‚æœç›®æ ‡æ¨¡å¼ä¸­æ²¡æœ‰åŒ…å«æ–œæ¡†å­—ç¬¦,è€ŒæŠŠ D åŠ åœ¨ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶çš„å¼€å¤´ã€‚</li>
      <li>æµ‹è¯•æ˜¯å¦æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶éƒ½å­˜åœ¨æˆ–æ˜¯ç†å½“å­˜åœ¨ã€‚(å¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶è¢«å®šä¹‰æˆå¦å¤–ä¸€ä¸ªè§„åˆ™çš„ç›®æ ‡æ–‡ä»¶,æˆ–è€…æ˜¯ä¸€ä¸ªæ˜¾å¼è§„åˆ™çš„ä¾èµ–æ–‡ä»¶,é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±å« â€œ ç†å½“å­˜åœ¨ â€œ )</li>
      <li>å¦‚æœæ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶å­˜åœ¨æˆ–æ˜¯ç†å½“å­˜åœ¨,æˆ–æ˜¯å°±æ²¡æœ‰ä¾èµ–æ–‡ä»¶ã€‚é‚£ä¹ˆè¿™æ¡è§„åˆ™å°†è¢«é‡‡ç”¨,é€€å‡ºè¯¥ç®—æ³•ã€‚</li>
    </ul>
  </li>
  <li>å¦‚æœç»è¿‡ç¬¬ 5 æ­¥,æ²¡æœ‰æ¨¡å¼è§„åˆ™è¢«æ‰¾åˆ°,é‚£ä¹ˆå°±åšæ›´è¿›ä¸€æ­¥çš„æœç´¢ã€‚å¯¹äºå­˜åœ¨äºåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¨¡å¼è§„åˆ™ï¼š
    <ul>
      <li>å¦‚æœè§„åˆ™æ˜¯ç»ˆæ­¢è§„åˆ™,é‚£å°±å¿½ç•¥å®ƒ,ç»§ç»­ä¸‹ä¸€æ¡æ¨¡å¼è§„åˆ™ã€‚</li>
      <li>è®¡ç®—ä¾èµ–æ–‡ä»¶ã€‚(åŒç¬¬ 5 æ­¥)</li>
      <li>æµ‹è¯•æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶æ˜¯å¦å­˜åœ¨æˆ–æ˜¯ç†å½“å­˜åœ¨ã€‚</li>
      <li>å¯¹äºä¸å­˜åœ¨çš„ä¾èµ–æ–‡ä»¶,é€’å½’è°ƒç”¨è¿™ä¸ªç®—æ³•æŸ¥æ‰¾ä»–æ˜¯å¦å¯ä»¥è¢«éšå«è§„åˆ™æ‰¾åˆ°ã€‚</li>
      <li>å¦‚æœæ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶å­˜åœ¨æˆ–æ˜¯ç†å½“å­˜åœ¨,æˆ–æ˜¯å°±æ ¹æœ¬æ²¡æœ‰ä¾èµ–æ–‡ä»¶ã€‚é‚£ä¹ˆè¿™æ¡è§„åˆ™è¢«é‡‡ç”¨,é€€å‡ºè¯¥ç®—æ³•ã€‚</li>
    </ul>
  </li>
  <li>å¦‚æœæ²¡æœ‰éšå«è§„åˆ™å¯ä»¥ä½¿ç”¨,æŸ¥çœ‹ â€œ.DEFAULTâ€ è§„åˆ™,å¦‚æœæœ‰,é‡‡ç”¨,æŠŠ â€œ.DEFAULTâ€ çš„å‘½ä»¤ç»™ T
ä½¿ç”¨ã€‚</li>
</ul>

<p>å½“è§„åˆ™è¢«æ‰¾åˆ°ï¼Œå°±ä¼šæ‰§è¡Œå…¶ç›¸å½“çš„å‘½ä»¤ï¼Œæ­¤æ—¶è‡ªåŠ¨åŒ–å˜é‡æ‰ä¼šç”Ÿæˆã€‚</p>

<h2 id="12-ä½¿ç”¨-make-æ›´æ–°å‡½æ•°åº“æ–‡ä»¶">12 ä½¿ç”¨ make æ›´æ–°å‡½æ•°åº“æ–‡ä»¶</h2>

<p>å‡½æ•°åº“æ–‡ä»¶ä¹Ÿå°±æ˜¯å¯¹ Object æ–‡ä»¶(ç¨‹åºç¼–è¯‘çš„ä¸­é—´æ–‡ä»¶)çš„æ‰“åŒ…æ–‡ä»¶ã€‚åœ¨ Unix ä¸‹,ä¸€èˆ¬æ˜¯ç”±å‘½ä»¤ â€œarâ€
æ¥å®Œæˆæ‰“åŒ…å·¥ä½œã€‚</p>

<h3 id="121-å‡½æ•°åº“æ–‡ä»¶çš„æˆå‘˜">12.1 å‡½æ•°åº“æ–‡ä»¶çš„æˆå‘˜</h3>

<p>ä¸€ä¸ªå‡½æ•°åº“æ–‡ä»¶ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆã€‚ä½ å¯ä»¥ä»¥å¦‚ä¸‹æ ¼å¼æŒ‡å®šå‡½æ•°åº“æ–‡ä»¶åŠå…¶ç»„æˆ:
<code class="language-plaintext highlighter-rouge">archive(member)</code></p>

<p>è¿™ä¸ªä¸»è¦æ˜¯å¯¹ç›®æ ‡å’Œä¾èµ–çš„å®šä¹‰ã€‚ä¸»è¦æ˜¯ä¸ºäº†â€œarâ€æ¥è¿›è¡ŒæœåŠ¡ã€‚å¦‚:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foolib(hack.o) : hack.o
    ar cr foolib hack.o

</code></pre></div></div>

<h3 id="122-å‡½æ•°åº“æˆå‘˜çš„éšå«è§„åˆ™">12.2 å‡½æ•°åº“æˆå‘˜çš„éšå«è§„åˆ™</h3>

<p>å½“ç›®æ ‡æ˜¯â€a(m)â€ï¼Œå½¢å¼æ—¶ï¼Œå…¶ä¼šæŠŠç›®æ ‡è½¬æ¢ä¸º(m),ä¾‹å¦‚â€make foo.a(bar.o)â€çš„å½¢å¼è°ƒç”¨Makefileæ—¶ï¼Œéšå«è§„åˆ™ä¼šå»æ‰¾â€bar.oâ€çš„è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ç›¸å…³è§„åˆ™ï¼Œé‚£ä¹ˆå†…å»ºéšå«è§„åˆ™ç”Ÿæ•ˆã€‚makeä¼šå»æ‰¾å¯¹åº”çš„æ–‡ä»¶æ¥ç”Ÿæˆç›®æ ‡ï¼Œæ‰¾åˆ°åˆ™æˆåŠŸæ‰§è¡Œã€‚</p>

<p>æ³¨æ„ï¼š â€œ$%â€æ˜¯ä¸“å±å‡½æ•°åº“æ–‡ä»¶çš„è‡ªåŠ¨åŒ–å˜é‡ã€‚</p>

<h3 id="123-å‡½æ•°åº“æ–‡ä»¶çš„åç¼€è§„åˆ™">12.3 å‡½æ•°åº“æ–‡ä»¶çš„åç¼€è§„åˆ™</h3>

<p>ä½¿ç”¨åç¼€è§„åˆ™å’Œéšå«è§„åˆ™æ¥ç”Ÿæˆå‡½æ•°åº“æ‰“åŒ…æ–‡ä»¶ï¼Œå¦‚ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.c.a:
    $(CC) $(CFLAGS) $(CPPFLAGS) -c $&lt; -o $*.o
    $(AR) r $@ $*.o
    $(RM) $*.o

</code></pre></div></div>
<p>ç­‰ä»·äºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(%.o) : %.c
    $(CC) $(CFLAGS) $(CPPFLAGS) -c $&lt; -o $*.o
    $(AR) r $@ $*.o
    $(RM) $*.o

</code></pre></div></div>

<p>æ³¨æ„ï¼š</p>

<p>è¿›è¡Œå‡½æ•°åº“æ‰“åŒ…æ–‡ä»¶ç”Ÿæˆæ—¶,è¯·å°å¿ƒä½¿ç”¨ make çš„å¹¶è¡Œæœºåˆ¶( â€œ-jâ€ å‚æ•°)ã€‚å¦‚æœå¤šä¸ª ar å‘½ä»¤åœ¨åŒä¸€æ—¶
é—´è¿è¡Œåœ¨åŒä¸€ä¸ªå‡½æ•°åº“æ‰“åŒ…æ–‡ä»¶ä¸Š,å°±å¾ˆæœ‰å¯ä»¥æŸåè¿™ä¸ªå‡½æ•°åº“æ–‡ä»¶ã€‚</p>
:ET