I"¾œ<blockquote>
  <p>2019-05-17 20:16:52</p>
</blockquote>

<h1 id="cçº¿ç¨‹æ± ">C++çº¿ç¨‹æ± </h1>
<p><em>å‚è€ƒé“¾æ¥ï¼š</em> <a href="https://www.cnblogs.com/ailumiyana/p/10016965.html">åŸºäºC++11å®ç°çº¿ç¨‹æ± çš„å·¥ä½œåŸç†</a>;<a href="https://www.cnblogs.com/yangang92/p/5485868.html">c++ç®€å•çº¿ç¨‹æ± å®ç°</a></p>

<h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</h2>
<p><strong>çº¿ç¨‹æ± :</strong> å½“è¿›è¡Œå¹¶è¡Œçš„ä»»åŠ¡ä½œä¸šæ“ä½œæ—¶ï¼Œçº¿ç¨‹çš„å»ºç«‹ä¸é”€æ¯çš„å¼€é”€æ˜¯ï¼Œé˜»ç¢æ€§èƒ½è¿›æ­¥çš„å…³é”®ï¼Œå› æ­¤çº¿ç¨‹æ± ï¼Œç”±æ­¤äº§ç”Ÿã€‚ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œæ— é™åˆ¶å¾ªç¯ç­‰å¾…é˜Ÿåˆ—ï¼Œè¿›è¡Œè®¡ç®—å’Œæ“ä½œã€‚å¸®åŠ©å¿«é€Ÿé™ä½å’Œå‡å°‘æ€§èƒ½æŸè€—ã€‚</p>

<h2 id="çº¿ç¨‹æ± çš„ç»„æˆ">çº¿ç¨‹æ± çš„ç»„æˆ</h2>

<ol>
  <li>çº¿ç¨‹æ± ç®¡ç†å™¨ï¼šåˆå§‹åŒ–å’Œåˆ›å»ºçº¿ç¨‹ï¼Œå¯åŠ¨å’Œåœæ­¢çº¿ç¨‹ï¼Œè°ƒé…ä»»åŠ¡ï¼›ç®¡ç†çº¿ç¨‹æ± </li>
  <li>å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­ç­‰å¾…å¹¶æ‰§è¡Œåˆ†é…çš„ä»»åŠ¡</li>
  <li>ä»»åŠ¡æ¥å£ï¼šæ·»åŠ ä»»åŠ¡çš„æ¥å£ï¼Œä»¥æä¾›å·¥ä½œçº¿ç¨‹è°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œã€‚</li>
  <li>ä»»åŠ¡é˜Ÿåˆ—ï¼šç”¨äºå­˜æ”¾æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡ï¼Œæä¾›ä¸€ç§ç¼“å†²æœºåˆ¶ï¼ŒåŒæ—¶å…·æœ‰è°ƒåº¦åŠŸèƒ½ï¼Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ”¾åœ¨é˜Ÿåˆ—å‰é¢</li>
</ol>

<h2 id="çº¿ç¨‹æ± å·¥ä½œçš„å››ç§æƒ…å†µ">çº¿ç¨‹æ± å·¥ä½œçš„å››ç§æƒ…å†µ</h2>

<ul>
  <li><strong>1. æ²¡æœ‰ä»»åŠ¡è¦æ‰§è¡Œï¼Œç¼“å†²é˜Ÿåˆ—ä¸ºç©º</strong></li>
</ul>

<p><img src="https://img2018.cnblogs.com/blog/1384555/201811/1384555-20181125200244522-1220110086.png" alt="ç©ºé˜Ÿåˆ—æƒ…å†µ" /></p>

<ul>
  <li><strong>2. é˜Ÿåˆ—ä¸­ä»»åŠ¡æ•°é‡ï¼Œå°äºç­‰äºçº¿ç¨‹æ± ä¸­çº¿ç¨‹ä»»åŠ¡æ•°é‡</strong></li>
</ul>

<p><img src="https://img2018.cnblogs.com/blog/1384555/201811/1384555-20181125200256243-812341901.png" alt="ä»»åŠ¡æ•°é‡å°äºçº¿ç¨‹æ•°é‡" /></p>

<ul>
  <li><strong>3. ä»»åŠ¡æ•°é‡å¤§äºçº¿ç¨‹æ± æ•°é‡,ç¼“å†²é˜Ÿåˆ—æœªæ»¡</strong></li>
</ul>

<p><img src="https://img2018.cnblogs.com/blog/1384555/201811/1384555-20181125200302734-327449131.png" alt="ä»»åŠ¡æ•°é‡å¤§äºçº¿ç¨‹æ± æ•°é‡" /></p>

<ul>
  <li><strong>4. ä»»åŠ¡æ•°é‡å¤§äºçº¿ç¨‹æ± æ•°é‡ï¼Œç¼“å†²é˜Ÿåˆ—å·²æ»¡</strong></li>
</ul>

<p><img src="https://img2018.cnblogs.com/blog/1384555/201811/1384555-20181125200310191-1172074659.png" alt="ç¼“å†²é˜Ÿåˆ—å·²æ»¡" /></p>

<h2 id="çº¿ç¨‹æ± çš„cå®ç°">çº¿ç¨‹æ± çš„C++å®ç°</h2>

<p><em>å‚è€ƒé“¾æ¥ï¼š</em><a href="https://github.com/mtrebi/thread-pool/blob/master/README.md">Thread pool</a>; <a href="https://github.com/progschj/ThreadPool">ThreadPool</a>;</p>

<p><img src="http://wangpengcheng.github.io/img/thread_pool.png" alt="çº¿ç¨‹æ± ç»“æ„" /></p>

<p>çº¿ç¨‹æ± çš„ä¸»è¦ç»„æˆæœ‰ä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
  <li>ä»»åŠ¡é˜Ÿåˆ—(Task Quene)</li>
  <li>çº¿ç¨‹æ± (Thread Pool)</li>
  <li>å®Œæˆé˜Ÿåˆ—(Completed Tasks)</li>
</ul>

<h3 id="é˜Ÿåˆ—">é˜Ÿåˆ—</h3>
<p>æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—æ¥å­˜å‚¨å·¥ä½œï¼Œå› ä¸ºå®ƒæ˜¯æ›´åˆç†çš„æ•°æ®ç»“æ„ã€‚ æˆ‘ä»¬å¸Œæœ›ä»¥ä¸å‘é€å®ƒç›¸åŒçš„é¡ºåºå¯åŠ¨å·¥ä½œã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªé˜Ÿåˆ—æœ‰ç‚¹ç‰¹æ®Šã€‚æ­£å¦‚æˆ‘åœ¨ä¸Šä¸€èŠ‚ä¸­æ‰€è¯´çš„ï¼Œçº¿ç¨‹æ˜¯è¿ç»­çš„ï¼ˆå¥½å§ï¼Œä¸æ˜¯çœŸçš„ï¼Œä½†æˆ‘ä»¬å‡è®¾å®ƒä»¬æ˜¯ï¼‰æŸ¥è¯¢é˜Ÿåˆ—è¦æ±‚å·¥ä½œã€‚å½“æœ‰å¯ç”¨çš„å·¥ä½œæ—¶ï¼Œçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–å·¥ä½œå¹¶æ‰§è¡Œå®ƒã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹è¯•å›¾åŒæ—¶æ‰§è¡Œç›¸åŒçš„å·¥ä½œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¥½å§ï¼Œç¨‹åºä¼šå´©æºƒã€‚
ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œæˆ‘åœ¨æ ‡å‡†C ++ Queueä¸Šå®ç°äº†ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒä½¿ç”¨mutexæ¥é™åˆ¶å¹¶å‘è®¿é—®ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹SafeQueueç±»çš„ä¸€å°éƒ¨åˆ†ç¤ºä¾‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void enqueue(T&amp; t) {
    std::unique_lock&lt;std::mutex&gt; lock(m_mutex);
    m_queue.push(t);
}
</code></pre></div></div>

<p>è¦æ’é˜Ÿæˆ‘ä»¬åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é”å®šäº’æ–¥é”ä»¥ç¡®ä¿æ²¡æœ‰å…¶ä»–äººæ­£åœ¨è®¿é—®è¯¥èµ„æºã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å…ƒç´ æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚ å½“é”è¶…å‡ºèŒƒå›´æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚å¥½å—ï¼Œå¯¹å§ï¼Ÿè¿™æ ·ï¼Œæˆ‘ä»¬ä½¿Queueçº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒè®¸å¤šçº¿ç¨‹åœ¨ç›¸åŒçš„â€œæ—¶é—´â€è®¿é—®å’Œ/æˆ–ä¿®æ”¹å®ƒã€‚</p>

<h3 id="æäº¤å‡½æ•°">æäº¤å‡½æ•°</h3>

<p>çº¿ç¨‹æ± æœ€é‡è¦çš„æ–¹æ³•æ˜¯è´Ÿè´£å‘é˜Ÿåˆ—æ·»åŠ å·¥ä½œçš„æ–¹æ³•ã€‚æˆ‘æ‰“ç”µè¯ç»™è¿™ä¸ªæ–¹æ³•æäº¤ã€‚ä¸éš¾ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†å®ƒçš„å®ç°èµ·åˆå¯èƒ½çœ‹èµ·æ¥å¾ˆå“äººã€‚è®©æˆ‘ä»¬è€ƒè™‘åº”è¯¥åšä»€ä¹ˆï¼Œä¹‹åæˆ‘ä»¬ä¼šæ‹…å¿ƒå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚ ä»€ä¹ˆï¼š</p>

<ul>
  <li>æ¥å—ä»»ä½•å‚æ•°çš„ä»»ä½•å‡½æ•°ã€‚</li>
  <li>ç«‹å³è¿”å›â€œä¸œè¥¿â€ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚ æ­¤è¿”å›çš„å¯¹è±¡æœ€ç»ˆåº”åŒ…å«æ“ä½œçš„ç»“æœã€‚
å®Œæ•´çš„æäº¤å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Submit a function to be executed asynchronously by the pool template&lt;typename F, typename...Args&gt;</span>

<span class="k">auto</span> <span class="nf">submit</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Create a function with bounded parameters ready to execute</span>

    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))()</span><span class="o">&gt;</span> <span class="n">func</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span>
    <span class="c1">// Encapsulate it into a shared ptr in order to be able to copy construct // assign </span>

    <span class="k">auto</span> <span class="n">task_ptr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">packaged_task</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))()</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>
    <span class="c1">// Wrap packaged task into void function</span>

    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">wrapper_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_ptr</span><span class="p">]()</span> <span class="p">{</span>
      <span class="p">(</span><span class="o">*</span><span class="n">task_ptr</span><span class="p">)();</span> 
    <span class="p">};</span>

    <span class="c1">// Enqueue generic wrapper function</span>

    <span class="n">m_queue</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">wrapperfunc</span><span class="p">);</span>
    <span class="c1">// Wake up one thread if its waiting</span>

    <span class="n">m_conditional_lock</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
    <span class="c1">// Return future from promise</span>

    <span class="k">return</span> <span class="n">task_ptr</span><span class="o">-&gt;</span><span class="n">get_future</span><span class="p">();</span>
<span class="err">}</span>

</code></pre></div></div>

<h3 id="é˜Ÿåˆ—å®Œæ•´æºä»£ç ">é˜Ÿåˆ—å®Œæ•´æºä»£ç </h3>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SafeQueue.h</span>

<span class="cp">#pragma once
</span>
<span class="cp">#include &lt;mutex&gt;
</span>
<span class="cp">#include &lt;queue&gt;
</span>
<span class="c1">// Thread safe implementation of a Queue using a std::queue</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">SafeQueue</span> <span class="p">{</span>
<span class="nl">private:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">m_queue</span><span class="p">;</span> <span class="c1">//åˆ©ç”¨æ¨¡æ¿å‡½æ•°æ„é€ é˜Ÿåˆ—</span>

  <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">m_mutex</span><span class="p">;</span><span class="c1">//è®¿é—®äº’æ–¥ä¿¡å·é‡</span>

<span class="nl">public:</span>
  <span class="n">SafeQueue</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//ç©ºæ„é€ å‡½æ•°</span>


  <span class="p">}</span>

  <span class="n">SafeQueue</span><span class="p">(</span><span class="n">SafeQueue</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span><span class="c1">//æ‹·è´æ„é€ å‡½æ•°</span>

    <span class="c1">//TODO:</span>
  <span class="p">}</span>

  <span class="o">~</span><span class="n">SafeQueue</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//ææ„å‡½æ•°</span>

  <span class="p">}</span>


  <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span>  <span class="c1">//é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">m_mutex</span><span class="p">);</span> <span class="c1">//äº’æ–¥ä¿¡å·å˜é‡åŠ é”ï¼Œé˜²æ­¢m_queueè¢«æ”¹å˜</span>

    <span class="k">return</span> <span class="n">m_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kt">int</span> <span class="n">size</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">m_mutex</span><span class="p">);</span> <span class="c1">//äº’æ–¥ä¿¡å·å˜é‡åŠ é”ï¼Œé˜²æ­¢m_queueè¢«æ”¹å˜</span>

    <span class="k">return</span> <span class="n">m_queue</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="p">}</span>
<span class="c1">//é˜Ÿåˆ—æ·»åŠ å…ƒç´ </span>

  <span class="kt">void</span> <span class="n">enqueue</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">m_mutex</span><span class="p">);</span>
    <span class="n">m_queue</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="p">}</span>
<span class="c1">//é˜Ÿåˆ—å–å‡ºå…ƒç´ </span>

  <span class="kt">bool</span> <span class="n">dequeue</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">m_mutex</span><span class="p">);</span> <span class="c1">//é˜Ÿåˆ—åŠ é”</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">m_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m_queue</span><span class="p">.</span><span class="n">front</span><span class="p">());</span> <span class="c1">//å–å‡ºé˜Ÿé¦–å…ƒç´ ï¼Œè¿”å›é˜Ÿé¦–å…ƒç´ å€¼ï¼Œå¹¶è¿›è¡Œå³å€¼å¼•ç”¨</span>
    
    <span class="n">m_queue</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span> <span class="c1">//å¼¹å‡ºå…¥é˜Ÿçš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="çº¿ç¨‹æ± å®Œæ•´ä»£ç ">çº¿ç¨‹æ± å®Œæ•´ä»£ç </h3>

<p><em>å‚è€ƒé“¾æ¥ï¼š</em> <a href="http://www.cplusplus.com/reference/functional/bind/?kw=bind">std::bind</a>;<a href="http://www.cplusplus.com/reference/utility/forward/">std::forward</a>;<a href="http://www.cplusplus.com/reference/future/packaged_task/">std::packaged_task</a></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ThreadPool.h</span>

<span class="cp">#pragma once
</span>
<span class="cp">#include &lt;functional&gt;
</span>
<span class="cp">#include &lt;future&gt;
</span>
<span class="cp">#include &lt;mutex&gt;
</span>
<span class="cp">#include &lt;queue&gt;
</span>
<span class="cp">#include &lt;thread&gt;
</span>
<span class="cp">#include &lt;utility&gt;
</span>
<span class="cp">#include &lt;vector&gt;
</span>
<span class="cp">#include "SafeQueue.h"
</span>
<span class="k">class</span> <span class="nc">ThreadPool</span> <span class="p">{</span>
<span class="nl">private:</span>
  <span class="k">class</span> <span class="nc">ThreadWorker</span> <span class="p">{</span><span class="c1">//å†…ç½®çº¿ç¨‹å·¥ä½œç±»</span>

  <span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">m_id</span><span class="p">;</span> <span class="c1">//å·¥ä½œid</span>

    <span class="n">ThreadPool</span> <span class="o">*</span> <span class="n">m_pool</span><span class="p">;</span><span class="c1">//æ‰€å±çº¿ç¨‹æ± </span>

  <span class="nl">public:</span>
    <span class="c1">//æ„é€ å‡½æ•°</span>

    <span class="n">ThreadWorker</span><span class="p">(</span><span class="n">ThreadPool</span> <span class="o">*</span> <span class="n">pool</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span> 
      <span class="o">:</span> <span class="n">m_pool</span><span class="p">(</span><span class="n">pool</span><span class="p">),</span> <span class="n">m_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="c1">//é‡è½½`()`æ“ä½œ</span>

    <span class="kt">void</span> <span class="k">operator</span><span class="p">()()</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">func</span><span class="p">;</span> <span class="c1">//å®šä¹‰åŸºç¡€å‡½æ•°ç±»func</span>
      
      <span class="kt">bool</span> <span class="n">dequeued</span><span class="p">;</span> <span class="c1">//æ˜¯å¦æ­£åœ¨å–å‡ºé˜Ÿåˆ—ä¸­å…ƒç´ </span>
      
      <span class="c1">//åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å…³é—­ï¼Œæ²¡æœ‰å…³é—­ï¼Œå¾ªç¯æå–</span>

      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">m_pool</span><span class="o">-&gt;</span><span class="n">m_shutdown</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">{</span>
          <span class="c1">//ä¸ºçº¿ç¨‹ç¯å¢ƒé”åŠ é”ï¼Œäº’è®¿é—®å·¥ä½œçº¿ç¨‹çš„ä¼‘çœ å’Œå”¤é†’</span>

          <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">m_pool</span><span class="o">-&gt;</span><span class="n">m_conditional_mutex</span><span class="p">);</span>
          <span class="c1">//å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé˜»å¡å½“å‰çº¿ç¨‹</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">m_pool</span><span class="o">-&gt;</span><span class="n">m_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">m_pool</span><span class="o">-&gt;</span><span class="n">m_conditional_lock</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span> <span class="c1">//ç­‰å¾…æ¡ä»¶å˜é‡é€šçŸ¥ï¼Œå¼€å¯çº¿ç¨‹</span>

          <span class="p">}</span>
          <span class="c1">//å–å‡ºä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å…ƒç´ </span>

          <span class="n">dequeued</span> <span class="o">=</span> <span class="n">m_pool</span><span class="o">-&gt;</span><span class="n">m_queue</span><span class="p">.</span><span class="n">dequeue</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//å¦‚æœæˆåŠŸå–å‡ºï¼Œæ‰§è¡Œå·¥ä½œå‡½æ•°</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dequeued</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">func</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kt">bool</span> <span class="n">m_shutdown</span><span class="p">;</span> <span class="c1">//çº¿ç¨‹æ± æ˜¯å¦å…³é—­</span>

  <span class="n">SafeQueue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;&gt;</span> <span class="n">m_queue</span><span class="p">;</span><span class="c1">//æ‰§è¡Œå‡½æ•°å®‰å…¨é˜Ÿåˆ—ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span> <span class="n">m_threads</span><span class="p">;</span> <span class="c1">//å·¥ä½œçº¿ç¨‹é˜Ÿåˆ—</span>

  <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">m_conditional_mutex</span><span class="p">;</span><span class="c1">//çº¿ç¨‹ä¼‘çœ é”äº’æ–¥å˜é‡</span>

  <span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span> <span class="n">m_conditional_lock</span><span class="p">;</span> <span class="c1">//çº¿ç¨‹ç¯å¢ƒé”ï¼Œè®©çº¿ç¨‹å¯ä»¥å¤„äºä¼‘çœ æˆ–è€…å”¤é†’çŠ¶æ€</span>

<span class="nl">public:</span>
    <span class="c1">//çº¿ç¨‹æ± æ„é€ å‡½æ•°</span>

  <span class="n">ThreadPool</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">n_threads</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">m_threads</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n_threads</span><span class="p">)),</span> <span class="n">m_shutdown</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="n">ThreadPool</span><span class="p">(</span><span class="k">const</span> <span class="n">ThreadPool</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">//æ‹·è´æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å–æ¶ˆé»˜è®¤çˆ¶ç±»æ„é€ å‡½æ•°</span>

  <span class="n">ThreadPool</span><span class="p">(</span><span class="n">ThreadPool</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// æ‹·è´æ„é€ å‡½æ•°ï¼Œå…è®¸å³å€¼å¼•ç”¨</span>

  <span class="n">ThreadPool</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">ThreadPool</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">// èµ‹å€¼æ“ä½œ</span>

  <span class="n">ThreadPool</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">ThreadPool</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span> <span class="c1">//èµ‹å€¼æ“ä½œ</span>

  <span class="c1">// Inits thread pool</span>

  <span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_threads</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="n">ThreadWorker</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span><span class="c1">//åˆ†é…å·¥ä½œçº¿ç¨‹</span>

    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Waits until threads finish their current task and shutdowns the pool</span>

  <span class="kt">void</span> <span class="n">shutdown</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">m_shutdown</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">m_conditional_lock</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span> <span class="c1">//é€šçŸ¥ å”¤é†’æ‰€æœ‰å·¥ä½œçº¿ç¨‹</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_threads</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">m_threads</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">joinable</span><span class="p">())</span> <span class="p">{</span> <span class="c1">//åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç­‰å¾…</span>

        <span class="n">m_threads</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">join</span><span class="p">();</span>  <span class="c1">//å°†çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</span>

      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Submit a function to be executed asynchronously by the pool</span>
  <span class="c1">//çº¿ç¨‹çš„ä¸»è¦å·¥ä½œå‡½æ•°ï¼Œä½¿ç”¨äº†åç½®è¿”å›ç±»å‹ï¼Œè‡ªåŠ¨åˆ¤æ–­å‡½æ•°è¿”å›å€¼</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">F</span><span class="p">,</span> <span class="k">typename</span><span class="o">...</span><span class="nc">Args</span><span class="p">&gt;</span>
  <span class="k">auto</span> <span class="n">submit</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Create a function with bounded parameters ready to execute</span>
    <span class="c1">// </span>

    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))()</span><span class="o">&gt;</span> <span class="n">func</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span><span class="c1">//è¿æ¥å‡½æ•°å’Œå‚æ•°å®šä¹‰ï¼Œç‰¹æ®Šå‡½æ•°ç±»å‹,é¿å…å·¦ã€å³å€¼é”™è¯¯</span>

    <span class="c1">// Encapsulate it into a shared ptr in order to be able to copy construct // assign </span>
    <span class="c1">//å°è£…è·å–ä»»åŠ¡å¯¹è±¡ï¼Œæ–¹ä¾¿å¦å¤–ä¸€ä¸ªçº¿ç¨‹æŸ¥çœ‹ç»“æœ</span>

    <span class="k">auto</span> <span class="n">task_ptr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">packaged_task</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))()</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">);</span>

    <span class="c1">// Wrap packaged task into void function</span>
    <span class="c1">//åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°å¯¹è±¡</span>

    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">wrapper_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_ptr</span><span class="p">]()</span> <span class="p">{</span>
      <span class="p">(</span><span class="o">*</span><span class="n">task_ptr</span><span class="p">)();</span> 
    <span class="p">};</span>

    <span class="c1">// é˜Ÿåˆ—é€šç”¨å®‰å…¨å°åŒ…å‡½æ•°ï¼Œå¹¶å‹å…¥å®‰å…¨é˜Ÿåˆ—</span>

    <span class="n">m_queue</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">wrapper_func</span><span class="p">);</span>

    <span class="c1">// å”¤é†’ä¸€ä¸ªç­‰å¾…ä¸­çš„çº¿ç¨‹</span>

    <span class="n">m_conditional_lock</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>

    <span class="c1">// è¿”å›å…ˆå‰æ³¨å†Œçš„ä»»åŠ¡æŒ‡é’ˆ</span>

    <span class="k">return</span> <span class="n">task_ptr</span><span class="o">-&gt;</span><span class="n">get_future</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

</code></pre></div></div>

<p>ä½¿ç”¨æ ·ä¾‹ä»£ç 
<em>å‚è€ƒè¿æ¥ï¼š</em> <a href="http://www.cplusplus.com/reference/random/random_device/">std::random_device</a>;<a href="http://www.cplusplus.com/reference/random/mt19937/">std::mt19937</a>;<a href="http://www.cplusplus.com/reference/random/uniform_int_distribution/">std::uniform_int_distribution</a>;<a href=""></a>;</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
</span>
<span class="cp">#include &lt;random&gt;
</span>
<span class="cp">#include "../include/ThreadPool.h"
</span>
<span class="n">std</span><span class="o">::</span><span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span> <span class="c1">//çœŸå®éšæœºæ•°äº§ç”Ÿå™¨</span>

<span class="n">std</span><span class="o">::</span><span class="n">mt19937</span> <span class="nf">mt</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span> <span class="c1">//ç”Ÿæˆè®¡ç®—éšæœºæ•°mt;</span>

<span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dist</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span><span class="c1">//ç”Ÿæˆ-1000åˆ°1000ä¹‹é—´çš„ç¦»æ•£å‡åŒ€åˆ†éƒ¨æ•°</span>

<span class="k">auto</span> <span class="n">rnd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">mt</span><span class="p">);</span>

<span class="c1">//è®¾ç½®çº¿ç¨‹ç¡çœ æ—¶é—´</span>

<span class="kt">void</span> <span class="nf">simulate_hard_computation</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">rnd</span><span class="p">()));</span>
<span class="p">}</span>

<span class="c1">// æ·»åŠ ä¸¤ä¸ªæ•°å­—çš„ç®€å•å‡½æ•°å¹¶æ‰“å°ç»“æœ</span>

<span class="kt">void</span> <span class="nf">multiply</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">simulate_hard_computation</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">" * "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">" = "</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//æ·»åŠ å¹¶è¾“å‡ºç»“æœ</span>

<span class="kt">void</span> <span class="nf">multiply_output</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">simulate_hard_computation</span><span class="p">();</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">" * "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">" = "</span> <span class="o">&lt;&lt;</span> <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ç»“æœè¿”å›</span>

<span class="kt">int</span> <span class="nf">multiply_return</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">simulate_hard_computation</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">" * "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">" = "</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">example</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// åˆ›å»º3ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span>

  <span class="n">ThreadPool</span> <span class="n">pool</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

  <span class="c1">// åˆå§‹åŒ–çº¿ç¨‹æ± </span>

  <span class="n">pool</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>

  <span class="c1">// æäº¤ä¹˜æ³•æ“ä½œï¼Œæ€»å…±30ä¸ª</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">multiply</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// ä½¿ç”¨refä¼ é€’çš„è¾“å‡ºå‚æ•°æäº¤å‡½æ•°</span>

  <span class="kt">int</span> <span class="n">output_ref</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">future1</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">multiply_output</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">output_ref</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

  <span class="c1">// ç­‰å¾…ä¹˜æ³•è¾“å‡ºå®Œæˆ</span>

  <span class="n">future1</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Last operation result is equals to "</span> <span class="o">&lt;&lt;</span> <span class="n">output_ref</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

  <span class="c1">// ä½¿ç”¨returnå‚æ•°æäº¤å‡½æ•°</span>

  <span class="k">auto</span> <span class="n">future2</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">multiply_return</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

  <span class="c1">// ç­‰å¾…ä¹˜æ³•è¾“å‡ºå®Œæˆ</span>

  <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">future2</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Last operation result is equals to "</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  
  <span class="c1">//å…³é—­çº¿ç¨‹æ± </span>
  <span class="n">pool</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://github.com/wangpengcheng/Learning-Note/tree/master/code/thread-pool">ç›¸å…³ä»£ç ä½ç½®</a></p>
:ET