I"
‘<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥ï¼š</h2>

<ul>
  <li><a href="https://www.kernel.org/doc/Documentation/">Linuxå†…æ ¸æ–‡æ¡£é¦–é¡µ</a></li>
  <li><a href="https://linux.die.net/">Linuxæ–‡æ¡£</a></li>
  <li><a href="https://legacy.gitbook.com/book/wizardforcel/linux-c-api-ref/details">Linux c å¼€å‘æ‰‹å†Œ</a></li>
  <li><a href="https://www.kernel.org/doc/htmldocs/kernel-api/index.html">Linux Kernel API</a></li>
  <li><a href="http://www.wrox.com/WileyCDA/WroxTitle/Beginning-Linux-Programming-4th-Edition.productCd-0470147628,descCd-DOWNLOAD.html">ä¹¦ä¸­ä»£ç åœ°å€</a></li>
</ul>

<h2 id="ç¬¬ä¸‰ç« -æ–‡ä»¶æ“ä½œ">ç¬¬ä¸‰ç«  æ–‡ä»¶æ“ä½œ</h2>

<h3 id="31-linuxæ–‡ä»¶ç»“æ„">3.1 linuxæ–‡ä»¶ç»“æ„</h3>
<p><em>å‚è€ƒé“¾æ¥ï¼š</em>ã€€</p>
<ul>
  <li><a href="https://blog.csdn.net/cywosp/article/details/38965239">æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹â€”â€”Linuxä¸­çš„æ–‡ä»¶æè¿°ç¬¦ä¸æ‰“å¼€æ–‡ä»¶ä¹‹é—´çš„å…³ç³»</a>ï¼›</li>
  <li><a href="https://blog.csdn.net/u014743697/article/details/52663975">Linuxæ–‡ä»¶è¯»å†™æœºåˆ¶åŠä¼˜åŒ–æ–¹å¼</a>;</li>
  <li><a href="https://blog.csdn.net/LYJwonderful/article/details/80646602">ã€Linuxå­¦ä¹ ç¬”è®°ã€‘æ ‡å‡†IOç¼“å†²ï¼šè¡Œç¼“å†²ã€å…¨ç¼“å†²ã€æ— ç¼“å†²</a></li>
</ul>

<p>linuxä¸­ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶ã€‚</p>

<p>æ–‡ä»¶é™¤äº†æœ¬èº«çš„æ–‡ä»¶å†…å®¹å¤–ï¼Œè¿˜æœ‰æ–‡ä»¶çš„é™„å±ç®¡ç†ä¿¡æ¯ï¼Œè¿™äº›ä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">inode</code>èŠ‚ç‚¹ä¸­ã€‚ç›®å½•æ˜¯ç”¨äºä¿å­˜å…¶ä»–æ–‡ä»¶çš„èŠ‚ç‚¹å·å’ŒèŠ‚ç‚¹åå­—çš„æ–‡ä»¶ï¼Œç›®å½•æ–‡ä»¶ä¸­çš„æ¯ä¸ªæ•°æ®é¡¹éƒ½æ˜¯æŒ‡å‘æŸä¸ªæ–‡ä»¶èŠ‚ç‚¹çš„é“¾æ¥ï¼Œåˆ é™¤æ–‡ä»¶åå°±æ˜¯åˆ é™¤ä¸ä¹‹å¯¹åº”çš„é“¾æ¥ã€‚
åˆ é™¤æ–‡ä»¶æ—¶ï¼Œå°±æ˜¯åˆ é™¤äº†æ–‡ä»¶çš„ç›®å½•é¡¹ï¼Œå¹¶ä¸”æŒ‡å‘è¯¥æ–‡ä»¶çš„é“¾æ¥æ•°ç›®-1ã€‚æ–‡ä»¶ä¸­çš„æ•°æ®ä»ç„¶èƒ½å¤Ÿé€šè¿‡å…¶å®ƒæŒ‡å‘é“¾æ¥è®¿é—®åˆ°ã€‚è¢«é“¾æ¥æ•°ä¸º0æ—¶ï¼Œæ‰ä¼šè¢«æ­£çœŸåˆ é™¤ã€‚</p>

<p>å¼•æ–‡linuxä¸­ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶çš„æ€æƒ³ï¼Œå…¶ä¸­ç¡¬ä»¶è®¾å¤‡éƒ½æ˜¯æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œmountè¿›è¡Œè®¾å¤‡çš„æŒ‚è½½ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount -t iso9660 /dev/hdc/ /mnt/cdrom
cd /mut/cdrom
</code></pre></div></div>

<p>é‡è¦çš„æ§åˆ¶è®¾å¤‡ç›®å½•æœ‰ä¸‰ä¸ªï¼š</p>

<ul>
  <li>/dev/console:æ§åˆ¶å°è®¾å¤‡</li>
  <li>/dev/tty: æ§åˆ¶ç»ˆç«¯</li>
  <li>/dev/null: ç©ºè®¾å¤‡ï¼Œæ‰€æœ‰å‘è¿™ä¸ªè®¾å¤‡ä¸­çš„è¾“å‡ºéƒ½å°†è¢«ä¸¢å¼ƒã€‚</li>
</ul>

<p>æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ˜¯ä¸€ç»„ <strong>è®¾å¤‡é©±åŠ¨ç¨‹åº</strong>ï¼›å†…æ ¸æä¾›äº†ç”¨äºè®¿é—®è®¾å¤‡é©±åŠ¨ç¨‹åºçš„åº•å±‚å‡½æ•°(ç³»ç»Ÿè°ƒç”¨)ï¼šopenã€readã€writeã€closeã€ioctlç­‰ç›¸å…³ä¿¡æ¯ã€‚</p>

<p>è¾“å…¥è¾“å‡ºåº•å±‚ç³»ç»Ÿè°ƒç”¨çš„æ•ˆç‡éå¸¸ä½ã€‚</p>
<ul>
  <li>ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼šlinuxéœ€è¦ä»ç”¨æˆ·æ€ï¼Œåˆ‡æ¢åˆ°å†…æ ¸çŠ¶æ€ã€‚å› æ­¤åº”è¯¥æ¯æ¬¡è¯»å†™å¤§é‡çš„æ•°æ®è€Œä¸æ˜¯æ¯æ¬¡ä»…ä»…è¯»å†™ä¸€ä¸ªå­—ç¬¦ã€‚</li>
  <li>ç¡¬ä»¶ä¼šé™åˆ¶å¯¹åº•å±‚ç³»ç»Ÿè°ƒç”¨ä¸€æ¬¡èƒ½è¯»å†™çš„æ•°æ®å—çš„å¤§å°ã€‚</li>
</ul>

<p>é’ˆå¯¹ä¸Šè¿°æƒ…å†µï¼Œlinuxæä¾›äº†æ ‡å‡†çš„å‡½æ•°æ¥å£<code class="language-plaintext highlighter-rouge">stdio.h</code>ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-14-17-46.png" alt="æ–‡ä»¶è¯»å–è°ƒç”¨" /></p>

<h4 id="341-writeè°ƒç”¨">3.4.1 writeè°ƒç”¨</h4>

<p>æ ¼å¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;unistd.h&gt;

size_t write(int fildes,const void *buf,size_t nbytes);
</code></pre></div></div>

<p>å°†ç¼“å†²åŒºbufçš„å‰nbytesä¸ªå­—èŠ‚å†™å…¥æ–‡ä»¶æè¿°ç¬¦<code class="language-plaintext highlighter-rouge">fildes</code>å…³è”çš„æ–‡ä»¶ä¸­è¿”å›å®é™…çš„å­—èŠ‚æ•°ï¼Œå¦‚æœå­˜åœ¨é”™è¯¯ï¼Œè¿”å›çš„å®é™…å­—èŠ‚æ•°å¯èƒ½å°é±¼<code class="language-plaintext highlighter-rouge">nbytes</code>ã€‚</p>

<h4 id="342-readç³»ç»Ÿè°ƒç”¨">3.4.2 readç³»ç»Ÿè°ƒç”¨</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">size_t</span> <span class="nf">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>

</code></pre></div></div>

<p>å’Œä¸Šé¢åŸºæœ¬ç›¸åŒåªæ˜¯å˜æˆäº†è¯»å–</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">nread</span><span class="p">;</span>

    <span class="n">nread</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nread</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"A read error has occurred</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">26</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">buffer</span><span class="p">,</span><span class="n">nread</span><span class="p">))</span> <span class="o">!=</span> <span class="n">nread</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"A write error has occurred</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="mi">27</span><span class="p">);</span>

    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp"># input : hello there | ./simple_read
# output :hello there
</span></code></pre></div></div>

<h4 id="343-open-ç³»ç»Ÿè°ƒç”¨">3.4.3 open ç³»ç»Ÿè°ƒç”¨</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;fcntl.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
</span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span><span class="kt">int</span> <span class="n">oflags</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span><span class="kt">int</span> <span class="n">oflags</span><span class="p">,</span><span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>

</code></pre></div></div>
<p>openå»ºç«‹äº†ä¸€æ¡æ–‡ä»¶æˆ–è€…è®¾å¤‡çš„è®¿é—®æ–¹å¼ã€‚è°ƒç”¨æˆåŠŸï¼Œè¿”å›ä¸€ä¸ªå¯ä»¥è¢«readã€writeå’Œå…¶å®ƒç³»ç»Ÿè°ƒç”¨çš„æ–‡ä»¶æè¿°ç¬¦fildesã€‚è¿™ä¸ªä¸ä¼šå’Œå…¶å®ƒæ­£åœ¨è¿è¡Œä¸­çš„è¿›ç¨‹å…±äº«ã€‚å³ä¾¿æ˜¯åŒä¸€æ–‡ä»¶ï¼Œä¸åŒè¿›ç¨‹ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„å…±äº«è®¿é—®ç¬¦å·ã€‚å› æ­¤æ–‡ä»¶åŒæ—¶è¯»å†™çš„æ—¶å€™ï¼Œä¼šç›¸äº’å‰¯é«˜ã€‚ä¸€èˆ¬ä½¿ç”¨æ–‡ä»¶é”æ¥é˜²æ­¢å‡ºç°å†²çªã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-14-41-31.png" alt="opençš„è®¿é—®æ¨¡å¼" /></p>

<p>POSIXè§„èŒƒè¿˜æ ‡å‡†åŒ–äº†ä¸€ä¸ªcreatè°ƒç”¨ï¼Œç›¸å½“äº<code class="language-plaintext highlighter-rouge">oflags=O_CREAT|O_WONLY|O_TRUNC</code></p>

<h4 id="344-è®¿é—®æƒé™è®¾ç½®">3.4.4 è®¿é—®æƒé™è®¾ç½®</h4>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">O_CREAT</code>æ ‡å¿—çš„openæ»´å•Šç”¨æ¥åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œéœ€è¦ç”¨3ä¸ªå‚æ•°æ ¼å¼çš„openè°ƒç”¨ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°modeæ˜¯å‡ ä¸ªæ ‡å¿—æŒ‰ä½æˆ–åå¾—åˆ°çš„ã€‚</p>

<ul>
  <li>S_IRUSR:è¯»æƒé™ï¼Œæ–‡ä»¶å±ä¸»ã€‚</li>
  <li>S_IWUSR:å†™æƒé™ï¼Œæ–‡ä»¶å±ä¸»ã€‚</li>
  <li>S_IXUSR:æ‰§è¡Œæƒé™ï¼Œæ–‡ä»¶å±ä¸»ã€‚</li>
  <li>S_IRGRP:è¯»æƒé™ï¼Œæ–‡ä»¶æ‰€å±ç»„ã€‚</li>
  <li>S_IWGRP:å†™æƒé™ï¼Œæ–‡ä»¶æ‰€å±ç»„ã€‚</li>
  <li>S_IXGRP:æ‰§è¡Œæƒé™ï¼Œæ–‡ä»¶æ‰€å±ç»„ã€‚</li>
  <li>S_IROTH:è¯»æƒé™ï¼Œå…¶å®ƒç”¨æˆ·ã€‚</li>
  <li>S_IWOTH:å†™æƒé™ï¼Œå…¶å®ƒç”¨æˆ·ã€‚</li>
  <li>S_IXOTH:æ‰§è¡Œæƒé™ï¼Œå…¶å®ƒç”¨æˆ·ã€‚</li>
</ul>

<p>ç¤ºä¾‹ï¼š</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">open</span><span class="p">(</span><span class="s">"myfile"</span><span class="p">,</span><span class="n">O_CREAT</span><span class="p">,</span><span class="n">S_IRUSR</span><span class="o">|</span><span class="n">S_IXOTH</span><span class="p">);</span>

</code></pre></div></div>
<h5 id="3441-umask">3.4.4.1 umask</h5>

<p>è¿™é‡Œçš„æƒé™è®¾ç½®ï¼Œå®é™…ä¸Šæµ·å¸‚å‘é€æƒé™è¯·è¯·æ±‚ï¼Œæ˜¯å¦è¢«è®¾ç½®ï¼Œå–å†³äºå½“æ—¶umaskçš„å€¼ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-14-56-18.png" alt="umaskå–å€¼çš„å«ä¹‰1" /></p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-14-57-20.png" alt="umaskå–å€¼çš„å«ä¹‰2" /></p>

<p>chmodæ“ä½œä¹Ÿå°±æ˜¯åœ¨ç›´æ¥æ›´æ”¹umaskçš„å€¼ã€‚</p>

<h5 id="3442-closeç³»ç»Ÿè°ƒç”¨">3.4.4.2 closeç³»ç»Ÿè°ƒç”¨</h5>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">close</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">);</span>

</code></pre></div></div>
<p>è¿™é‡Œä½¿ç”¨closeä¸»è¦æ˜¯æ»´å•Šç”¨ç»ˆæ­¢æ–‡ä»¶æè¿°ç¬¦fildesä¸æ–‡ä»¶ä¹‹é—´çš„å…³è”ã€‚æ–‡ä»¶æè¿°ç¬¦è¢«é‡Šæ”¾èƒ½å¤Ÿé‡æ–°ä½¿ç”¨ã€‚è¿”å›æ­£ç¡®ä¸º0ï¼Œè¿”å›é”™è¯¯ä¸º-1</p>

<p>æ³¨æ„ï¼šå¯¹äºç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå¯èƒ½ä¸ä¼šåœ¨å…³é—­æ–‡ä»¶ä¹‹å‰æŠ¥å‘Šæ–‡ä»¶å†™æ“ä½œä¸­å‡ºç°çš„é”™è¯¯ã€‚å› ä¸ºåœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œæ•°æ®å¯èƒ½æœªè¢«ç¡®è®¤å†™å…¥ã€‚</p>

<h5 id="3443-ioctlç³»ç»Ÿè°ƒç”¨">3.4.4.3 ioctlç³»ç»Ÿè°ƒç”¨</h5>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">ioctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="kt">int</span> <span class="n">cmd</span><span class="p">,...);</span> 
</code></pre></div></div>

<p>æä¾›äº†ä¸€ä¸ªç”¨äºæ§åˆ¶è®¾å¤‡åŠå…¶æè¿°ç¬¦è¡Œä¸ºå’Œé…ç½®æœåŠ¡çš„å€Ÿå£ã€‚</p>

<h4 id="345-å…¶å®ƒæ–‡ä»¶ç®¡ç†æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨">3.4.5 å…¶å®ƒæ–‡ä»¶ç®¡ç†æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨</h4>

<h5 id="3451-lseekç³»ç»Ÿè°ƒç”¨">3.4.5.1 lseekç³»ç»Ÿè°ƒç”¨</h5>

<p>å¯¹æ–‡ä»¶æè¿°ç¬¦<code class="language-plaintext highlighter-rouge">fildes</code>çš„è¯»å†™æŒ‡é’ˆè¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®æ–‡ä»¶çš„ä¸‹ä¸€ä¸ªè¯»å†™ä½ç½®ã€‚ä½ç½®å¯ä»¥æ˜¯æ–‡ä»¶ä¸­çš„ç»å¯¹ä½ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç›¸å¯¹äºå½“å‰ä½ç½®æˆ–è€…æ–‡ä»¶å°¾éƒ¨çš„æŸä¸ªè€Œç›¸å¯¹ä½ç½®ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#includ &lt;unistd.h&gt;
</span>
<span class="cp">#includ &lt;sys/types.h&gt;
</span>
<span class="kt">off_t</span> <span class="nf">lseek</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="kt">off_t</span> <span class="n">offset</span><span class="p">,</span><span class="kt">int</span> <span class="n">whence</span><span class="p">);</span>

</code></pre></div></div>
<p>whenceæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œç”¨æ¥å®šä¹‰è¯¥å€¼ä¾¿å®œçš„ç”¨æ³•ï¼š</p>

<ul>
  <li>SEEK_SET: offsetæ˜¯ä¸€ä¸ªç»å¯¹å€¼</li>
  <li>SEEK_CUR: offsetæ˜¯ç›¸å¯¹äºå½“å‰ä½ç½®çš„ä¸€ä¸ªç›¸å¯¹ä½ç½®ã€‚</li>
  <li>SEEK_END: offsetæ˜¯ç›¸å¯¹äºæ–‡ä»¶å°¾çš„ä¸€ä¸ªç›¸å¯¹ä½ç½®ã€‚</li>
</ul>

<h5 id="3452-fstatstatå’Œlstatç³»ç»Ÿè°ƒç”¨">3.4.5.2 fstatã€statã€å’Œlstatç³»ç»Ÿè°ƒç”¨</h5>

<p>è¿™äº›æ˜¯æ–‡ä»¶æè¿°ç¬¦ç›¸å…³çš„é—®ä»·çŠ¶æ€ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯å°†ä¼šå†™åˆ°ä¸€ä¸ªbufç»“æ„ä¸­ï¼Œbufçš„åœ°å€ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™fstatã€‚å…¶åŸå‹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;unistd.h&gt;

#include &lt;sys/stat.h&gt;

#include &lt;sys/types.h&gt;

int fstat(int fildes,struct stat *buf);
int stat(const char *path,struct stat *buf);
int lstat(const char *path,struct stat *buf);

</code></pre></div></div>

<p>statå’Œlstatè¿”å›çš„æ˜¯é€šè¿‡æ–‡ä»¶åæŸ¥æ‰¾åˆ°çš„çŠ¶æ€ä¿¡æ¯ã€‚ä½†æ˜¯å½“æ–‡ä»¶æ˜¯ç¬¦å·é“¾æ¥æ—¶ï¼Œlstatè¿”å›ç¬¦å·é“¾æ¥æœ¬èº«ä¿¡æ¯ï¼Œstatè¿”å› <strong>ç¬¦å·é“¾æ¥æŒ‡å‘çš„ä¿¡æ¯</strong>ã€‚statç»“æ„æˆå‘˜å†…å®¹å¦‚ä¸‹ï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-15-30-18.png" alt="ç»“æ„ä½“æˆå‘˜" /></p>

<p>st_modeå…³é”®å­—å®šä¹‰åœ¨å¤´æ–‡ä»¶<code class="language-plaintext highlighter-rouge">sys/stat.h</code>ä¸­ã€‚è¿™äº›å®åŒ…æ‹¬å¯¹è®¿é—®æƒé™ã€é—®ä»·ç±»å‹æ ‡å¿—ä»¥åŠä¸€äº›ç”¨äºå¸®åŠ©æµ‹è¯•ç‰¹å®šç±»å‹å’Œæƒé™çš„æ©ç çš„å®šä¹‰ã€‚</p>

<ul>
  <li>S_IFBLK: æ–‡ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å—è®¾å¤‡ã€‚</li>
  <li>S_IFDIR: æ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•</li>
  <li>S_IFCHR: æ–‡ä»¶æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦è®¾å¤‡</li>
  <li>S_IFIFO: æ–‡ä»¶æ˜¯ä¸€ä¸ªFIFO(å‘½åç®¡é“)</li>
  <li>S_IFREG: æ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ã€‚</li>
  <li>S_FLNK: æ–‡ä»¶æ˜¯ä¸€ä¸ªé“¾æ¥ç¬¦å·ã€‚</li>
</ul>

<p>å…¶å®ƒæ¨¡å¼æ ‡å¿—ï¼š</p>

<ul>
  <li>S_ISUID:æ–‡ä»¶è®¾ç½®äº†SUIDä½ã€‚</li>
  <li>S_ISGID:æ–‡ä»¶è®¾ç½®äº†SGIDä½ã€‚</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-15-36-41.png" alt="å…¶å®ƒæ–‡ä»¶ç±»å‹" /></p>

<h5 id="3453-dupå’Œdup2ç³»ç»Ÿè°ƒç”¨">3.4.5.3 dupå’Œdup2ç³»ç»Ÿè°ƒç”¨</h5>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">dup</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">dup2</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="kt">int</span> <span class="n">fildes2</span><span class="p">);</span>
</code></pre></div></div>

<p>ä¸Šé¢ä¸»è¦æ˜¯å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥é€šè¿‡æ›´å¤šçš„æ–‡ä»¶æè¿°ç¬¦è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶ã€‚</p>

<h3 id="35-æ ‡å‡†ioåº“">3.5 æ ‡å‡†I/Oåº“</h3>

<p><em>å‚è€ƒé“¾æ¥ï¼š</em> <a href="https://blog.csdn.net/gkzscs/article/details/83033337">Linuxä¸‹æ ‡å‡†I/Oç¼“å†²æœºåˆ¶</a></p>

<p>ä¸cæ ‡å‡†I/Oç›¸åŒï¼Œä½†æ˜¯ä¸C++ä¸­çš„è¾“å…¥å’Œä¹¦è€Œå‡ºæµä¸åŒï¼Œc++ä¸­æ˜¯å•ç‹¬çš„è¾“å‡ºæµæ¨¡å‹ï¼ŒåŒæ—¶ä¸ºäº†å…¼å®¹Cï¼Œä¸Cçš„è¾“å…¥è¾“å‡ºåŒæ­¥ï¼Œä¼šæ¯”è¾ƒæ…¢ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">ios::sync_with_stdio(false);</code>,è¿™æ ·c++æµä¼šå—å¾ˆå¤šã€‚</p>

<p>å…¶ä¸­çš„ä¸»è¦å‡½æ•°æœ‰ï¼š</p>

<ul>
  <li>fopen:</li>
  <li>fclose:</li>
  <li>fread:</li>
  <li>fwrite:</li>
  <li>fflush:å°†æ–‡ä»¶æµä¸­çš„æ‰€æœ‰æœªå†™å‡ºçš„æ•°æ®ç«‹åˆ»å†™å¤„ç†å•Šï¼Œç¡®ä¿ç¨‹åºç»§ç»­æ‰§è¡Œå‰æ•°æ®éƒ½å·²ç»è¢«å†™åˆ°ç£ç›˜ä¸Šäº†ï¼Œflcloseä¸­éšå«äº†ä¸€æ¬¡fflushè°ƒç”¨ã€‚</li>
  <li>fseek:ä¸lseekå¯¹åº”çš„æ–‡ä»¶æµå‡½æ•°ã€‚ä¸ºä¸‹ä¸€æ¬¡è¯»å†™æ“ä½œæŒ‡å®šä½ç½®ã€‚</li>
</ul>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">fseek</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span><span class="kt">long</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span>

</code></pre></div></div>

<ul>
  <li>
    <p>fgetc,getc,getchar:fgetcå’ŒgetcåŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯ä»æ–‡ä»¶æµä¸­å–å‡ºä¸€ä¸ªå­—ç¬¦è¿”å›ï¼Œå½“å®ƒè¾¾åˆ°æ–‡ä»¶æ–‡ä»¶æœ«å°¾è¿‡ç€å‡ºç°é”™è¯¯æ—¶è¿”å›EOFï¼›getcharç›¸å½“äºget(stdin),ä»æ ‡å‡†è¾“å…¥é‡Œè¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</p>
  </li>
  <li>fputcã€putcå’Œputcharå’ŒåŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡å¤šäº†è¾“å‡ºå­—ç¬¦å‚æ•°<code class="language-plaintext highlighter-rouge">c</code>ã€‚</li>
  <li>fgetså’Œgetsï¼šå‰è€…ä»æ–‡ä»¶æµstreamä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‡åˆ°æ¢è¡Œç¬¦æˆ–è€…ç»“æŸæ–‡ä»¶æœ«å°¾ï¼Œå°†æ¢è¡Œç¬¦ä¼ é€’åˆ°æ¥æ”¶å­—ç¬¦ä¸²ä¸­å¹¶æ·»åŠ <code class="language-plaintext highlighter-rouge">\n</code>è¡¨ç¤ºå­—ç¬¦ä¸²ç»“å°¾ï¼Œå› æ­¤å®é™…è¾“å‡ºå­—ç¬¦ä¸²æ•°ç›®ä¸º<code class="language-plaintext highlighter-rouge">n-1</code>ã€‚åè€…ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®å¹¶ä¸¢å¼ƒé‡åˆ°çš„æ¢è¡Œç¬¦ã€‚åœ¨æ¥æ”¶å­—ç¬¦ä¼ çš„å°¾éƒ¨åŠ ä¸Šä¸€ä¸ªnullå­—ç¬¦ã€‚</li>
</ul>

<p>æ³¨æ„ï¼š getså¯¹ä¼ è¾“å­—ç¬¦çš„ä¸ªæ•°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæº¢å‡ºè‡ªå·±çš„ä¼ è¾“ç¼“å†²åŒºã€‚å› æ­¤ï¼Œä½ åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå¹¶ç”¨fgetsæ¥ä»£æ›¿ã€‚(<a href="https://www.cnblogs.com/yiyide266/p/10566160.html">[Linux]æ ‡å‡†IOå…¨ç¼“å†²å’Œè¡Œç¼“å†²</a>)</p>

<h3 id="36-æ ¼å¼åŒ–è¾“å…¥å’Œè¾“å‡º">3.6 æ ¼å¼åŒ–è¾“å…¥å’Œè¾“å‡º</h3>

<ul>
  <li>printã€fprintfå’Œsprintf:ç¬¬ä¸€ä¸ªå°†å…¶é€åˆ°æ ‡å‡†è¾“å‡º.fprintfå°†è‡ªå·±è¾“å‡ºè¾“é€åˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶æµã€‚sprintfå°†è¾“å‡ºå’Œä¸€ä¸ªç»“å°¾ç©ºå­—ç¬¦å†™åˆ°ä½œä¸ºå‚æ•°ä¼ é€’è¿‡æ¥çš„å­—ç¬¦ä¸²sé‡Œã€‚
<img src="https://wangpengcheng.github.io/img/2019-08-24-19-17-41.png" alt="è¾“å‡ºæ ¼å¼1" />
<img src="https://wangpengcheng.github.io/img/2019-08-24-19-18-16.png" alt="è¾“å‡ºæ ¼å¼2" /></li>
  <li>scanfã€fscanfã€sscanfï¼šä¸printfåŸºæœ¬ç›¸åŒã€‚
<img src="https://wangpengcheng.github.io/img/2019-08-24-19-19-55.png" alt="è¾“å…¥æ ¼å¼" /></li>
  <li>fgetpos:è·å–å½“å‰æ–‡ä»¶æµè¯»å†™çš„ä½ç½®ã€‚</li>
  <li>fsetpos:è®¾ç½®æ–‡ä»¶æµçš„å½“å‰è¯»å†™ä½ç½®</li>
  <li>ftell:è¿”å›æ–‡ä»¶æµå½“å‰è¯»å†™ä½ç½®çš„åç§»</li>
  <li>freopen:é‡æ–°ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æµã€‚</li>
  <li>setvbuf:è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²æœºåˆ¶</li>
  <li>remove:ç›¸å½“äºunlinkå‡½æ•°ï¼Œå¦‚æœpathæ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™ç›¸å½“äºrmdirå‡½æ•°ã€‚</li>
  <li>ferror:æµ‹è¯•ä¸€ä¸ªæ–‡ä»¶æµçš„é”™è¯¯æ ‡è¯†ï¼Œå¦‚æœè¯¥æ ‡è¯†è¢«è®¾ç½®å°±è¿”å›ä¸€ä¸ªéé›¶å€¼ï¼Œå¦åˆ™è¿”å›0</li>
  <li>feof:æµ‹è¯•ä¸€ä¸ªæ–‡ä»¶æµçš„æ–‡ä»¶å°¾æ ‡è¯†ï¼Œè¢«è®¾ç½®åˆ™è¿”å›éé›¶å€¼ã€‚å¦åˆ™è¿”å›0.</li>
  <li>clearerr:é‡æ–°æ¸…é™¤é”™è¯¯ä¿¡æ¯ã€‚</li>
  <li>fileno:è·å–æ–‡ä»¶æµä½¿ç”¨çš„åº•å±‚æ–‡ä»¶æè¿°ç¬¦ã€‚å¤±è´¥è¿”å›-1</li>
  <li>fdopen:åœ¨å·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æµã€‚å®é™…æ‰€ç”¨æ˜¯ä¸ºä¸€ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æä¾›stdioç¼“å†²åŒºã€‚</li>
</ul>

<h3 id="37-æ–‡ä»¶å’Œç›®å½•çš„ç»´æŠ¤">3.7 æ–‡ä»¶å’Œç›®å½•çš„ç»´æŠ¤</h3>

<ul>
  <li>chmod:æ”¹å˜æ–‡ä»¶æˆ–è€…ç›®å½•çš„è®¿é—®æƒé™</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">chown</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span><span class="n">uid_t</span> <span class="n">owner</span><span class="p">,</span><span class="n">git_t</span> <span class="n">group</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>unlinkã€linkå’Œsymlink:ç®¡ç†æ–‡ä»¶é“¾æ¥æ•°ç›®ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒç¬¬äºŒç« ä¸­å†…å®¹ã€‚</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">unlink</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">link</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path1</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path2</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">symlink</span><span class="p">(</span><span class="n">cosnt</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path1</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path2</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>mkdirå’Œrmdir:æ–‡ä»¶å¤¹çš„åˆ›å»ºä¸åˆ é™¤ã€‚</li>
  <li>chdirå’Œgetcwd:è®¿é—®å’Œæ–‡ä»¶å¤¹è·¯å¾„ï¼Œè·å–å½“å‰æ–‡ä»¶å¤¹è·¯å¾„ã€‚</li>
  <li>opendir: åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶è¿”å›åˆ›å»ºçš„ç›®å½•æµã€‚å¦‚æœæˆåŠŸï¼Œå®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘DIRç»“æ„çš„æŒ‡é’ˆï¼Œå¯ä»¥ç”¨äºè¯»å–ç›®å½•æ•°æ®ã€‚</li>
  <li>readdir:è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œç»“æ„é‡Œï¼Œä¿å­˜ä¸€ä¸ªç›®å½•æµdirpä¸­ä¸‹ä¸€ä¸ªç›®å½•çš„èµ„æ–™ï¼Œç›´åˆ°è¿”å›NULL;</li>
  <li>telldir:è¿”å›ç›®å½•æµä¸­å½“å‰çš„ä½ç½®ã€‚</li>
  <li>seekdir:è®¾ç½®ç›®å½•æµdirpçš„ç›®å½•é¡¹æŒ‡é’ˆã€‚locçš„å€¼ç”¨æ¥è®¾ç½®æŒ‡é’ˆä½ç½®ã€‚</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;dirent.h&gt;
</span>
<span class="kt">void</span> <span class="nf">seekdir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">,</span><span class="kt">long</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>closedirï¼šå…³é—­ç›®å½•æµã€‚</li>
</ul>

<p>ä¸€ä¸ªç›®å½•æ‰«æç¨‹åº</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;dirent.h&gt;
</span>
<span class="cp">#include &lt;string.h&gt;
</span>
<span class="cp">#include &lt;sys/stat.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">void</span> <span class="nf">printdir</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="kt">int</span> <span class="n">depth</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
    <span class="k">struct</span> <span class="nc">dirent</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span>
    <span class="k">struct</span> <span class="nc">stat</span> <span class="n">statbuf</span><span class="p">;</span>

    <span class="k">if</span><span class="p">((</span><span class="n">dp</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="n">dir</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"cannot open directory: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">chdir</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span>
    <span class="k">while</span><span class="p">((</span><span class="n">entry</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">lstat</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">,</span><span class="o">&amp;</span><span class="n">statbuf</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">statbuf</span><span class="p">.</span><span class="n">st_mode</span><span class="p">))</span> <span class="p">{</span>
            <span class="cm">/* Found a directory, but ignore . and .. */</span>
            <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">"."</span><span class="p">,</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> 
                <span class="n">strcmp</span><span class="p">(</span><span class="s">".."</span><span class="p">,</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"%*s%s/</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
            <span class="cm">/* Recurse at a new indent level */</span>
            <span class="n">printdir</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">,</span><span class="n">depth</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"%*s%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">chdir</span><span class="p">(</span><span class="s">".."</span><span class="p">);</span>
    <span class="n">closedir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*  Now we move onto the main function.  */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Directory scan of /home:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printdir</span><span class="p">(</span><span class="s">"/home"</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"done.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="39-é”™è¯¯å¤„ç†">3.9 é”™è¯¯å¤„ç†</h3>

<p>é”™è¯¯ä»£ç å­˜åœ¨å­å•Šå¤´æ–‡ä»¶<code class="language-plaintext highlighter-rouge">errno.h</code>ä¸­ï¼Œå…³é”®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-24-20-03-29.png" alt="é”™è¯¯å¤„ç†å›¾ç‰‡" /></p>

<h3 id="310-procæ–‡ä»¶å¤„ç†ç³»ç»Ÿ">3.10 /procæ–‡ä»¶å¤„ç†ç³»ç»Ÿ</h3>

<p>linuxæä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿprocfsï¼Œé€šå¸¸ä»¥/procç›®å½•çš„å½¢å¼å‘ˆç°ã€‚åŒ…å«äº†è®¸å¤šç‰¹æ®Šæ–‡ä»¶ç”¨æ¥å¯¹é©±åŠ¨ç¨‹åºå’Œå†…æ ¸ä¿¡æ¯è¿›è¡Œæ›´é«˜å±‚æ¬¡çš„è®¿é—®ã€‚åªè¦æœ‰æ­£ç¡®çš„è®¿é—®æƒé™ï¼Œå°±å¯ä»¥é€šè¿‡è¯»å†™è¿™äº›æ–‡ä»¶æ¥è·å–ä¿¡æ¯æˆ–è€…è®¾ç½®å‚æ•°ã€‚</p>

<p>procæ–‡ä»¶å¤¹ä¸­åŒ…å«ä»¥PIDå‘½åçš„æ–‡ä»¶å¤¹å’Œå…¶å®ƒè®¾å¤‡æ–‡ä»¶å¤¹ï¼Œè®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯å°±æ”¾åœ¨å…¶ä¸­ã€‚å¯ä»¥ç›´æ¥è¯»å–è¿™äº›æ–‡ä»¶å°±å¯ä»¥è·å–å…¶çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š<code class="language-plaintext highlighter-rouge">cat /proc/cpuinfo</code></p>

<p>è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
processor   : 0
vendor_id   : GenuineIntel
cpu family  : 6
model       : 94
model name  : Intel<span class="o">(</span>R<span class="o">)</span> Core<span class="o">(</span>TM<span class="o">)</span> i5-6400 CPU @ 2.70GHz
stepping    : 3
microcode   : 0xcc
cpu MHz     : 1652.835
cache size  : 6144 KB
physical <span class="nb">id</span> : 0
siblings    : 4
core <span class="nb">id</span>     : 0
cpu cores   : 4
apicid      : 0
initial apicid  : 0
fpu     : <span class="nb">yes
</span>fpu_exception   : <span class="nb">yes
</span>cpuid level : 22
wp      : <span class="nb">yes</span>

......

</code></pre></div></div>

<p>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">cat /proc/net/sockstat</code>è·å¾—ç½‘ç»œå¥—æ¥å­—çš„ä½¿ç”¨ç»Ÿè®¡ã€‚</p>

<h3 id="311-é«˜çº§ä¸»é¢˜-fcnt1å’Œmmap">3.11 é«˜çº§ä¸»é¢˜ fcnt1å’Œmmap</h3>

<h4 id="3111-fcnt1ç³»ç»Ÿè°ƒç”¨">3.11.1 fcnt1ç³»ç»Ÿè°ƒç”¨</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">fcnt1(fildes,F_DUPFD,newfd)</code>:è¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå…¶æ•°å€¼ç­‰äºæˆ–è€…å¤§äºæ•´æ•°<code class="language-plaintext highlighter-rouge">newfd</code>;</li>
  <li><code class="language-plaintext highlighter-rouge">fcnt1(fildes,F_GETFD)</code>ï¼šè¿”å›åœ¨fcntl.hå¤´æ–‡ä»¶ä¸­å®šä¹‰çš„æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ã€‚å…¶ä¸­åŒ…æ‹¬FD_CLOEXEXï¼Œå®ƒçš„ä½œç”¨æ˜¯å†³å®šæ˜¯å¦åœ¨æˆåŠŸè°ƒç”¨äº†æŸä¸ªexecç³»åˆ—çš„ç³»ç»Ÿè°ƒç”¨ä¹‹åå…³é—­è¯¥æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">fcnt1(fildes,F_SETFDï¼Œflag)</code>:è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—</li>
  <li><code class="language-plaintext highlighter-rouge">fcnt1(fildes,F_GETFL)</code>å’Œ<code class="language-plaintext highlighter-rouge">fcnt1(fildes,F_GETFLï¼Œflags)</code>:è·å–å’Œè®¾ç½®æ–‡ä»¶åº„æ¶›æ ‡å¿—å’Œè®¿é—®æ¨¡å¼ã€‚</li>
</ul>

<p>å¯ä»¥ä½¿ä½¿ç”¨fcntlå®ç°å»ºè®®æ€§æ–‡ä»¶é”</p>

<h4 id="3112-mmapå‡½æ•°å†…å­˜æ˜ å°„">3.11.2 mmapå‡½æ•°(å†…å­˜æ˜ å°„)</h4>

<p>å»ºç«‹ä¸€æ®µå¯è¢«ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªç¨‹åºè¯»å†™çš„å†…å­˜ã€‚ä¸€ä¸ªç¨‹åºå¯¹å®ƒæ‰€åšå‡ºçš„ä¿®æ”¹å¯ä»¥è¢«å…¶å®ƒç¨‹åºçœ‹è§ã€‚</p>

<p>mmapåˆ›å»ºä¸€ä¸ªæŒ‡å‘ä¸€æ®µå†…å­˜åŒºåŸŸçš„æŒ‡é’ˆï¼Œè¯¥å†…å­˜åŒºåŸŸä¸å¯ä»¥é€šè¿‡ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶çš„æè¿°ç¬¦è®¿é—®çš„å†…å®¹ç›¸å…³ã€‚</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/mman.h&gt;
</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span><span class="kt">int</span> <span class="n">prot</span><span class="p">,</span><span class="kt">int</span> <span class="n">flags</span><span class="p">,</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span><span class="kt">off_t</span> <span class="n">off</span><span class="p">);</span>
</code></pre></div></div>
<p>ä½¿ç”¨offå‚æ•°æ¥æ”¹å˜ï¼Œç»è¿‡å…±äº«å†…å­˜æ®µè®¿é—®çš„æ–‡ä»¶ä¸­æ•°æ®çš„èµ·å§‹åç§»ã€‚æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æœ‰<code class="language-plaintext highlighter-rouge">fildes</code>å‚æ•°ç»™å‡ºã€‚å¯ä»¥è®¿é—®çš„æ•°æ®é‡(å†…å­˜æ®µçš„æˆéƒ½)ç”±lenå‚æ•°è®¾ç½®ã€‚
ä½¿ç”¨addræ¥è¯·æ±‚åœ°å€ï¼Œå¦‚æœå–å€¼ä¸º0ï¼Œç»“æœæŒ‡é’ˆå°†ä¼šè‡ªåŠ¨åˆ†é…ã€‚
protå‚æ•°ç”¨äºè®¾ç½®å†…å­˜æ®µçš„è®¿é—®æƒé™ï¼Œä¸‹é¢æ˜¯å…¶æŒ‰ä½ORçš„ç»“æœ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PROT_READ</code>:å…è®¸è¯»è¯¥å†…å­˜æ®µã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">PROT_WRITE</code>:å…è®¸å†™è¯¥å†…å­˜æ®µã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">PROT_EXEC</code>:å…è®¸æ‰§è¡Œè¯¥å†…å­˜æ®µã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">PROT_NONE</code>:è¯¥å†…å­˜æ®µä¸èƒ½è¢«è®¿é—®ã€‚
flagså‚æ•°å½±å“å¦‚ä¸‹ï¼š</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-08-30-14-14-16.png" alt="é€‰é¡¹å›¾ç‰‡" /></p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">msync</code>å‡½æ•°ï¼šæŠŠåœ¨è¯¥å†…å­˜æ®µçš„æŸä¸ªéƒ¨åˆ†æˆ–æ•´æ®µä¸­çš„ä¿®æ”¹å†™å›åˆ°è¢«æ˜ å°„çš„æ–‡ä»¶ä¸­(æˆ–è€…ä»è¢«æ˜ å°„æ–‡ä»¶é‡Œè¯»å‡º)</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/mman.h&gt;
</span><span class="kt">int</span> <span class="nf">msync</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span><span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
</code></pre></div></div>
<p>flagså‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-08-30-14-24-19.png" alt="flagsç›¸å…³å‚æ•°" /></p>

<p>é‡Šæ”¾å†…å­˜æ®µ</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cm">/*  We start by defining a RECORD structure
    and then create NRECORDS versions each recording their number.
    These are appended to the file records.dat. 
*/</span>

<span class="cp">#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">integer</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">string</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
<span class="p">}</span> <span class="n">RECORD</span><span class="p">;</span>

<span class="cp">#define NRECORDS (100)
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="c1">//ä½¿ç”¨recordæ•°æ®ç»“æ„ç”¨æ¥ä¿å­˜ç›¸å…³è®°å½•å’Œç¼–å·ã€‚</span>

    <span class="n">RECORD</span> <span class="n">record</span><span class="p">,</span> <span class="o">*</span><span class="n">mapped</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"records.dat"</span><span class="p">,</span><span class="s">"w+"</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NRECORDS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">record</span><span class="p">.</span><span class="n">integer</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="c1">//è¾“å‡ºç›¸å…³ä¿¡æ¯</span>

        <span class="n">sprintf</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">string</span><span class="p">,</span><span class="s">"RECORD-%d"</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
        <span class="c1">//å°†ä¿¡æ¯å†™å…¥åˆ°æ–‡ä»¶ä¸­</span>

        <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">record</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"records.dat"</span><span class="p">,</span><span class="s">"r+"</span><span class="p">);</span>
    <span class="c1">//é‡ç½®seekä¸­çš„è®°å½•ä¸ºç¬¬43æ¡</span>

    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="mi">43</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span><span class="n">SEEK_SET</span><span class="p">);</span>
    <span class="c1">//è¯»å–ç›¸å…³æ•°æ®</span>

    <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">record</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">record</span><span class="p">.</span><span class="n">integer</span> <span class="o">=</span> <span class="mi">143</span><span class="p">;</span>
    <span class="c1">//è¾“å‡ºç›¸å…³çš„ä¿¡æ¯</span>

    <span class="n">sprintf</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">string</span><span class="p">,</span><span class="s">"RECORD-%d"</span><span class="p">,</span><span class="n">record</span><span class="p">.</span><span class="n">integer</span><span class="p">);</span>

    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="mi">43</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span><span class="n">SEEK_SET</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">record</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fp</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>


    <span class="c1">//å°†è®°å½•æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œè®¿é—®ç¬¬43æ¡è®°å½•ï¼ŒæŠŠå®ƒçš„æ•´æ•°å€¼æ”¹ä¸º243(åŒæ—¶æ›´æ–°è¯¥è®°å½•ä¸­çš„å­—ç¬¦ä¸²)</span>
    
    <span class="c1">//æ‰“å¼€æ–‡ä»¶</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"records.dat"</span><span class="p">,</span><span class="n">O_RDWR</span><span class="p">);</span>
    <span class="c1">//è¿›è¡Œå‡½æ•°æ˜ å°„</span>

    <span class="n">mapped</span> <span class="o">=</span> <span class="p">(</span><span class="n">RECORD</span> <span class="o">*</span><span class="p">)</span><span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NRECORDS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> 
                          <span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span> <span class="n">MAP_SHARED</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">//è·å–mmapä¸­çš„ç¬¬43ä¸ªæ•°æ®</span>

    <span class="n">mapped</span><span class="p">[</span><span class="mi">43</span><span class="p">].</span><span class="n">integer</span> <span class="o">=</span> <span class="mi">243</span><span class="p">;</span>
    <span class="c1">//å°†æ•°æ®ä¿å­˜åœ¨mapped[43].stringä¸­</span>

    <span class="n">sprintf</span><span class="p">(</span><span class="n">mapped</span><span class="p">[</span><span class="mi">43</span><span class="p">].</span><span class="n">string</span><span class="p">,</span><span class="s">"RECORD-%d"</span><span class="p">,</span><span class="n">mapped</span><span class="p">[</span><span class="mi">43</span><span class="p">].</span><span class="n">integer</span><span class="p">);</span>
    <span class="c1">//å°†ä¿®æ”¹æ·»åŠ åˆ°æ–‡ä»¶ä¸­</span>

    <span class="n">msync</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">mapped</span><span class="p">,</span> <span class="n">NRECORDS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">MS_ASYNC</span><span class="p">);</span>
    <span class="c1">//é”€æ¯æ˜ å°„çš„å†…å­˜ã€‚</span>

    <span class="n">munmap</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">mapped</span><span class="p">,</span> <span class="n">NRECORDS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span>
    <span class="n">close</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="4-linuxç¯å¢ƒ">4 Linuxç¯å¢ƒ</h2>

<p>åœ¨linuxå‘½ä»¤è¡Œä¸­ï¼Œå»ºè®®æ¯ä¸€ä¸ªå‘½ä»¤è¡Œå¼€å…³éƒ½åº”è¯¥ä»¥ä¸€ä¸ªçŸ­æ¨ªçº¿å¼€å¤´ï¼Œå…¶ååŒ…å«å•ä¸ªå­—æ¯æˆ–æ•°å­—ã€‚è·å–å‚æ•°å’Œæ£€æŸ¥çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">arg</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">arg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">arg</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">arg</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'-'</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"option: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"argument %d: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">arg</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>linuxä¸­æä¾›äº†getoptå‡½æ•°ï¼Œæ”¯æŒéœ€è¦å…³è”å€¼å’Œä¸éœ€è¦å…³è”å€¼çš„é€‰é¡¹</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">getopt</span><span class="p">(</span><span class="kt">int</span> <span class="n">aegc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">argv</span><span class="p">[],</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optarg</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">optind</span><span class="p">,</span><span class="n">opterr</span><span class="p">,</span><span class="n">optopt</span><span class="p">;</span>
</code></pre></div></div>

<p>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">opt</span><span class="p">;</span>

    <span class="k">while</span><span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">getopt</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">":if:lr"</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">'i'</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'l'</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'r'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"option: %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">opt</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'f'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"filename: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">optarg</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">':'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"option needs a value</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'?'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"unknown option: %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">optopt</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(;</span> <span class="n">optind</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">optind</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"argument: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">optind</span><span class="p">]);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//è¾“å…¥ï¼š ./argopt -i -lr 'hi there' -f fred.c -q</span>

<span class="cm">/*
è¾“å‡ºï¼š

option: i
option: l
option: r
filename: fred.c
unknown option: q
argument :hi there

*/</span>

</code></pre></div></div>

<p>getopt_long:æ¥å—ä»¥åŒåˆ’çº¿(â€“)å¼€å§‹çš„é•¿å‚æ•°ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="cp">#define _GNU_SOURCE
#include &lt;getopt.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">opt</span><span class="p">;</span>
    <span class="k">struct</span> <span class="nc">option</span> <span class="n">longopts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">"initialize"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="sc">'i'</span><span class="p">},</span>
	<span class="p">{</span><span class="s">"file"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="sc">'f'</span><span class="p">},</span>
	<span class="p">{</span><span class="s">"list"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="sc">'l'</span><span class="p">},</span>
	<span class="p">{</span><span class="s">"restart"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="sc">'r'</span><span class="p">},</span>
    <span class="c1">//æ³¨æ„å¿…é¡»åŒ…å«å…¨ä¸º0çš„ç»“æ„ç»“å°¾</span>

	<span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}</span>
    <span class="p">};</span>

    <span class="k">while</span><span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">getopt_long</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">":if:lr"</span><span class="p">,</span> <span class="n">longopts</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">'i'</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'l'</span><span class="p">:</span>
        <span class="k">case</span> <span class="sc">'r'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"option: %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">opt</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'f'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"filename: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">optarg</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">':'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"option needs a value</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'?'</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"unknown option: %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">optopt</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(;</span> <span class="n">optind</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">optind</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"argument: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">optind</span><span class="p">]);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>


</code></pre></div></div>

<p><img src="https://wangpengcheng.github.io/img/2019-08-30-15-42-39.png" alt="optionç»“æ„ä½“" /></p>

<h3 id="42-ç¯å¢ƒå˜é‡">4.2 ç¯å¢ƒå˜é‡</h3>

<p>linuxä¸­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">getenv(const char* env_name)</code>å’Œ<code class="language-plaintext highlighter-rouge">int putenv(const char *string)</code>æ¥è¿›è¡Œç¯å¢ƒå˜é‡çš„è¯»å–å’Œè®¾ç½®ã€‚</p>

<h3 id="43-æ—¥æœŸå’Œæ—¶é—´">4.3 æ—¥æœŸå’Œæ—¶é—´</h3>

<p>linuxä¸­å¯ä»¥ä½¿ç”¨timeå‡½æ•°æ¥å¾—åˆ°åº•å±‚çš„æ—¶é—´å€¼ï¼Œå®ƒè¿”å›çš„æ˜¯ä»çºªå…ƒå¼€å§‹è‡³ä»Šçš„ç§’æ•°ï¼Œtlocä¸æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œtimeå‡½æ•°è¿˜ä¼šæŠŠè¿”å›å€¼å†™å…¥tlocæŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ã€‚</p>

<ul>
  <li>difftime(time_t time1,time_t time2): è®¡ç®—ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„æ—¶é—´å·®ã€‚å€¼ä½œä¸ºæµ®ç‚¹æ•°è¿”å›ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">struct tm *gmttime(const time_t timeval)</code>:å°†åº•å±‚æ—¶é—´å€¼åˆ†è§£ä¸ºä¸€ä¸ªç»“æ„å‡½æ•°ã€‚</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-08-30-21-22-52.png" alt="tmç»“æ„çš„æˆå‘˜å‡½æ•°" /></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;time.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">time_t</span> <span class="n">the_time</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">the_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">((</span><span class="kt">time_t</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"The time is %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">the_time</span><span class="p">);</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ä¸‹é¢æ˜¯gmtimeå‡½æ•°çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;time.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">tm</span> <span class="o">*</span><span class="n">tm_ptr</span><span class="p">;</span>
    <span class="kt">time_t</span> <span class="n">the_time</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">the_time</span><span class="p">);</span>
    <span class="n">tm_ptr</span><span class="o">=</span><span class="n">gmtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">the_time</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Raw time is %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">the_time</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"gmtime gives </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"date: %02d/%02d/%02d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> 
        <span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_year</span><span class="p">,</span><span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_mon</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_mday</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"time: %02d:%02d:%02d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
        <span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_hour</span><span class="p">,</span> <span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_min</span><span class="p">,</span> <span class="n">tm_ptr</span><span class="o">-&gt;</span><span class="n">tm_sec</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">localtime(const time_t *timeval)</code>:ä¼šæ ¹æ®æ—¶åŒºè¿›è¡Œæ›´æ­£ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">mktime(struct tm *timeptr)</code>:å°†timeptrè½¬æ¢ä¸ºåŸå§‹çš„mktimeå‡½æ•°ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">char *asctime(const struct tm *timeptr)</code>:è¿”å›æ—¶é—´å­—ç¬¦ä¸²ã€‚è¡¨ç¤ºå®é™…çš„æ—¶é—´ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">char *ctime(const time_t *timeval)</code>:ç›¸å½“äº<code class="language-plaintext highlighter-rouge">asctime(localtime(timeval))</code>,è½¬æ¢ä¸ºæ›´ç®€å•çš„æœ¬åœ°æ—¶é—´ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">size_t strftime(char *s,size_t maxsize,const char *format, struct tm *timeptr)</code>:å‡½æ•°æ ¼å¼åŒ–timeptræŒ‡é’ˆæŒ‡å‘çš„tmç»“æ„æ‰€è¡¨ç¤ºçš„æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶å°†ç»“æœæ”¾åœ¨å­—ç¬¦ä¸²sä¸­ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">size_t strptime(const char *buff,const char *format,struct tm *timeptr)</code>:å‡½æ•°æ ¼å¼åŒ–timeptræŒ‡é’ˆæŒ‡å‘çš„tmç»“æ„æ‰€è¡¨ç¤ºçš„æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶å°†ç»“æœæ”¾åœ¨å­—ç¬¦ä¸²sä¸­ã€‚</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-08-30-21-44-41.png" alt="strftimeçš„ä¸€èˆ¬æ ¼å¼" /></p>

<h3 id="44-ä¸´æ—¶æ–‡ä»¶">4.4 ä¸´æ—¶æ–‡ä»¶</h3>

<p>linuxä¸­å¯ä»¥ä½¿ç”¨ç›¸å…³çš„å‡½æ•°ï¼Œè¿›è¡Œä¸´æ—¶æ–‡ä»¶çš„æ“ä½œã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">char *tmpnam(char *s)</code>:ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶åã€‚ä½†æ˜¯æ³¨æ„è¿™é‡Œå¯èƒ½ä¼šå­˜åœ¨å¦å¤–ä¸€ä¸ªç¨‹åºåˆ›å»ºå‡ºçš„æ–‡ä»¶ååŒåçš„æ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">FILE *tmpfile(void)</code>:ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶ç´¢å¼•ï¼Œå¯ä»¥é¿å…é‡åçš„æƒ…å†µå‘ç”Ÿã€‚è¿”å›ä¸€ä¸ªæ–‡ä»¶æµæŒ‡é’ˆã€‚è¯¥æ–‡ä»¶ä»¥è¯»å†™çš„æ–¹å¼æ‰“å¼€(é€šè¿‡w+æ–¹å¼çš„fopen),å½“å¯¹å®ƒçš„æ‰€æœ‰å¼•ç”¨å…¨éƒ¨å…³é—­æ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">char *mktemp(char* template)/int mkstemp(char *template)</code>ï¼šæŒ‡å®šå‡½æ•°æ¨¡æ¿è¿”å›åˆ›å»ºçš„æ–‡ä»¶ã€‚templateå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªä»¥6ä¸ªxå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>

<h3 id="45-ç”¨æˆ·ä¿¡æ¯">4.5 ç”¨æˆ·ä¿¡æ¯</h3>

<p>åœ¨<code class="language-plaintext highlighter-rouge">sys/types.h</code>ä¸­å­˜åœ¨ç±»å‹<code class="language-plaintext highlighter-rouge">uid_t</code>ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå°æ•´æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹UIDçš„å€¼éƒ½å¤§äº100ã€‚å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">getuid</code>å‡½æ•°è¿”å›ç¨‹åºå…³è”çš„UIDï¼Œå®ƒé€šå¸¸æ˜¯å¯åŠ¨ç¨‹åºçš„ç”¨æˆ·çš„UIDã€‚getloginå‡½æ•°è¿”å›ä¸å½“å‰ç”¨æˆ·å…³è”çš„ç™»å½•åç§°ã€‚</p>

<p>ç”¨æˆ·è´¦å·æ•°æ®åº“ã€‚é€šå¸¸ä¿å­˜åœ¨ç³»ç»Ÿæ–‡ä»¶<code class="language-plaintext highlighter-rouge">/etc/passwd</code>ä¸­ã€‚æ¯è¡Œåˆ†åˆ«å¯¹åº”ç”¨æˆ·çš„ï¼šç”¨æˆ·åã€åŠ å¯†å£ä»¤ã€ç”¨æˆ·æ ‡è¯†ç¬¦(UID)ã€ç»„æ ‡è¯†ç¬¦(GID)ã€å…¨åã€homeç›®å½•ã€é»˜è®¤shell.</p>

<p>ç”±æ­¤å¯ä»¥å®ç°ç”¨æˆ·åå’Œå¯†ç çš„ç›¸å…³æŸ¥æ‰¾ä¿¡æ¯å¯ä»¥è¿›è¡Œä¿®æ”¹å’Œè®¿é—®,å¯†ç ä¿¡æ¯ä¸€èˆ¬æ”¾åœ¨<code class="language-plaintext highlighter-rouge">/etc/shadow</code>æ–‡ä»¶ä¸­ã€‚ç”¨ç›¸å…³çš„å¯†ç è®¿é—®æ¥å£ã€‚</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
</span>
<span class="cp">#include &lt;pwd.h&gt;
</span>
<span class="k">struct</span> <span class="nc">passwd</span> <span class="o">*</span><span class="nf">getpwuid</span><span class="p">(</span><span class="n">uid_t</span> <span class="n">uid</span><span class="p">);</span>
<span class="k">struct</span> <span class="nc">passwd</span> <span class="o">*</span><span class="nf">getpwnam</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
</code></pre></div></div>

<p>ä¸‹é¢æ˜¯passwdå…³é”®çš„æ•°æ®ç»“æ„</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-14-42-41.png" alt="passwdç›¸å…³æ•°æ®ç»“æ„" /></p>

<p>ä»å¯†ç æ•°æ®åº“ä¸­æå–ç›¸å…³ä¿¡æ¯</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include &lt;sys/types.h&gt;
#include &lt;pwd.h&gt;
</span>
<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//å®šä¹‰uidå’Œ</span>

    <span class="n">uid_t</span> <span class="n">uid</span><span class="p">;</span>
    <span class="n">gid_t</span> <span class="n">gid</span><span class="p">;</span>
    <span class="c1">//å®šä¹‰ç»“æ„ä½“</span>

    <span class="k">struct</span> <span class="nc">passwd</span> <span class="o">*</span><span class="n">pw</span><span class="p">;</span>
    <span class="n">uid</span><span class="o">=</span><span class="n">getuid</span><span class="p">();</span>
    <span class="n">gid</span><span class="o">=</span><span class="n">getgit</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"User is %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">getlogin</span><span class="p">());</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"User IDs: uid=%d,gid=%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">);</span>
    <span class="n">pw</span><span class="o">=</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span>
    <span class="c1">//è¾“å‡ºå¯¹åº”çš„å‚æ•°</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"UID passwd entry:</span><span class="se">\n</span><span class="s"> name=%s, uid=%d,home=%s,shell=%s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_name</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_uid</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_gid</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_dir</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_shell</span><span class="p">);</span>
    <span class="c1">//è·å–rootç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯</span>

    <span class="n">pw</span><span class="o">=</span><span class="n">getpwnam</span><span class="p">(</span><span class="s">"root"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"root passwd entry: </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"UID passwd entry:</span><span class="se">\n</span><span class="s"> name=%s, uid=%d,home=%s,shell=%s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_name</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_uid</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_gid</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_dir</span><span class="p">,</span><span class="n">pw</span><span class="o">-&gt;</span><span class="n">pw_shell</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<h3 id="46-ä¸»æœºä¿¡æ¯">4.6 ä¸»æœºä¿¡æ¯</h3>

<p>ä¸»æœºä¿¡æ¯ç»“æ„ä½“<code class="language-plaintext highlighter-rouge">utsname</code>å­˜å‚¨åœ¨<code class="language-plaintext highlighter-rouge">sys/utsname.h</code>æ–‡ä»¶ä¸­ã€‚å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">int gethostname(char* name,size_t namelen)</code>å‡½æ•°æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚æˆåŠŸè¿”å›0ï¼Œå¦åˆ™è¿”å›-1ã€‚</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/utsname.h&gt;
</span>
<span class="kt">int</span> <span class="nf">uname</span><span class="p">(</span><span class="k">struct</span> <span class="nc">utsname</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>

</code></pre></div></div>
<p><img src="https://wangpengcheng.github.io/img/2019-09-02-14-59-20.png" alt="unameç›¸å…³å‚æ•°" /></p>

<p>ä¸‹é¢æ˜¯ç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include &lt;sys/utsname.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">computer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="k">struct</span> <span class="nc">utsname</span> <span class="n">uts</span><span class="p">;</span>

    <span class="c1">//è·å–ç›¸å…³å‚æ•°</span>
    <span class="k">if</span><span class="p">(</span><span class="n">gethostname</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">uname</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Could not get host information</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Computer host name is %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">computer</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"System is %s on %s hardware</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">sysname</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">machine</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Nodename is %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">nodename</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Version is %s, %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">release</span><span class="p">,</span> <span class="n">uts</span><span class="p">.</span><span class="n">version</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="47-ä½¿ç”¨æ—¥å¿—">4.7 ä½¿ç”¨æ—¥å¿—</h3>

<p>ä¸€èˆ¬linuxçš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">/usr/adm</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">/var/log</code>ç›®å½•ä¸­ã€‚æ–‡ä»¶<code class="language-plaintext highlighter-rouge">/var/log/message</code>åŒ…å«æ‰€æœ‰çš„ç³»ç»Ÿä¿¡æ¯ã€‚<code class="language-plaintext highlighter-rouge">/var/log/mail</code>åŒ…å«æ¥è‡ªé‚®ä»¶ç³»ç»Ÿçš„å…¶å®ƒæ—¥å¿—ä¿¡æ¯ï¼Œ<code class="language-plaintext highlighter-rouge">/var/log/debug</code>å¯èƒ½åŒ…å«è°ƒè¯•ä¿¡æ¯ã€‚å…·ä½“çš„å¯ä»¥æ ¹æ®<code class="language-plaintext highlighter-rouge">/etc/syslog.conf</code>æ–‡ä»¶æˆ–è€…<code class="language-plaintext highlighter-rouge">/etc/syslog-ng/sys-log-ng.conf</code>æ–‡ä»¶æ¥æ£€æŸ¥ç³»ç»Ÿçš„é…ç½®ã€‚æˆ‘çš„Ubuntu 18.04 ä¼˜éº’éºŸå­˜åœ¨äº<code class="language-plaintext highlighter-rouge">/etc/rsyslog.conf</code>æ–‡ä»¶ä¸­ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„APIè¿›è¡Œæ“ä½œ</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include &lt;syslog.h&gt;
</span><span class="c1">//è¾“å‡ºæ—¥å¿—å‡½æ•°</span>

<span class="kt">void</span> <span class="nf">syslog</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span><span class="n">arguments</span><span class="p">...);</span>
<span class="c1">//å…³é—­å’Œæ‰“å¼€æ—¥å¿—å‡½æ•°</span>

<span class="kt">void</span> <span class="nf">closelog</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">openlog</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ident</span><span class="p">,</span><span class="kt">int</span> <span class="n">logopt</span><span class="p">,</span><span class="kt">int</span> <span class="n">facility</span><span class="p">);</span>
<span class="c1">//è®¾ç½®æ—¥å¿—æ©ç ,æ§åˆ¶æ—¥å¿—çš„ä¼˜å…ˆçº§</span>

<span class="kt">int</span> <span class="nf">setlogmask</span><span class="p">(</span><span class="kt">int</span> <span class="n">maskpri</span><span class="p">);</span>

</code></pre></div></div>
<p>è¿™ä¸ªå‡½æ•°å‘ç³»ç»Ÿçš„æ—¥å¿—å‘é€ä¸€æ¡æ—¥å¿—ä¿¡æ¯ã€‚æ¯æ¡ä¿¡æ¯ä¸­çš„priorityå‚æ•°å¯¹åº”äº†æ—¥å¿—çš„çº§åˆ«ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-15-44-49.png" alt="LOG_USERç›¸å¯¹å€¼" /></p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-15-48-42.png" alt="logoptå‚æ•°é€‰é¡¹" /></p>

<p>ä¸‹é¢æ˜¯ç®€å•æ˜¯ç¤ºä¾‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;syslog.h&gt;
</span>
<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">logmask</span><span class="p">;</span>

    <span class="n">openlog</span><span class="p">(</span><span class="s">"logmask"</span><span class="p">,</span> <span class="n">LOG_PID</span><span class="o">|</span><span class="n">LOG_CONS</span><span class="p">,</span> <span class="n">LOG_USER</span><span class="p">);</span>
    <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="s">"informative message, pid = %d"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_DEBUG</span><span class="p">,</span><span class="s">"debug message, should appear"</span><span class="p">);</span>
    <span class="n">logmask</span> <span class="o">=</span> <span class="n">setlogmask</span><span class="p">(</span><span class="n">LOG_UPTO</span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">));</span>
    <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_DEBUG</span><span class="p">,</span><span class="s">"debug message, should not appear"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="48-èµ„æºå’Œé™åˆ¶">4.8 èµ„æºå’Œé™åˆ¶</h3>

<p>åœ¨<code class="language-plaintext highlighter-rouge">limit.h</code>ä¸­å®šä¹‰äº†è®¸å¤šä»£è¡¨æ“ä½œç³»ç»Ÿæ–¹é¢é™åˆ¶çš„æ˜¾ç¤ºã€‚ç›¸å…³å¸¸é‡å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-15-58-48.png" alt="é™åˆ¶å¸¸é‡ä½¿ç”¨" /></p>

<p>ç›¸å…³çš„è®¾ç½®å‡½æ•°</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/resource.h&gt;
</span>
<span class="kt">int</span> <span class="nf">getpriority</span><span class="p">(</span><span class="kt">int</span> <span class="n">which</span><span class="p">,</span><span class="n">id_t</span> <span class="n">who</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getpriority</span><span class="p">(</span><span class="kt">int</span> <span class="n">which</span><span class="p">,</span><span class="n">id_t</span> <span class="n">who</span><span class="p">,</span><span class="kt">int</span> <span class="n">priority</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getrlimit</span><span class="p">(</span><span class="kt">int</span> <span class="n">resource</span><span class="p">,</span><span class="k">struct</span> <span class="nc">rlimit</span> <span class="o">*</span><span class="n">r_limit</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getrlimit</span><span class="p">(</span><span class="kt">int</span> <span class="n">resource</span><span class="p">,</span><span class="k">const</span> <span class="k">struct</span> <span class="nc">rlimit</span> <span class="o">*</span><span class="n">r_limit</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">getrusage</span><span class="p">(</span><span class="kt">int</span> <span class="n">who</span><span class="p">,</span><span class="k">struct</span> <span class="nc">rusage</span> <span class="o">*</span><span class="n">r_usage</span><span class="p">);</span>
</code></pre></div></div>
<p>cpuè€—è´¹æ—¶é—´å‚æ•°</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-16-03-03.png" alt="ç¡®å®šcpuè€—è´¹æ—¶é—´å‚æ•°" /></p>

<p>å…¶ä¸­<code class="language-plaintext highlighter-rouge">timeval</code>ç»“æ„å®šä¹‰åœ¨å¤´æ–‡ä»¶<code class="language-plaintext highlighter-rouge">sys/time.h</code>ä¸­ã€‚</p>

<p>ä¸€ä¸ªç¨‹åºè€—è´¹çš„CPUæ—¶é—´å¯åˆ†ä¸ºï¼š</p>

<ul>
  <li>ç”¨æˆ·æ—¶é—´ï¼š ç¨‹åºè‡ªèº«çš„æŒ‡ä»¤æ‰€è€—è´¹ç­‰å¾…æ—¶é—´ã€‚</li>
  <li>ç³»ç»Ÿæ—¶é—´ï¼š æ“ä½œç³»ç»Ÿä¸ºç¨‹åºæ‰§è¡Œæ‰€éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼Œå³æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨æˆ–å…¶å®ƒç³»ç»Ÿå‡½æ•°æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</li>
</ul>

<p><strong>æ³¨æ„ï¼šå¤šçº¿ç¨‹ä¸­ç¨‹åºè¿è¡Œæ—¶é—´çš„ç»Ÿè®¡ä¸èƒ½ä½¿ç”¨<code class="language-plaintext highlighter-rouge">ctime.h</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">clock()</code>å‡½æ•°ï¼›å› ä¸ºå®ƒæ˜¯æ ¹æ®cpuæ€»çš„cpuè¿è½¬æ—¶é’Ÿæ¥çš„ï¼Œä¼šæ¯”å•ä¸ªçš„æ—¶é—´é•¿ï¼›ä½¿ç”¨<code class="language-plaintext highlighter-rouge">time</code>(æœ€å°å•ä½ä¸ºs)æˆ–<code class="language-plaintext highlighter-rouge">timeval</code>(çº³ç§’å’Œå¾®ç§’)å‡½æ•°æ¥é€šè¿‡ç³»ç»Ÿæ—¶é—´å¯¹å¤šçº¿ç¨‹è€—è´¹çš„æ—¶é—´è¿›è¡Œç»Ÿè®¡è®¡ç®—ã€‚(<a href="https://blog.csdn.net/u012526003/article/details/80862801">å¤šçº¿ç¨‹C++è¿è¡Œæ—¶é—´ç»Ÿè®¡</a>)</strong></p>

<p>å¯ä»¥ä½¿ç”¨getrusageå‡½æ•°å°†cpuæ—¶é—´ä¿¡æ¯å†™å…¥å‚æ•°<code class="language-plaintext highlighter-rouge">r_usage</code>æŒ‡å‘çš„<code class="language-plaintext highlighter-rouge">rusage</code>ç»“æ„ä¸­ã€‚å‚æ•°<code class="language-plaintext highlighter-rouge">who</code>å¯ä»¥æ˜¯ä¸€ä¸‹å¸¸é‡ï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-16-24-09.png" alt="whoå¸¸é‡é€‰å€¼" /></p>

<p>ä½¿ç”¨whichå‚æ•°ç¡®å®šä¼˜å…ˆçº§</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-16-25-17.png" alt="è·å–ç”¨æˆ·å½“å‰ä¼˜å…ˆçº§" /></p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">getrlimit</code>å’Œ<code class="language-plaintext highlighter-rouge">setrlimit</code>æ¥è¯»å–å’Œè®¾ç½®ç³»ç»Ÿèµ„æºæ–¹é¢çš„é™åˆ¶å‡½æ•°ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-16-45-10.png" alt="è½¯ä»¶é™åˆ¶å‚æ•°" /></p>

<p>linuxä¸­ä¸€èˆ¬çš„çº¿ç¨‹æ•°é‡é™åˆ¶(<a href="https://www.cnblogs.com/guojintao/articles/10389713.html">Linuxæœ€å¤§çº¿ç¨‹æ•°é™åˆ¶</a>;<a href="https://blog.csdn.net/qq_36441027/article/details/81040229">Linuxèµ„æºé™åˆ¶</a>)ä¸º</p>
<ul>
  <li>ç³»ç»Ÿï¼š62228</li>
  <li>ç”¨æˆ·æœ€å¤§è¿›ç¨‹æ•°ï¼š1024</li>
  <li>å•ä¸ªè¿›ç¨‹æœ€å¤§çº¿ç¨‹æ•°ï¼š1024</li>
  <li>çº¿ç¨‹æ ˆçš„å¤§å°(ä¸€èˆ¬é™åˆ¶å› ç´ )ï¼š8M(<a href="https://blog.csdn.net/qq_37924084/article/details/78403764">Linuxæœ€å¤§çº¿ç¨‹æ•°é™åˆ¶</a>)</li>
</ul>

<p>é™¤äº†çº¿ç¨‹æ•°å’Œå†…å­˜ï¼Œlinuxä¸­è¿˜æœ‰å…¶å®ƒè®¸å¤šå› ç´ å¯ä»¥è¿›è¡Œé™åˆ¶ï¼›å®ƒä»¬ä¸€èˆ¬ç”±<code class="language-plaintext highlighter-rouge">rlimit</code>å‡½æ•°ä¸­çš„<code class="language-plaintext highlighter-rouge">resource</code>å‚æ•°æŒ‡å®šã€‚åœ¨å¤´æ–‡ä»¶<code class="language-plaintext highlighter-rouge">sys/resource.h</code>ä¸­å®šä¹‰</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-02-16-56-19.png" alt="ç›¸å…³é™åˆ¶å‚æ•°" /></p>

<h2 id="ç¬¬äº”ç« -ç»ˆç«¯">ç¬¬äº”ç«  ç»ˆç«¯</h2>

<p>ç»ˆç«¯è¾“å…¥å’Œè¾“å‡ºçš„æ¨¡å¼ï¼š</p>

<ol>
  <li>æ ‡å‡†æ¨¡å¼ä¸éæ ‡å‡†æ¨¡å¼ï¼š
    <ul>
      <li>æ ‡å‡†æ¨¡å¼ï¼šç”¨æˆ·æŒ‰ä¸‹å›è½¦é”®ä¹‹åï¼Œç¨‹åºæ¥å—ç»ˆç«¯çš„è¾“å…¥ï¼Œå…è®¸é€€æ ¼å’Œåˆ é™¤ã€‚</li>
      <li>éæ ‡å‡†æ¨¡å¼ï¼šç”¨æˆ·è¾“å…¥æ¥æ”¶ç¨‹åºçš„è®¾ç½®ã€‚</li>
    </ul>
  </li>
</ol>

<p>linuxä¼šæš‚å­˜ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹å›è½¦é”®ã€‚linuxç»ˆç«¯çš„è¾“å‡ºç¼“å†²è®¾ç½®æ˜¯è¡Œç¼“å†²ã€‚å› æ­¤ä¼šä»¥è¡Œä¸ºå•ä½è¿›è¡Œè¾“å‡ºå’Œè¾“å…¥ã€‚</p>

<p>æ³¨æ„ï¼šlinux/unixéƒ½æ˜¯ä»¥æ¢è¡Œç¬¦<code class="language-plaintext highlighter-rouge">\n</code>è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸï¼Œå¹¶ä¸æ˜¯æ¢è¡Œç¬¦ï¼Œå…¶å®ƒæ“ä½œç³»ç»Ÿ(å¦‚MS-DOS)ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ä¸¤ä¸ªè‡ªè¯»çš„ç»“åˆæ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚ä½¿ç”¨é‡å®šå‘è¾“å‡º(<code class="language-plaintext highlighter-rouge">&gt;</code>æˆ–<code class="language-plaintext highlighter-rouge">&gt;&gt;</code>)å’Œè¾“å…¥(<code class="language-plaintext highlighter-rouge">&lt;</code>æˆ–<code class="language-plaintext highlighter-rouge">&lt;&lt;</code>)å¯ä»¥é‡æ–°å®šä¹‰è¾“å…¥å’Œè¾“å‡ºã€‚</p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">unistd.h</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">int isatty(int fd)</code>å¯ä»¥åˆ¤æ–­å‡ºè¯¥æè¿°ç¬¦æ˜¯å¦è¿æ¥åˆ°äº†ä¸€ä¸ªç»ˆç«¯(è¿æ¥è¿”å›1ï¼Œå¦åˆ™è¿”å›0)ã€‚</p>

<p>linuxä¸­çš„<code class="language-plaintext highlighter-rouge">/dev/tty</code>ç‰¹æ®Šè®¾å¤‡ç›´æ¥å¯¹ç»ˆç«¯è¿›è¡Œè¯»å†™ï¼ŒæŒ‡å‘å½“å‰çš„ç»ˆç«¯æˆ–ç™»å½•ä¼šè¯.</p>

<h3 id="53-ç»ˆç«¯é©±åŠ¨ç¨‹åºå’Œé€šç”¨ç»ˆç«¯æ¥å£">5.3 ç»ˆç«¯é©±åŠ¨ç¨‹åºå’Œé€šç”¨ç»ˆç«¯æ¥å£</h3>

<p>linuxä¸­å¯ä»¥ä½¿ç”¨é€šç”¨ç»ˆç«¯æ¥å£(GTI)æ¥æ§åˆ¶ç»ˆç«¯ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-20-17-24.png" alt="ç»ˆç«¯æ¨¡å‹ç»“æ„å›¾" /></p>

<p>ä¸»è¦çš„æ§åˆ¶åŠŸèƒ½æœ‰ï¼š</p>

<ul>
  <li>è¡Œç¼–è¾‘:æ˜¯å¦å…è®¸ä½¿ç”¨é€€æ ¼é”®è¿›è¡Œç¼–è¾‘ã€‚</li>
  <li>ç¼“å­˜ï¼šæ˜¯ç«‹å³è¯»å–å­—ç¬¦ï¼Œè¿˜æ˜¯ç­‰å¾…ä¸€æ®µå¯é…ç½®çš„å»¶è¿Ÿä¹‹åå†è¯»å–å®ƒä»¬ã€‚</li>
  <li>å›æ˜¾ï¼šå…è®¸æ§åˆ¶å­—ç¬¦çš„å›æ˜¾ï¼Œä¾‹å¦‚è¯»å–å¯†ç æ—¶ã€‚</li>
  <li>å›è½¦/æ¢è¡Œ(CR/LF):å®šä¹‰å¦‚ä½•åœ¨è¾“å…¥/è¾“å‡ºæ—¶æ˜ å°„å›è½¦/æ¢è¡Œç¬¦ï¼Œæ¯”å¦‚æ‰“å°<code class="language-plaintext highlighter-rouge">\n</code>å­—ç¬¦æ—¶å¦‚ä½•å¤„ç†ã€‚</li>
  <li>çº¿é€Ÿ:å¾ˆå°‘ç”¨äºPCæ§åˆ¶å°ï¼Œä½†å¯¹è°ƒåˆ¶è§£è°ƒå™¨æˆ–é€šè¿‡ä¸²è¡Œçº¿è¿æ¥çš„ç»ˆç«¯éå¸¸é‡è¦ã€‚</li>
</ul>

<p>ä¸‹é¢æ˜¯uinuxä¸­çš„ç¡¬ä»¶æ¨¡å‹</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-20-31-02.png" alt="è®¾å¤‡æ¨¡å‹" /></p>

<h3 id="54-termiosç»“æ„">5.4 termiosç»“æ„</h3>

<p>termiosæ•°æ®ç»“æ„å’Œç›¸å…³å•æ•°è°ƒç”¨éƒ½å®šä¹‰åœ¨å¤´æ–‡ä»¶<code class="language-plaintext highlighter-rouge">termios.h</code>ä¸­ï¼Œå½“ä½¿ç”¨å…¶ä¸­çš„å‡½æ•°æ—¶ï¼Œéœ€è¦æ·»åŠ åŠ¨æ€è¿æ¥åº“<code class="language-plaintext highlighter-rouge">ncurses</code>ã€‚</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-20-39-54.png" alt="æœ€å°termiosçš„ç»“æ„ä½“å®šä¹‰" /></p>

<p>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">int tcgetattr(int fd,struct termios *termios_p)</code>æ¥è¿›è¡Œç»“æ„ä½“çš„åˆå§‹åŒ–ï¼Œå†ä½¿ç”¨<code class="language-plaintext highlighter-rouge">int tcsetattr(int fd,int actions,const strcut termios *termios_p)</code>æ¥è¿›è¡Œå¯¹åº”å€¼çš„ä¿®æ”¹ã€‚</p>

<p>actioné€‰é¡¹å¦‚ä¸‹ï¼š</p>
<ul>
  <li>TCSANON:ç«‹åˆ»å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚</li>
  <li>TCSADRAIN:ç­‰å½“å‰çš„è¾“å‡ºå®Œæˆä¹‹åå†å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚</li>
  <li>
    <p>TCSAFLUSH:ç­‰å½“å‰çš„è¾“å‡ºå®Œæˆä¹‹åå†å¯¹å€¼è¿›è¡Œä¿®æ”¹,ä½†ä¸¢å¼ƒè¿˜æœªä»<code class="language-plaintext highlighter-rouge">read</code>è°ƒç”¨è¿”å›çš„å½“å‰å¯ç”¨çš„ä»»ä½•è¾“å…¥ã€‚
è®¾ç½®çš„å€¼ï¼Œå½±å“çš„åŠŸèƒ½æŒ‰ç…§ä¸åŒçš„æ¨¡å¼è¢«åˆ†æˆä¸€ä¸‹å‡ ç»„ï¼š</p>
  </li>
  <li>è¾“å…¥æ¨¡å¼ï¼šè¾“å…¥æ¨¡å¼æ§åˆ¶è¾“å…¥æ•°æ®(ç»ˆç«¯é©±åŠ¨ç¨‹åºä»ä¸²è¡Œå£æˆ–è€…é”®ç›˜æ¥æ”¶åˆ°çš„å­—ç¬¦)åœ¨è¢«ä¼ é€’ç»™ç¨‹åºä¹‹å‰çš„å¤„ç†æ–¹å¼ã€‚è®¾ç½®<code class="language-plaintext highlighter-rouge">c_iflag</code>æˆå‘˜çš„æ ‡å¿—è¿›è¡Œæ§åˆ¶ï¼Œå…¶å¯é€‰å€¼å¦‚ä¸‹ï¼š</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-20-48-47.png" alt="c_iflagsç›¸å…³é€‰é¡¹" /></p>

<ul>
  <li>è¾“å‡ºæ¨¡å¼ï¼šæ§åˆ¶è¾“å‡ºæ¨¡å¼çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡è®¾ç½®<code class="language-plaintext highlighter-rouge">c_oflag</code>æˆå‘˜çš„æ ‡å¿—å¯¹è¾“å‡ºæ¨¡å¼è¿›è¡Œæ§åˆ¶ã€‚é€‰é¡¹å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://wangpengcheng.github.io/img/2019-09-03-20-55-51.png" alt="è¾“å‡ºæ ‡å¿—è®¾ç½®" /></li>
</ul>

<p>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®OPOSTï¼Œåˆ™æ‰€æœ‰å…¶å®ƒæ ‡å¿—éƒ½è¢«å¿½ç•¥ã€‚</p>
<ul>
  <li>æ§åˆ¶æ¨¡å¼ï¼šæ§åˆ¶ç»ˆç«¯çš„ç¡¬ä»¶ç‰¹æ€§ã€‚<code class="language-plaintext highlighter-rouge">c_cflag</code>æˆå‘˜çš„æ ‡å¿—å¯¹æ§åˆ¶æ¨¡å¼è¿›è¡Œé…ç½®ã€‚å¯é€‰å‚æ•°å¦‚ä¸‹ï¼š</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-20-58-38.png" alt="ç¡¬ä»¶ç›¸å…³è®¾ç½®" /></p>

<ul>
  <li>æœ¬åœ°æ¨¡å¼ï¼šæ§åˆ¶ç»ˆç«¯çš„å„ç§ç‰¹æ€§ã€‚æ›´æ”¹<code class="language-plaintext highlighter-rouge">c_lflag</code>å‚æ•°ï¼Œæˆå‘˜çš„å®å†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-21-11-59.png" alt="c_lflagå®å®šä¹‰å†…å®¹" /></p>

<p>è¿™é‡Œæœ€é‡è¦çš„ä¸¤ä¸ªæ ‡å¿—æ˜¯ECHO(æŠ‘åˆ¶é”®å…¥å­—ç¬¦çš„å›æ˜¾)å’ŒICANON(å°†ç»ˆç«¯åœ¨ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„æ¥æ”¶å­—ç¬¦å¤„ç†æ¨¡å¼é—´è¿›è¡Œåˆ‡æ¢ï¼Œè®¾ç½®äº†ICANONæ ‡å¿—ï¼Œå°±å¯ç”¨æ ‡å‡†è¾“å…¥è¡Œè¿›è¡Œå¤„ç†æ¨¡å¼ï¼Œå¦åˆ™ï¼Œå°±å¯ç”¨éæ ‡å‡†å¤„ç†æ¨¡å¼)ã€‚</p>

<ul>
  <li>ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ï¼šå¯¹äºä¸€äº›ç‰¹æ®Šçš„ç»„åˆæŒ‰é”®(å¦‚<code class="language-plaintext highlighter-rouge">ctrl+c</code>)è¿›è¡Œå¤„ç†ã€‚å¹¶ä¸”ä½¿ç”¨<code class="language-plaintext highlighter-rouge">c_cc</code>æ•°ç»„æˆå‘˜å°†å„ç§ç‰¹æ®Šæ§åˆ¶å­—ç¬¦æ˜ å°„åˆ°å¯¹åº”çš„æ”¯æŒå‡½æ•°ã€‚æ¯ä¸ªå­—ç¬¦çš„ä½ç½®æ˜¯ç”±ä¸€ä¸ªå®è¿›è¡Œå®šä¹‰çš„ï¼Œä½†å¹¶ä¸é™åˆ¶è¿™äº›å­—ç¬¦å¿…é¡»æ˜¯æ§åˆ¶å­—ç¬¦ã€‚æ ¹æ®æ¨¡å¼çš„ä¸åŒæ•°ç»„ä¸‹æ ‡ä¸åŒ
    <ul>
      <li>æ ‡å‡†æ¨¡å¼çš„æ•°ç»„ä¸‹æ ‡ï¼š</li>
    </ul>
  </li>
</ul>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-21-33-43.png" alt="æ ‡å‡†æ¨¡å¼çš„æ•°ç»„ä¸‹æ ‡" />
    + éæ ‡å‡†æ¨¡å¼çš„æ•°ç»„ä¸‹æ ‡ï¼š</p>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-21-35-32.png" alt="éæ ‡å‡†æ¨¡å¼ä¸‹çš„æ•°ç»„ä¸‹æ ‡" /></p>

<h4 id="542-ç‰¹æ®Šæ§åˆ¶å­—ç¬¦">5.4.2 ç‰¹æ®Šæ§åˆ¶å­—ç¬¦</h4>

<p><img src="https://wangpengcheng.github.io/img/2019-09-03-21-36-41.png" alt="ç‰¹æ®Šæ§åˆ¶å­—ç¬¦" /></p>

<h4 id="543-timeå’Œminå€¼">5.4.3 TIMEå’ŒMINå€¼</h4>

<p>TIMEå’ŒMINçš„å€¼åªèƒ½ç”¨äºéæ ‡å‡†æ¨¡å¼ï¼Œä¸¤è€…ç»“åˆèµ·æ¥å…±åŒæ§åˆ¶å¯¹è¾“å…¥çš„è¯»å–ã€‚ä¸¤è€…çš„ç»“åˆåˆ†ä¸ºå››ä¸­æƒ…å†µï¼š</p>

<ul>
  <li>MIN=0&amp;&amp;TIME=0:readè°ƒç”¨æ€»æ˜¯ç«‹åˆ»è¿”å›ï¼Œå¦‚æœå­˜åœ¨å¾…å¤„ç†çš„å­—ç¬¦ï¼Œå°±ä¼šè¿”å›ï¼›å¦‚æœæ²¡æœ‰å°±ä¼šè¿”å›0,å¹¶ä¸”ä¸è¯»å–ä»»ä½•å­—ç¬¦ã€‚</li>
  <li>MIN=0&amp;&amp;TIME&gt;0:å­—ç¬¦å¯ä»¥å¤„ç†æˆ–è€…æ˜¯ç»è¿‡TIMEä¸ªååˆ†ä¹‹ä¸€ç§’çš„æ—¶é—´é—´éš”ï¼Œreadè°ƒç”¨å°±è¿”å›ã€‚å¦‚æœå› ä¸ºè¶…æ—¶è€Œæœªè¯»åˆ°ä»»ä½•å­—ç¬¦ï¼Œreadå°±è¿”å›0ï¼Œå¦åˆ™è¿”å›è¯»å–çš„å­—ç¬¦æ•°ç›®ã€‚</li>
  <li>MIN&gt;0&amp;&amp;TIME=0:è¿™ç§æƒ…å†µä¸‹ï¼Œreadå°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰MINä¸ªå­—ç¬¦å¯ä»¥è¯»å–æ—¶æ‰è¿”å›è¯»å–å­—ç¬¦çš„æ•°é‡ã€‚è¾¾åˆ°æ–‡ä»¶å°¾æ—¶è¿”å›0.</li>
  <li>MIN&gt;0&amp;&amp;TIME&gt;0:å½“readè¢«è°ƒç”¨æ—¶ï¼Œä¼šç­‰å¾…æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨æ¥æ”¶åˆ°ä¸€ä¸ªå­—ç¬¦ä»¥åŠåç»­çš„æ¯ä¸ªå­—ç¬¦ä¹‹åï¼Œä¸€ä¸ªå­—ç¬¦é—´éš”å®šæ—¶å™¨è¢«å¯åŠ¨(æˆ–è€…é‡å¯)ã€‚å½“æœ‰MINä¸ªå­—ç¬¦å¯è¯»æˆ–ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ—¶é—´é—´éš”è¶…è¿‡TIME*0.1sæ—¶ï¼Œreadè°ƒç”¨è¿”å›ã€‚</li>
</ul>

<h4 id="544-é€šè¿‡shellç‹æ–‡ç»ˆç«¯æ¨¡å¼">5.4.4 é€šè¿‡shellç‹æ–‡ç»ˆç«¯æ¨¡å¼</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#æŸ¥çœ‹å½“å‰çš„termios.hè®¾ç½®æƒ…å†µ</span>

<span class="nb">stty</span> <span class="nt">-a</span>

<span class="c">#é‡æ–°è®¾ç½®æ ‡è¯†ç¬¦çš„å¿«æ·é”®</span>

<span class="nb">stty </span>sane
<span class="c"># é€šè¿‡ä¿å­˜è®¾ç½®å’Œé‡æ–°è¯»å–æ¥æ›´æ”¹ç»ˆç«¯è®¾ç½®</span>

<span class="c">#è¾“å‡ºå’Œä¿å­˜è®¾ç½®</span>

<span class="nb">stty</span> <span class="nt">-g</span> <span class="o">&gt;</span> save_stty
<span class="c">#è¯»å–è®¾ç½®</span>

<span class="nb">stty</span> <span class="si">$(</span><span class="nb">cat </span>save_stty<span class="si">)</span>

<span class="c">#ç›´æ¥æ“ä½œè®¾ç½®</span>

<span class="nb">stty</span> <span class="nt">-icanon</span> min 1 time0

<span class="c">#é‡æ–°æ¢å¤å¯ç”¨å›æ˜¾åŠŸèƒ½</span>

<span class="nb">stty</span> <span class="nt">-echo</span>

</code></pre></div></div>

<h4 id="545-ç»ˆç«¯é€Ÿåº¦">5.4.5 ç»ˆç«¯é€Ÿåº¦</h4>

<p>ä½¿ç”¨å¦‚ä¸‹å‡½æ•°æ›´æ”¹ç»ˆç«¯çš„åˆ·æ–°é€Ÿåº¦</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;termios.h&gt;
</span><span class="n">speed_t</span> <span class="nf">cfgetispeed</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="nc">termios</span> <span class="o">*</span><span class="p">);</span>
<span class="n">speed_t</span> <span class="nf">cfgetospeed</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="nc">termios</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">cfsetispeed</span><span class="p">(</span><span class="k">struct</span> <span class="nc">termios</span> <span class="o">*</span><span class="p">,</span><span class="n">speed_t</span> <span class="n">speed</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">cfsetospeed</span><span class="p">(</span><span class="k">struct</span> <span class="nc">termios</span> <span class="o">*</span><span class="p">,</span><span class="n">speed_t</span> <span class="n">speed</span><span class="p">);</span>
</code></pre></div></div>
<p>speed_t ç›¸å…³å‚æ•°ï¼š</p>

<ul>
  <li>B0:æŒ‚èµ·ç»ˆç«¯</li>
  <li>B1200ï¼š1200æ³¢ç‰¹</li>
  <li>B2400ï¼š2400æ³¢ç‰¹</li>
  <li>B9600ï¼š9600æ³¢ç‰¹</li>
  <li>B19200ï¼š19200æ³¢ç‰¹</li>
  <li>B38400ï¼š38400æ³¢ç‰¹</li>
</ul>

<h4 id="546-å…¶å®ƒå‡½æ•°">5.4.6 å…¶å®ƒå‡½æ•°</h4>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;termios.h&gt;
</span>
<span class="c1">//è®©è°ƒç”¨ç¨‹åºä¸€ç›´ç­‰å¾…</span>

<span class="kt">int</span> <span class="nf">tcdrain</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>
<span class="c1">//æš‚åœæˆ–é‡æ–°å¼€å§‹è¾“å‡º</span>

<span class="kt">int</span> <span class="nf">tcflow</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span><span class="kt">int</span> <span class="n">flowtypes</span><span class="p">);</span>
<span class="c1">//æ¸…ç©ºè¾“å…¥ã€è¾“å‡ºæˆ–è€…ä¸¤è€…éƒ½æ¸…ç©º</span>

<span class="kt">int</span> <span class="nf">tcflush</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span><span class="kt">int</span> <span class="n">in_out_selector</span><span class="p">);</span>

</code></pre></div></div>

<h3 id="55-ç»ˆç«¯çš„è¾“å‡º">5.5 ç»ˆç«¯çš„è¾“å‡º</h3>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">curses.h</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">terminfo()</code>å‡½æ•°å¯ä»¥å®ç°ç›¸å…³ä¿¡æ¯çš„æŸ¥è¯¢ã€‚</p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">echo $TERM</code>å¯ä»¥è¯†åˆ«å½“å‰çš„ç»ˆç«¯ç±»å‹.ç»ˆç«¯çš„ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">/usr/lib/terminfo</code>æˆ–<code class="language-plaintext highlighter-rouge">/usr/share/terminfo</code>ç›®å½•ä¸­ã€‚</p>

<p>æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºè®¾ç½®</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infocmp vt100 

<span class="c">#	Reconstructed via infocmp from file: /lib/terminfo/v/vt100</span>
vt100|vt100-am|dec vt100 <span class="o">(</span>w/advanced video<span class="o">)</span>,
    am, mc5i, msgr, xenl, xon,
    cols#80, it#8, lines#24, vt#3,
    <span class="nv">acsc</span><span class="o">=</span><span class="sb">``</span>aaffggjjkkllmmnnooppqqrrssttuuvvwwxxyyzz~~,
    <span class="nv">bel</span><span class="o">=</span>^G, <span class="nv">blink</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>5m<span class="nv">$&lt;</span>2&gt;, <span class="nv">bold</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>1m<span class="nv">$&lt;</span>2&gt;,
    <span class="nv">clear</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>H<span class="se">\E</span><span class="o">[</span>J<span class="nv">$&lt;</span>50&gt;, <span class="nv">cr</span><span class="o">=</span>^M, <span class="nv">csr</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%i%p1%d<span class="p">;</span>%p2%dr,
    <span class="nv">cub</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%p1%dD, <span class="nv">cub1</span><span class="o">=</span>^H, <span class="nv">cud</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%p1%dB, <span class="nv">cud1</span><span class="o">=</span>^J,
    <span class="nv">cuf</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%p1%dC, <span class="nv">cuf1</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>C<span class="nv">$&lt;</span>2&gt;,
    <span class="nv">cup</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%i%p1%d<span class="p">;</span>%p2%dH<span class="nv">$&lt;</span>5&gt;, <span class="nv">cuu</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>%p1%dA,
    <span class="nv">cuu1</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>A<span class="nv">$&lt;</span>2&gt;, <span class="nv">ed</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>J<span class="nv">$&lt;</span>50&gt;, <span class="nv">el</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>K<span class="nv">$&lt;</span>3&gt;, <span class="nv">el1</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>1K<span class="nv">$&lt;</span>3&gt;,
    <span class="nv">enacs</span><span class="o">=</span><span class="se">\E</span><span class="o">(</span>B<span class="se">\E</span><span class="o">)</span>0, <span class="nv">home</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>H, <span class="nv">ht</span><span class="o">=</span>^I, <span class="nv">hts</span><span class="o">=</span><span class="se">\E</span>H, <span class="nv">ind</span><span class="o">=</span>^J, <span class="nv">ka1</span><span class="o">=</span><span class="se">\E</span>Oq,
    <span class="nv">ka3</span><span class="o">=</span><span class="se">\E</span>Os, <span class="nv">kb2</span><span class="o">=</span><span class="se">\E</span>Or, <span class="nv">kbs</span><span class="o">=</span>^H, <span class="nv">kc1</span><span class="o">=</span><span class="se">\E</span>Op, <span class="nv">kc3</span><span class="o">=</span><span class="se">\E</span>On, <span class="nv">kcub1</span><span class="o">=</span><span class="se">\E</span>OD,
    <span class="nv">kcud1</span><span class="o">=</span><span class="se">\E</span>OB, <span class="nv">kcuf1</span><span class="o">=</span><span class="se">\E</span>OC, <span class="nv">kcuu1</span><span class="o">=</span><span class="se">\E</span>OA, <span class="nv">kent</span><span class="o">=</span><span class="se">\E</span>OM, <span class="nv">kf0</span><span class="o">=</span><span class="se">\E</span>Oy,
    <span class="nv">kf1</span><span class="o">=</span><span class="se">\E</span>OP, <span class="nv">kf10</span><span class="o">=</span><span class="se">\E</span>Ox, <span class="nv">kf2</span><span class="o">=</span><span class="se">\E</span>OQ, <span class="nv">kf3</span><span class="o">=</span><span class="se">\E</span>OR, <span class="nv">kf4</span><span class="o">=</span><span class="se">\E</span>OS, <span class="nv">kf5</span><span class="o">=</span><span class="se">\E</span>Ot,
    <span class="nv">kf6</span><span class="o">=</span><span class="se">\E</span>Ou, <span class="nv">kf7</span><span class="o">=</span><span class="se">\E</span>Ov, <span class="nv">kf8</span><span class="o">=</span><span class="se">\E</span>Ol, <span class="nv">kf9</span><span class="o">=</span><span class="se">\E</span>Ow, <span class="nv">lf1</span><span class="o">=</span>pf1, <span class="nv">lf2</span><span class="o">=</span>pf2,
    <span class="nv">lf3</span><span class="o">=</span>pf3, <span class="nv">lf4</span><span class="o">=</span>pf4, <span class="nv">mc0</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>0i, <span class="nv">mc4</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>4i, <span class="nv">mc5</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>5i, <span class="nv">rc</span><span class="o">=</span><span class="se">\E</span>8,
    <span class="nv">rev</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>7m<span class="nv">$&lt;</span>2&gt;, <span class="nv">ri</span><span class="o">=</span><span class="se">\E</span>M<span class="nv">$&lt;</span>5&gt;, <span class="nv">rmacs</span><span class="o">=</span>^O, <span class="nv">rmam</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>?7l,
    <span class="nv">rmkx</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>?1l<span class="se">\E</span><span class="o">&gt;</span>, <span class="nv">rmso</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>m<span class="nv">$&lt;</span>2&gt;, <span class="nv">rmul</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>m<span class="nv">$&lt;</span>2&gt;,
    <span class="nv">rs2</span><span class="o">=</span><span class="se">\E</span><span class="o">&gt;</span><span class="se">\E</span><span class="o">[</span>?3l<span class="se">\E</span><span class="o">[</span>?4l<span class="se">\E</span><span class="o">[</span>?5l<span class="se">\E</span><span class="o">[</span>?7h<span class="se">\E</span><span class="o">[</span>?8h, <span class="nv">sc</span><span class="o">=</span><span class="se">\E</span>7,
    <span class="nv">sgr</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>0%?%p1%p6%|%t<span class="p">;</span>1%<span class="p">;</span>%?%p2%t<span class="p">;</span>4%<span class="p">;</span>%?%p1%p3%|%t<span class="p">;</span>7%<span class="p">;</span>%?%p4%t<span class="p">;</span>5%<span class="p">;</span>m%?%p9%t&lt;<span class="o">!</span>JEKYLL@4800@132&gt;16%e&lt;<span class="o">!</span>JEKYLL@4800@132&gt;17%<span class="p">;</span><span class="nv">$&lt;</span>2&gt;,
    <span class="nv">sgr0</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>m&lt;<span class="o">!</span>JEKYLL@4800@132&gt;17<span class="nv">$&lt;</span>2&gt;, <span class="nv">smacs</span><span class="o">=</span>^N, <span class="nv">smam</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>?7h, <span class="nv">smkx</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>?1h<span class="se">\E</span><span class="o">=</span>,
    <span class="nv">smso</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>7m<span class="nv">$&lt;</span>2&gt;, <span class="nv">smul</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>4m<span class="nv">$&lt;</span>2&gt;, <span class="nv">tbc</span><span class="o">=</span><span class="se">\E</span><span class="o">[</span>3g,

</code></pre></div></div>

<p>å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">int setupterm(char *term,int fd,int *errret)</code>è®¾ç½®ç»ˆç«¯çš„è¾“å‡ºåŠŸèƒ½ã€‚</p>

<h3 id="56-æ£€æµ‹å‡»é”®åŠ¨ä½œ">5.6 æ£€æµ‹å‡»é”®åŠ¨ä½œ</h3>

<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/lifexy/p/7553861.html">linuxé”®ç›˜é©±åŠ¨</a></p>

<p>ä½¿ç”¨ä¸€èˆ¬æ–¹æ³•è¿›è¡Œç›¸å…³çš„é”®ç›˜æ£€æµ‹ã€‚</p>

<h3 id="57-è™šæ‹Ÿæ§åˆ¶å°">5.7 è™šæ‹Ÿæ§åˆ¶å°</h3>

<p>linuxä¸­æä¾›äº†è™šæ‹Ÿæ§åˆ¶å°çš„åŠŸèƒ½ï¼Œä¸€ç»„ç»ˆç«¯è®¾å¤‡å…±äº«PCç”µè„‘çš„å±å¹•ã€é”®ç›˜å’Œé¼ æ ‡ã€‚è™šæ‹Ÿæ§åˆ¶å°å¯ä»¥é€šè¿‡å­—ç¬¦è®¾å¤‡æ–‡ä»¶/dev/ttyNè¿›è¡Œä½¿ç”¨ã€‚ä¸€èˆ¬ä»æ•°å­—1å¼€å§‹ã€‚</p>

:ET