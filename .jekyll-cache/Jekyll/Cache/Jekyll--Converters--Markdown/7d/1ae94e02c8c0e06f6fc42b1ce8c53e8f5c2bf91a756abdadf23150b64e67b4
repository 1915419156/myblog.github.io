I"¢<blockquote>
  <p>2019-8-14 13:01:45</p>
</blockquote>

<h1 id="cmake-å·¥ç¨‹å…¥é—¨æŒ‡å—">CMake å·¥ç¨‹å…¥é—¨æŒ‡å—</h1>

<h2 id="cmakeå®˜æ–¹æ•™ç¨‹">CMakeå®˜æ–¹æ•™ç¨‹</h2>

<p><a href="https://cmake.org/cmake-tutorial/">cmakeå®˜æ–¹æ•™ç¨‹</a></p>

<p>è¿™ç¯‡æ–‡ç« æ˜¯å®˜æ–¹æ•™ç¨‹çš„ç¿»è¯‘</p>

<h2 id="1-ä¸€ä¸ªç®€å•çš„èµ·ç‚¹">1 ä¸€ä¸ªç®€å•çš„èµ·ç‚¹</h2>

<p>æœ€ç®€å•çš„å·¥ç¨‹å°±æ˜¯å°†ä¸€äº›æºæ–‡ä»¶ç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åºã€‚å¯¹äºç®€å•å·¥ç¨‹æ¥è¯´ï¼Œåªéœ€è¦åœ¨CMakeList.txtæ·»åŠ 2è¡Œå†…å®¹å³å¯ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¿™ä¸ªæ•™ç¨‹çš„èµ·ç‚¹ï¼ŒCMakeLists.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 2.6<span class="p">)</span>
<span class="nb">project</span> <span class="p">(</span>Tutorial<span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span>Tutorial tutorial.cxx<span class="p">)</span>
</code></pre></div></div>

<p>æ³¨æ„ï¼šCMakeæ–‡ä»¶ä¸­å‘½ä»¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æ˜¯å˜é‡æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œè¿™ä¸ªä¾‹å­ä¸­CMakeLists.txtæ–‡ä»¶ä¸­éƒ½ä½¿ç”¨å°å†™å­—æ¯ã€‚æºæ–‡ä»¶â€tutorial.cxxâ€ç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// A simple program that computes the square root of a number</span>

<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="cp">#include &lt;math.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"Usage: %s number</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="kt">double</span> <span class="n">inputValue</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">double</span> <span class="n">outputValue</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">inputValue</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"The square root of %g is %g</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
          <span class="n">inputValue</span><span class="p">,</span> <span class="n">outputValue</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="12-æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®å¤´æ–‡ä»¶">1.2 æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®å¤´æ–‡ä»¶</h3>

<p>æˆ‘ä»¬æ·»åŠ çš„ç¬¬ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ä¸ºæˆ‘ä»¬çš„å¯æ‰§è¡Œç¨‹åºå’Œå·¥ç¨‹æä¾›ä¸€ä¸ªç‰ˆæœ¬å·.ä½ å¯ä»¥åœ¨æºä»£ç ä¸­å†™å…¥ç‰ˆæœ¬å·,ç„¶è€Œåœ¨CMakeLists.txtä¸­æä¾›(ç‰ˆæœ¬å·)æ›´çµæ´».ä¿®æ”¹CMakeLists.txtå¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·,å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 2.6<span class="p">)</span>
<span class="nb">project</span> <span class="p">(</span>Tutorial<span class="p">)</span>
<span class="c1"># The version number.</span>
<span class="nb">set</span> <span class="p">(</span>Tutorial_VERSION_MAJOR 1<span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span>Tutorial_VERSION_MINOR 0<span class="p">)</span>
 
<span class="c1"># configure a header file to pass some of the CMake settings</span>
<span class="c1"># to the source code</span>
<span class="nb">configure_file</span> <span class="p">(</span>
  <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h.in"</span>
  <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h"</span>
  <span class="p">)</span>
 
<span class="c1"># add the binary tree to the search path for include files</span>
<span class="c1"># so that we will find TutorialConfig.h</span>
<span class="nb">include_directories</span><span class="p">(</span><span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
 
<span class="c1"># add the executable</span>
<span class="nb">add_executable</span><span class="p">(</span>Tutorial tutorial.cxx<span class="p">)</span>

</code></pre></div></div>
<p>å› ä¸ºé…ç½®æ–‡ä»¶å°†ä¼šè¢«å†™å…¥åˆ°äºŒè¿›åˆ¶æ ‘å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªç›®å½•æ·»åŠ åˆ°å¤´æ–‡ä»¶è·¯å¾„å½“ä¸­ã€‚æˆ‘ä»¬æ¥ç€åˆ›å»ºä¸€ä¸ªâ€TutorialConfig.h.inâ€æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// the configured options and settings for Tutorial

#define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@
#define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@

</code></pre></div></div>

<p>å½“CMakeé…ç½®è¿™ä¸ªå¤´æ–‡ä»¶æ˜¯ï¼Œâ€@Tutorial_VERSION_MAJOR@â€å’Œâ€@Tutorial_VERSION_MINOR@â€çš„å€¼å°†ä¼šè¢«CMakeLists.txtæ–‡ä»¶ä¸­çš„å€¼æ›¿æ¢ã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬ä¿®æ”¹â€tutorial.cxxâ€æ¥åŒ…å«é…ç½®å¤´æ–‡ä»¶æ¥ä½¿ç”¨ç‰ˆæœ¬å·ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// A simple program that computes the square root of a number

#include &lt;stdio.h&gt;

#include &lt;stdlib.h&gt;

#include &lt;math.h&gt;

#include "TutorialConfig.h"
 
int main (int argc, char *argv[])
{
  if (argc &lt; 2)
    {
    fprintf(stdout,"%s Version %d.%d\n",
            argv[0],
            Tutorial_VERSION_MAJOR,
            Tutorial_VERSION_MINOR);
    fprintf(stdout,"Usage: %s number\n",argv[0]);
    return 1;
    }
  double inputValue = atof(argv[1]);
  double outputValue = sqrt(inputValue);
  fprintf(stdout,"The square root of %g is %g\n",
          inputValue, outputValue);
  return 0;
}

</code></pre></div></div>
<p>ä¸Šé¢ä»£ç æœ€ä¸»è¦çš„ä¿®æ”¹å°±æ˜¯åŒ…å«äº†TutorialConfig.hå¤´æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰“å°å‡ºç‰ˆæœ¬å·ã€‚</p>

<h2 id="2-æ·»åŠ ä¸€ä¸ªåº“">2 æ·»åŠ ä¸€ä¸ªåº“</h2>

<p>ç°åœ¨æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„å·¥ç¨‹æ·»åŠ ä¸€ä¸ªåº“ã€‚è¿™ä¸ªåº“åŒ…å«äº†è‡ªå·±å®ç°çš„ä¸€ä¸ªç”¨æ¥è®¡ç®—æ•°çš„å¹³æ–¹æ ¹å‡½æ•°ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“æ¥è®¡ç®—å¹³æ–¹æ ¹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¼–è¯‘å™¨æä¾›çš„æ ‡å‡†åº“ã€‚æ•™ç¨‹é‡Œæˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªåº“æ”¾åˆ°ä¸€ä¸ªå«åšâ€MathFunctionsâ€çš„å­æ–‡ä»¶å¤¹ä¸­ã€‚å®ƒåŒ…å«ä¸€ä¸ªåªæœ‰ä¸€è¡Œå†…å®¹çš„CMakeLists.txtæ–‡ä»¶ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add_library(MathFunctions mysqrt.cxx)
</code></pre></div></div>

<p>æºæ–‡ä»¶â€mysqrt.cxxâ€æœ‰ä¸€ä¸ªå«åšmysqrtçš„å‡½æ•°ï¼Œå®ƒè·Ÿç¼–è¯‘å™¨æä¾›çš„sqrtå‡½æ•°ç±»ä¼¼ã€‚ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ–°åº“ï¼Œæˆ‘ä»¬è¦åœ¨é¡¶å±‚çš„CMakeLists.txtä¸­æ·»åŠ â€add_subdirectoryâ€è°ƒç”¨,ä»¥ä¾¿ä½¿è¿™ä¸ªåº“èƒ½å¤Ÿè¢«ç¼–è¯‘åˆ°.æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ å¦å¤–ä¸€ä¸ªåŒ…å«æ–‡ä»¶å¤¹ä»¥ä¾¿æ‰¾åˆ°åŒ…å«åœ¨å¤´æ–‡ä»¶â€MathFunctions/MathFunctions.hâ€ä¸­çš„å‡½æ•°åŸå‹.æœ€åæŠŠæ–°åº“æ·»åŠ åˆ°åº”ç”¨ç¨‹åºå½“ä¸­,åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>include_directories ("${PROJECT_SOURCE_DIR}/MathFunctions")
add_subdirectory (MathFunctions) 
 
# add the executable
add_executable (Tutorial tutorial.cxx)
target_link_libraries (Tutorial MathFunctions)

</code></pre></div></div>

<p><strong>æ³¨æ„:è¿™é‡Œéœ€è¦è‡ªå·±æ‰‹åŠ¨åœ¨MathFunctionsæ–‡ä»¶å¤¹é‡Œæ·»åŠ â€mysqrt.cxxâ€å’Œâ€MathFunctions.hâ€æ–‡ä»¶,è¿™2ä¸ªæ–‡ä»¶é‡Œçš„ä»£ç å¯ä»¥å‚è€ƒæ–‡ç« æœ€åæä¾›çš„é™„ä»¶</strong></p>

<p>ç°åœ¨è®©æˆ‘ä»¬æŠŠMathFunctionsåº“åšæˆå¯é€‰çš„.å½“ç„¶åœ¨è¿™ä¸ªæ•™ç¨‹çš„å·¥ç¨‹ä¸­è¿™ä¸ªæ“ä½œæœ‰ç‚¹å¤šä½™.ä½†æ˜¯åœ¨ä½ çš„å…¶ä»–å·¥ç¨‹ä¸­,å¤šæ•°æƒ…å†µä¼šæœ‰å¤§é‡çš„ä¾èµ–ç¬¬ä¸‰æ–¹çš„åº“æ–‡ä»¶.æ·»åŠ ä¸€ä¸ªå¯é€‰åº“,éœ€è¦åœ¨æœ€é«˜å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›å†…å®¹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># should we use our own math functions?

option (USE_MYMATH  
        "Use tutorial provided math implementation" ON) 

</code></pre></div></div>

<p>è¿™ä¸ªUSE_MYMATHå°†ä¼šæ˜¾ç¤ºåœ¨CMake GUIå½“ä¸­,å¹¶ä¸”é»˜è®¤å€¼ä¸ºON,è¿™ä¸ªè®¾ç½®å°†ä¼šè¢«ä¿å­˜åˆ°CACHEå½“ä¸­,æ‰€ä»¥ç”¨æˆ·æ¯æ¬¡æ‰“å¼€å·¥ç¨‹æ—¶ä¸å¿…é‡æ–°é…ç½®.ä¸‹ä¸€æ­¥éœ€è¦åšä¸€äº›ä¿®æ”¹,ä»¥ä¾¿ä½¿MathFunctionsåº“å‚ä¸ç¼–è¯‘å’Œé“¾æ¥.è¿™ä¸ªä¿®æ”¹æ˜¯åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­,å†…å®¹å¦‚ä¸‹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># add the MathFunctions library?</span>
<span class="c1">#</span>
<span class="nb">if</span> <span class="p">(</span>USE_MYMATH<span class="p">)</span>
  <span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/MathFunctions"</span><span class="p">)</span>
  <span class="nb">add_subdirectory</span> <span class="p">(</span>MathFunctions<span class="p">)</span>
  <span class="nb">set</span> <span class="p">(</span>EXTRA_LIBS <span class="si">${</span><span class="nv">EXTRA_LIBS</span><span class="si">}</span> MathFunctions<span class="p">)</span>
<span class="nb">endif</span> <span class="p">(</span>USE_MYMATH<span class="p">)</span>
 
<span class="c1"># add the executable</span>
<span class="nb">add_executable</span> <span class="p">(</span>Tutorial tutorial.cxx<span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>Tutorial  <span class="si">${</span><span class="nv">EXTRA_LIBS</span><span class="si">}</span><span class="p">)</span>

</code></pre></div></div>

<p>é€šè¿‡é…ç½®USB_MYMATHæ¥å†³å®šæ˜¯å¦ç¼–è¯‘å’Œä½¿ç”¨MathFunctions.æ³¨æ„ä¸Šé¢çš„â€EXTRA_LIBSâ€å˜é‡æ˜¯ç”¨æ¥æ”¶é›†æ¯ä¸€ä¸ªå¯é€‰åº“çš„,ä»¥ä¾¿ä»–ä»¬é“¾æ¥åˆ°å¯æ‰§è¡Œç¨‹åºä¸­.è¿™æ˜¯ä¸€ä¸ªä¿æŒå¤§é¡¹ç›®å·¥ç¨‹å¯é€‰åº“æ¸…æ´çš„é€šç”¨æ–¹æ³•.ç›¸åº”çš„æºä»£ç ä¿®æ”¹æ˜¯å¾ˆç›´è§‚çš„,å¦‚ä¸‹:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// A simple program that computes the square root of a number</span>

<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="cp">#include &lt;math.h&gt;
</span>
<span class="cp">#include "TutorialConfig.h"
</span>
<span class="cp">#ifdef USE_MYMATH
#include "MathFunctions.h"
#endif
</span> 
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"%s Version %d.%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">Tutorial_VERSION_MAJOR</span><span class="p">,</span>
            <span class="n">Tutorial_VERSION_MINOR</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"Usage: %s number</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
  <span class="kt">double</span> <span class="n">inputValue</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 
<span class="cp">#ifdef USE_MYMATH
</span>  <span class="kt">double</span> <span class="n">outputValue</span> <span class="o">=</span> <span class="n">mysqrt</span><span class="p">(</span><span class="n">inputValue</span><span class="p">);</span>
<span class="cp">#else
</span>  <span class="kt">double</span> <span class="n">outputValue</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">inputValue</span><span class="p">);</span>
<span class="cp">#endif
</span> 
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s">"The square root of %g is %g</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
          <span class="n">inputValue</span><span class="p">,</span> <span class="n">outputValue</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


</code></pre></div></div>

<p>åœ¨æºæ–‡ä»¶ä¸­,æˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†USE_MYMATH,CMakeé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶TutorialConfig.h.iné…ç½®æ–‡ä»¶æ¥ä¸ºæºæ–‡ä»¶è¿™ä¸ªæä¾›æ”¯æŒ,æ·»åŠ å†…å®¹å¦‚ä¸‹:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#cmakedefine USE_MYMATH
</span></code></pre></div></div>

<h2 id="3-å®‰è£…å’Œæµ‹è¯•">3 å®‰è£…å’Œæµ‹è¯•</h2>

<p>ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„å·¥ç¨‹æ·»åŠ å®‰è£…è§„åˆ™å’Œæµ‹è¯•.å®‰è£…è§„åˆ™ç›¸å½“ç®€å•,ä¸ºäº†å®‰è£…MathFunctionsåº“å’Œå¤´æ–‡ä»¶,æˆ‘ä»¬éœ€è¦åœ¨MathFunctionsæ–‡ä»¶å¤¹çš„CMakeLists.txtæ–‡ä»¶ä¸­,æ·»åŠ å¦‚ä¸‹å†…å®¹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">install</span> <span class="p">(</span>TARGETS MathFunctions DESTINATION bin<span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span>FILES MathFunctions.h DESTINATION include<span class="p">)</span>
</code></pre></div></div>

<p>å¯¹äºåº”ç”¨ç¨‹åº,éœ€è¦åœ¨æœ€é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­å®‰è£…å¯æ‰§è¡Œç¨‹åºå’Œé…ç½®å¤´æ–‡ä»¶.</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># add the install targets</span>
<span class="nb">install</span> <span class="p">(</span>TARGETS Tutorial DESTINATION bin<span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span>FILES <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h"</span>        
         DESTINATION include<span class="p">)</span>
</code></pre></div></div>

<p><strong>æ³¨æ„:ä¸Šé¢è¿™å‡ è¡Œå†…å®¹,éœ€è¦æ·»åŠ åœ¨å¦‚ä¸‹ä»£ç ä¹‹å,å¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™,æç¤ºæ‰¾ä¸åˆ°â€Tutorialâ€</strong></p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># add the executable</span>
<span class="nb">add_executable</span> <span class="p">(</span>Tutorial tutorial.cxx<span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>Tutorial  <span class="si">${</span><span class="nv">EXTRA_LIBS</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™å°±æ˜¯æ‰€æœ‰è¦åšçš„.åˆ°è¿™é‡Œä½ åº”è¯¥å¯ä»¥æ„å»ºè¿™ä¸ªæ•™ç¨‹äº†,ç„¶åè¾“å…¥â€make installâ€(æˆ–åˆ™ä½¿ç”¨IDEç¼–è¯‘å‡ºINSTALLç›®æ ‡),å®ƒå°†å®‰è£…é€‚å½“çš„å¤´æ–‡ä»¶,åº“,å’Œå¯æ‰§è¡Œç¨‹åº.CMakeå˜é‡â€CMAKE_INSTALL_PREFIXâ€ç”¨æ¥å†³å®šè¿™äº›æ–‡ä»¶å°†è¢«å®‰è£…çš„æ ¹è·¯å¾„.æ·»åŠ æµ‹è¯•ä¹Ÿæ˜¯å¾ˆç®€å•çš„.åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›ç®€å•çš„æµ‹è¯•,æ¥ç¡®è®¤åº”ç”¨ç¨‹åºå·¥ä½œæ­£å¸¸.</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">include</span><span class="p">(</span>CTest<span class="p">)</span>

<span class="c1"># does the application run</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialRuns Tutorial 25<span class="p">)</span>

<span class="c1"># does it sqrt of 25</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialComp25 Tutorial 25<span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialComp25 PROPERTIES PASS_REGULAR_EXPRESSION <span class="s2">"25 is 5"</span><span class="p">)</span>

<span class="c1"># does it handle negative numbers</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialNegative Tutorial -25<span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialNegative PROPERTIES PASS_REGULAR_EXPRESSION <span class="s2">"-25 is 0"</span><span class="p">)</span>

<span class="c1"># does it handle small numbers</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialSmall Tutorial 0.0001<span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialSmall PROPERTIES PASS_REGULAR_EXPRESSION <span class="s2">"0.0001 is 0.01"</span><span class="p">)</span>

<span class="c1"># does the usage message work?</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialUsage Tutorial<span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialUsage PROPERTIES PASS_REGULAR_EXPRESSION <span class="s2">"Usage:.*number"</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨æ„å»ºå®Œæˆä¹‹åéœ€è¦è¿è¡Œâ€ctestâ€å‘½ä»¤æ¥è¿è¡Œä¸Šé¢çš„æµ‹è¯•.ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ç”¨æ¥ç¡®ä¿åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰æ®µé”™è¯¯,crash,è¿”å›å€¼é0.è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€å•çš„CTestæµ‹è¯•.æ¥ä¸‹æ¥çš„å‡ ä¸ªæµ‹è¯•éƒ½æ˜¯åˆ©ç”¨â€PASS_REGULAR_EXPRESSIONâ€æµ‹è¯•å±æ€§æ¥éªŒè¯è¾“å‡ºæ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦ä¸².åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­éªŒè¯å¹³æ–¹æ ¹è®¡ç®—æ˜¯å¦æ­£ç¡®,ä»¥åŠå½“è¾“å…¥é”™è¯¯ä¿¡æ¯æ—¶å€™è¾“å‡ºä½¿ç”¨ä¿¡æ¯.å¦‚æœä½ å¸Œæœ›æ·»åŠ æ›´å¤šæµ‹è¯•æ¥æµ‹è¯•ä¸åŒçš„è¾“å…¥å€¼,ä½ å¯ä»¥è€ƒè™‘åˆ›å»ºä¸€ä¸ªå®åƒå¦‚ä¸‹è¿™æ ·:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#define a macro to simplify adding tests, then use it</span>
<span class="nb">macro</span> <span class="p">(</span>do_test arg result<span class="p">)</span>
  <span class="nb">add_test</span> <span class="p">(</span>TutorialComp<span class="si">${</span><span class="nv">arg</span><span class="si">}</span> Tutorial <span class="si">${</span><span class="nv">arg</span><span class="si">}</span><span class="p">)</span>
  <span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialComp<span class="si">${</span><span class="nv">arg</span><span class="si">}</span>
    PROPERTIES PASS_REGULAR_EXPRESSION <span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="p">)</span>
<span class="nb">endmacro</span> <span class="p">(</span>do_test<span class="p">)</span>

<span class="c1"># do a bunch of result based tests</span>
<span class="nf">do_test</span> <span class="p">(</span>25 <span class="s2">"25 is 5"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>-25 <span class="s2">"-25 is 0"</span><span class="p">)</span>
</code></pre></div></div>

<p>do_testçš„æ¯ä¸€æ¬¡è°ƒç”¨,å°±ä¼šæœ‰ä¸€æ¬¡æµ‹è¯•è¢«æ·»åŠ åˆ°å·¥ç¨‹å½“ä¸­,æµ‹è¯•çš„åå­—ã€è¾“å…¥ã€ç»“æœ,åŸºäºä¼ é€’çš„å‚æ•°.</p>

<h2 id="4-æ·»åŠ ç³»ç»Ÿæ£€æµ‹">4 æ·»åŠ ç³»ç»Ÿæ£€æµ‹</h2>

<p>ä¸‹ä¸€æ­¥è®©æˆ‘ä»¬è€ƒè™‘æ·»åŠ ä¸€äº›ä»£ç åˆ°æˆ‘ä»¬çš„å·¥ç¨‹,ä»¥æ”¯æŒç›®æ ‡å¹³å°æ²¡æœ‰çš„ç‰¹æ€§.åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­,æˆ‘ä»¬å°†æ·»åŠ ä¸€äº›ä»£ç æ¥éªŒè¯ç›®æ ‡å¹³å°æ˜¯å¦å…·æœ‰logå’Œexpå‡½æ•°.å½“ç„¶å‡ ä¹æ‰€æœ‰çš„å¹³å°éƒ½æœ‰è¿™äº›å‡½æ•°,æ•™ç¨‹å‡è®¾ä¸€ä¸‹è¿™ç§å°‘æ•°æƒ…å†µ.å¦‚æœå¹³å°æœ‰logå‡½æ•°,é‚£ä¹ˆæˆ‘ä»¬åœ¨mysqrtå‡½æ•°ä¸­ç”¨å®ƒæ¥è®¡ç®—è¾“å‡º.ç¬¬ä¸€æ­¥æˆ‘ä»¬åˆ©ç”¨CheckFunctionExists.cmakeå®æµ‹è¯•è¿™äº›å‡½æ•°æ˜¯å¦æœ‰æ•ˆ,åœ¨é¡¶å±‚CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># does this system provide the log and exp functions?</span>
<span class="nb">include</span> <span class="p">(</span>CheckFunctionExists<span class="p">)</span>
<span class="nf">check_function_exists</span> <span class="p">(</span>log HAVE_LOG<span class="p">)</span>
<span class="nf">check_function_exists</span> <span class="p">(</span>exp HAVE_EXP<span class="p">)</span>

</code></pre></div></div>

<p>æ¥ç€æˆ‘ä»¬ä¿®æ”¹â€TutorialConfig.h.inâ€æ¥å®šä¹‰é‚£äº›CMakeåœ¨å¹³å°ä¸ŠæŸ¥æ‰¾åˆ°çš„å€¼,ä¿®æ”¹å¦‚ä¸‹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
// does the platform provide exp and log functions?
<span class="c1">#cmakedefine HAVE_LOG</span>
<span class="c1">#cmakedefine HAVE_EXP</span>
</code></pre></div></div>

<p>åœ¨ä½¿ç”¨logå’Œexpä¹‹å‰,ç¡®å®šä»–ä»¬æ˜¯å¦è¢«å®šä¹‰,æ˜¯éå¸¸é‡è¦çš„.åœ¨CMakeä¸­,é…ç½®æ–‡ä»¶çš„å‘½ä»¤ä¼šç«‹åˆ»ä½¿ç”¨ç›®å‰çš„é…ç½®.æœ€ååœ¨mysqrtå‡½æ•°ä¸­,æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªåŸºäºlogå’Œexpå‡½æ•°çš„å®ç°,ä»£ç å¦‚ä¸‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
// if we have both log and exp then use them
#if defined (HAVE_LOG) &amp;&amp; defined (HAVE_EXP)
  result = exp(log(x)*0.5);
#else // otherwise use an iterative approach
  . . .
</code></pre></div></div>

<p><strong>æ³¨æ„:è¿™é‡Œéœ€è¦åœ¨â€mysqrt.cxxâ€æ–‡ä»¶é‡Œæ·»åŠ å¤´æ–‡ä»¶#include â€œTutorialConfig.hâ€,å¦åˆ™æ‰¾ä¸åˆ°å®šä¹‰çš„å®</strong></p>

<h2 id="5-æ·»åŠ ç”Ÿæˆä¸€ä¸ªé€šç”¨çš„æ–‡ä»¶">5 æ·»åŠ /ç”Ÿæˆä¸€ä¸ªé€šç”¨çš„æ–‡ä»¶</h2>

<p>è¿™ä¸€èŠ‚æˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•æ·»åŠ ä¸€ä¸ªæºæ–‡ä»¶åˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºå½“ä¸­.åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­,æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªå·²ç»è®¡ç®—å¥½çš„å¹³æ–¹æ ¹è¡¨,å®ƒä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†,å¹¶ä¸”ç¼–è¯‘è¿›æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº.ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½,æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¨‹åºæ¥ç”Ÿæˆè¿™ä¸ªè¡¨.åœ¨MathFunctionså­æ–‡ä»¶å¤¹ä¸­æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå«åšMakeTable.cxxçš„æ–‡ä»¶,å®ƒçš„å†…å®¹å¦‚ä¸‹:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// A simple program that builds a sqrt table </span>

<span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;stdlib.h&gt;
</span>
<span class="cp">#include &lt;math.h&gt;
</span> 
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">result</span><span class="p">;</span>
 
  <span class="c1">// make sure we have enough arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
  <span class="c1">// open the output file</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">fout</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">"w"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fout</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
  <span class="c1">// create a source file with a table of square roots</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span><span class="s">"double sqrtTable[] = {</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span><span class="s">"%g,</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>
 
  <span class="c1">// close the table with a zero</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span><span class="s">"0};</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">fout</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>æ³¨æ„,è¿™ä¸ªè¡¨æ ¼æ˜¯ç”¨C++ä»£ç”Ÿæˆçš„,å¹¶ä¸”æ–‡ä»¶çš„åå­—æ˜¯é€šè¿‡è¯¥ç¨‹åºçš„è¿è¡Œå‚æ•°ä¼ å…¥çš„.ä¸‹ä¸€æ­¥å°±æ˜¯æ·»åŠ ä¸€ä¸ªé€‚å½“çš„å‘½ä»¤åˆ°MathFunctionsçš„CMakeLists.txtæ–‡ä»¶æ¥æ„å»ºMakeTableåº”ç”¨ç¨‹åº,ç„¶ååœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿è¡Œå®ƒ.å®Œæˆè¿™äº›æ“ä½œ,æˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹å‘½ä»¤:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># first we add the executable that generates the table</span>
<span class="nb">add_executable</span><span class="p">(</span>MakeTable MakeTable.cxx<span class="p">)</span>
 
<span class="c1"># add the command to generate the source code</span>
<span class="nb">add_custom_command</span> <span class="p">(</span>
  OUTPUT <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h
  COMMAND MakeTable <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h
  DEPENDS MakeTable
  <span class="p">)</span>
 
<span class="c1"># add the binary tree directory to the search path for </span>
<span class="c1"># include files</span>
<span class="nb">include_directories</span><span class="p">(</span> <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span> <span class="p">)</span>
 
<span class="c1"># add the main library</span>
<span class="nb">add_library</span><span class="p">(</span>MathFunctions mysqrt.cxx <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h  <span class="p">)</span>
</code></pre></div></div>

<p>é¦–å…ˆ,å¯æ‰§è¡Œç¨‹åºMakeTableåƒæ‰€æœ‰å¯æ‰§è¡Œç¨‹åºä¸€æ ·è¢«æ·»åŠ .æ¥ç€æˆ‘ä»¬æ·»åŠ ä¸€äº›å‘½ä»¤æ¥è®©MakeTableç”ŸæˆTable.h.ç„¶åæˆ‘ä»¬è®©CMakeçŸ¥é“mysqrt.cxxä¾èµ–äºç”Ÿæˆçš„Table.h.è¿™éœ€è¦ä¸ºMathFunctionsåº“æŠŠç”Ÿæˆçš„Table.hæ–‡ä»¶æ·»åŠ åˆ°æºæ–‡ä»¶åˆ—è¡¨å½“ä¸­,æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ å½“å‰çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤¹æ·»åŠ åˆ°includeæ–‡ä»¶å¤¹åˆ—è¡¨å½“ä¸­,ä»¥ä¾¿Table.hæ–‡ä»¶å¯ä»¥è¢«mysqrt.cxxæ‰¾åˆ°å¹¶åŒ…å«.å½“å·¥ç¨‹è¢«æ„å»ºæ—¶,å®ƒå°†ä¼šå…ˆæ„å»ºMakeTableå¯æ‰§è¡Œç¨‹åº.å®ƒå°†è¿è¡ŒMakeTableæ¥ç”ŸæˆTable.hæ–‡ä»¶.æœ€å,å®ƒç¼–è¯‘åŒ…å«äº†Table.hæ–‡ä»¶çš„mysqrt.cxxæ¥ç”ŸæˆMathFunctionsåº“.ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„,é¡¶å±‚çš„CMakeLists.txtéœ€è¦æ·»åŠ å¦‚ä¸‹ä»£ç :</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 2.6<span class="p">)</span>
<span class="nb">project</span> <span class="p">(</span>Tutorial<span class="p">)</span>
<span class="nb">include</span><span class="p">(</span>CTest<span class="p">)</span>
 
<span class="c1"># The version number.</span>
<span class="nb">set</span> <span class="p">(</span>Tutorial_VERSION_MAJOR 1<span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span>Tutorial_VERSION_MINOR 0<span class="p">)</span>
 
<span class="c1"># does this system provide the log and exp functions?</span>
<span class="nb">include</span> <span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_ROOT</span><span class="si">}</span>/Modules/CheckFunctionExists.cmake<span class="p">)</span>
 
<span class="nf">check_function_exists</span> <span class="p">(</span>log HAVE_LOG<span class="p">)</span>
<span class="nf">check_function_exists</span> <span class="p">(</span>exp HAVE_EXP<span class="p">)</span>
 
<span class="c1"># should we use our own math functions</span>
<span class="nb">option</span><span class="p">(</span>USE_MYMATH 
  <span class="s2">"Use tutorial provided math implementation"</span> ON<span class="p">)</span>
 
<span class="c1"># configure a header file to pass some of the CMake settings</span>
<span class="c1"># to the source code</span>
<span class="nb">configure_file</span> <span class="p">(</span>
  <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h.in"</span>
  <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h"</span>
  <span class="p">)</span>
 
<span class="c1"># add the binary tree to the search path for include files</span>
<span class="c1"># so that we will find TutorialConfig.h</span>
<span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
 
<span class="c1"># add the MathFunctions library?</span>
<span class="nb">if</span> <span class="p">(</span>USE_MYMATH<span class="p">)</span>
  <span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/MathFunctions"</span><span class="p">)</span>
  <span class="nb">add_subdirectory</span> <span class="p">(</span>MathFunctions<span class="p">)</span>
  <span class="nb">set</span> <span class="p">(</span>EXTRA_LIBS <span class="si">${</span><span class="nv">EXTRA_LIBS</span><span class="si">}</span> MathFunctions<span class="p">)</span>
<span class="nb">endif</span> <span class="p">(</span>USE_MYMATH<span class="p">)</span>
 
<span class="c1"># add the executable</span>
<span class="nb">add_executable</span> <span class="p">(</span>Tutorial tutorial.cxx<span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>Tutorial  <span class="si">${</span><span class="nv">EXTRA_LIBS</span><span class="si">}</span><span class="p">)</span>
 
<span class="c1"># add the install targets</span>
<span class="nb">install</span> <span class="p">(</span>TARGETS Tutorial DESTINATION bin<span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span>FILES <span class="s2">"</span><span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span><span class="s2">/TutorialConfig.h"</span>        
         DESTINATION include<span class="p">)</span>
 
<span class="c1"># does the application run</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialRuns Tutorial 25<span class="p">)</span>
 
<span class="c1"># does the usage message work?</span>
<span class="nb">add_test</span> <span class="p">(</span>TutorialUsage Tutorial<span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialUsage
  PROPERTIES 
  PASS_REGULAR_EXPRESSION <span class="s2">"Usage:.*number"</span>
  <span class="p">)</span>
 
 
<span class="c1">#define a macro to simplify adding tests</span>
<span class="nb">macro</span> <span class="p">(</span>do_test arg result<span class="p">)</span>
  <span class="nb">add_test</span> <span class="p">(</span>TutorialComp<span class="si">${</span><span class="nv">arg</span><span class="si">}</span> Tutorial <span class="si">${</span><span class="nv">arg</span><span class="si">}</span><span class="p">)</span>
  <span class="nb">set_tests_properties</span> <span class="p">(</span>TutorialComp<span class="si">${</span><span class="nv">arg</span><span class="si">}</span>
    PROPERTIES PASS_REGULAR_EXPRESSION <span class="si">${</span><span class="nv">result</span><span class="si">}</span>
    <span class="p">)</span>
<span class="nb">endmacro</span> <span class="p">(</span>do_test<span class="p">)</span>
 
<span class="c1"># do a bunch of result based tests</span>
<span class="nf">do_test</span> <span class="p">(</span>4 <span class="s2">"4 is 2"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>9 <span class="s2">"9 is 3"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>5 <span class="s2">"5 is 2.236"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>7 <span class="s2">"7 is 2.645"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>25 <span class="s2">"25 is 5"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>-25 <span class="s2">"-25 is 0"</span><span class="p">)</span>
<span class="nf">do_test</span> <span class="p">(</span>0.0001 <span class="s2">"0.0001 is 0.01"</span><span class="p">)</span>
</code></pre></div></div>

<p>TutorialConfig.h.inåŒ…å«å¦‚ä¸‹å†…å®¹:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// the configured options and settings for Tutorial</span>
<span class="cp">#define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@
#define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@
#cmakedefine USE_MYMATH
</span> 
<span class="c1">// does the platform provide exp and log functions?</span>
<span class="cp">#cmakedefine HAVE_LOG
#cmakedefine HAVE_EXP
</span></code></pre></div></div>

<p>MathFunctionsæ–‡ä»¶å¤¹ä¸­çš„CMakeLists.txtæ–‡ä»¶,å†…å®¹å¦‚ä¸‹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># first we add the executable that generates the table</span>
<span class="nb">add_executable</span><span class="p">(</span>MakeTable MakeTable.cxx<span class="p">)</span>
<span class="c1"># add the command to generate the source code</span>
<span class="nb">add_custom_command</span> <span class="p">(</span>
  OUTPUT <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h
  DEPENDS MakeTable
  COMMAND MakeTable <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h
  <span class="p">)</span>
<span class="c1"># add the binary tree directory to the search path </span>
<span class="c1"># for include files</span>
<span class="nb">include_directories</span><span class="p">(</span> <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span> <span class="p">)</span>
 
<span class="c1"># add the main library</span>
<span class="nb">add_library</span><span class="p">(</span>MathFunctions mysqrt.cxx <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/Table.h<span class="p">)</span>
 
<span class="nb">install</span> <span class="p">(</span>TARGETS MathFunctions DESTINATION bin<span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span>FILES MathFunctions.h DESTINATION include<span class="p">)</span>
</code></pre></div></div>

<h2 id="6-æ„å»ºä¸€ä¸ªå®‰è£…å™¨">6 æ„å»ºä¸€ä¸ªå®‰è£…å™¨</h2>

<p>æ¥ç€å‡è®¾æˆ‘ä»¬æƒ³æŠŠå·¥ç¨‹å‘å¸ƒç»™å…¶ä»–äººä½¿ç”¨.æˆ‘ä»¬å¸Œæœ›æä¾›ä¸åŒå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæºæ–‡ä»¶.è¿™é‡Œä¸æˆ‘ä»¬ä¹‹å‰åœ¨ç¬¬ä¸‰æ­¥ä¸­çš„å®‰è£…æœ‰ä¸€äº›ä¸åŒ,é‚£æ—¶æˆ‘ä»¬å®‰è£…æˆ‘ä»¬å·²ç»ä»æºä»£ç æ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶.åœ¨è¿™ä¸ªä¾‹å­ä¸­,æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå®‰è£…åŒ…,å®ƒæ”¯æŒäºŒè¿›åˆ¶å®‰è£…,ä»¥åŠcygwinã€ debianã€RPMsç­‰å·¥å…·çš„åŒ…ç®¡ç†ç‰¹æ€§.ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½,æˆ‘ä»¬ä¼šä½¿ç”¨CPackæ¥åˆ›å»ºå¹³å°ç›¸å…³çš„å®‰è£…åŒ….æˆ‘ä»¬éœ€è¦åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­çš„æœ€åæ·»åŠ ä¸€äº›ä»£ç ,å†…å®¹å¦‚ä¸‹:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># build a CPack driven installer package</span>
<span class="nb">include</span> <span class="p">(</span>InstallRequiredSystemLibraries<span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span>CPACK_RESOURCE_FILE_LICENSE  
     <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/License.txt"</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span>CPACK_PACKAGE_VERSION_MAJOR <span class="s2">"</span><span class="si">${</span><span class="nv">Tutorial_VERSION_MAJOR</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span>CPACK_PACKAGE_VERSION_MINOR <span class="s2">"</span><span class="si">${</span><span class="nv">Tutorial_VERSION_MINOR</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">include</span> <span class="p">(</span>CPack<span class="p">)</span>
</code></pre></div></div>

<p><strong>å®˜æ–¹æ•™ç¨‹ä¸­æ²¡æœ‰License.txtæ–‡ä»¶,æ‰€æœ‰è¦æ‰‹åŠ¨åœ¨é¡¶å±‚ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªâ€License.txtâ€æ–‡ä»¶</strong></p>

<p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æ‰€æœ‰è¦åšçš„.ä»¥åŒ…å«InstallRequiredSystemLibrariesä¸ºå¼€å§‹.è¿™ä¸ªæ¨¡å—å°†åŒ…å«å·¥ç¨‹åœ¨ç›®å‰å¹³å°ä¸Šæ‰€éœ€è¦çš„æ‰€æœ‰è¿è¡Œæ—¶åº“.æ¥ç€æˆ‘ä»¬è®¾ç½®ä¸€äº›CPackå˜é‡,åŒ…æ‹¬æˆ‘ä»¬ä¿å­˜licenseçš„åœ°æ–¹,å·¥ç¨‹çš„ç‰ˆæœ¬ä¿¡æ¯.ç‰ˆæœ¬ä¿¡æ¯å°±æ˜¯ç”¨äº†æˆ‘ä»¬æ•™ç¨‹ä¸­ä¹‹å‰è®¾ç½®çš„å˜é‡å€¼.æœ€åæˆ‘ä»¬åŒ…å«CPakeæ¨¡å—,å®ƒå°†ä½¿ç”¨è¿™äº›å˜é‡å’Œä¸€äº›ç³»ç»Ÿçš„å…¶ä»–å±æ€§æ¥è®¾ç½®å®‰è£…åŒ….</p>

<p>ä¸‹ä¸€æ­¥æ˜¯ä»¥é€šå¸¸çš„æ–¹æ³•æ„å»ºå·¥ç¨‹,ç„¶ååœ¨CPackä¸Šè¿è¡Œå®ƒ.ä¸ºäº†æ„å»ºäºŒè¿›åˆ¶å‘è¡ŒåŒ…,ä½ éœ€è¦è¿è¡Œå¦‚ä¸‹å‘½ä»¤:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpack --config CPackConfig.cmake

</code></pre></div></div>

<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæºæ–‡ä»¶å‘è¡ŒåŒ…ï¼Œéœ€è¦è¿è¡Œï¼š</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
cpack --config CPackSourceConfig.cmake
</code></pre></div></div>
<p>æ³¨æ„:è¿™é‡Œçš„2æ¡å‘½ä»¤éœ€è¦åœ¨æ„å»ºå·¥ç¨‹çš„ç›®å½•ä¸‹è¿è¡Œ!</p>

<h2 id="7-æ·»åŠ å¯¹dashboardæ”¯æŒ">7 æ·»åŠ å¯¹Dashboardæ”¯æŒ</h2>

<p>å°†æˆ‘ä»¬çš„æµ‹è¯•ç»“æœæ·»åŠ åˆ°Dashboardä¸Šæ˜¯éå¸¸å®¹æ˜“çš„.åœ¨æ•™ç¨‹çš„å‰é¢æ­¥éª¤å½“ä¸­æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„å·¥ç¨‹å®šä¹‰äº†ä¸€äº›æµ‹è¯•.æˆ‘ä»¬åªéœ€è¦è¿è¡Œè¿™äº›æµ‹è¯•,å¹¶ä¸”æäº¤ä»–ä»¬åˆ°ä¸€ä¸ªdashboardä¸Š.ä¸ºäº†æ”¯æŒdashboardæˆ‘ä»¬éœ€è¦åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­åŒ…å«CTestæ¨¡å—ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># enable dashboard scripting
include (CTest)
</code></pre></div></div>

<p>æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªCTestConfig.cmakeæ–‡ä»¶ï¼Œç”¨æ¥ä¸ºdashboardæŒ‡å®šå·¥ç¨‹åå­—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
set (CTEST_PROJECT_NAME "Tutorial")
</code></pre></div></div>

<p>CTestè¿è¡Œæ—¶å°†è¯»å–è¿™ä¸ªæ–‡ä»¶.ä½ å¯ä»¥åœ¨ä½ çš„å·¥ç¨‹ä¸­è¿è¡ŒCMakeæ¥ç”Ÿæˆä¸€ä¸ªç®€å•çš„dashboard,è¿›å…¥æ„å»ºç›®å½•ä¸‹,ç„¶åæ‰§è¡Œâ€ctest -D Experimentalâ€,å°†ä¼šæŠŠä½ çš„dashboardç»“æœä¸Šä¼ åˆ°Kitwareâ€™så·¥ç¨‹dashboardä¸Š.</p>

:ET